<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title> - Aphros的个人博客</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="" />
<meta property="og:description" content="第 2 章 Python 语法基础，IPython 和 Jupyter 笔记本 当我在 2011 年和 2012 年写作本书的第一版时，可用的学习 Python 数据分析的资源很少。这部分上是一个鸡和蛋的问题：我" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/pyda-2e-zh/2/" /><meta property="article:section" content="posts" />

<meta property="og:site_name" content="Aphros的博客" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="第 2 章 Python 语法基础，IPython 和 Jupyter 笔记本 当我在 2011 年和 2012 年写作本书的第一版时，可用的学习 Python 数据分析的资源很少。这部分上是一个鸡和蛋的问题：我"/>
<meta name="application-name" content="Aphros的博客">
<meta name="apple-mobile-web-app-title" content="Aphros的博客"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/posts/pyda-2e-zh/2/" /><link rel="prev" href="http://localhost:1313/posts/pyda-2e-zh/3/" /><link rel="next" href="http://localhost:1313/posts/pyda-2e-zh/14/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/pyda-2e-zh\/2\/"
        },"genre": "posts","wordcount":  11715 ,
        "url": "http:\/\/localhost:1313\/posts\/pyda-2e-zh\/2\/","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Aphros"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Aphros的个人博客">Aphros的博客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Aphros的个人博客">Aphros的博客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX"></h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Aphros</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="0001-01-01">0001-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;11715 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;24 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#21-python-解释器">2.1 Python 解释器</a></li>
    <li><a href="#22-ipython-基础">2.2 IPython 基础</a>
      <ul>
        <li><a href="#运行-ipython-shell">运行 IPython Shell</a></li>
        <li><a href="#运行-jupyter-笔记本">运行 Jupyter 笔记本</a></li>
        <li><a href="#tab补全"><code>Tab</code>补全</a></li>
        <li><a href="#自省">自省</a></li>
        <li><a href="#run-命令">%run 命令</a></li>
        <li><a href="#中断运行的代码">中断运行的代码</a></li>
        <li><a href="#从剪贴板执行程序">从剪贴板执行程序</a></li>
        <li><a href="#键盘快捷键">键盘快捷键</a></li>
        <li><a href="#魔术命令">魔术命令</a></li>
        <li><a href="#集成-matplotlib">集成 Matplotlib</a></li>
      </ul>
    </li>
    <li><a href="#23-python-语法基础">2.3 Python 语法基础</a>
      <ul>
        <li><a href="#语言的语义">语言的语义</a></li>
        <li><a href="#使用缩进而不是括号">使用缩进，而不是括号</a></li>
        <li><a href="#万物皆对象">万物皆对象</a></li>
        <li><a href="#注释">注释</a></li>
        <li><a href="#函数和对象方法调用">函数和对象方法调用</a></li>
        <li><a href="#变量和参数传递">变量和参数传递</a></li>
        <li><a href="#动态引用强类型">动态引用，强类型</a></li>
        <li><a href="#属性和方法">属性和方法</a></li>
        <li><a href="#鸭子类型">鸭子类型</a></li>
        <li><a href="#引入">引入</a></li>
        <li><a href="#二元运算符和比较运算符">二元运算符和比较运算符</a></li>
        <li><a href="#可变与不可变对象">可变与不可变对象</a></li>
        <li><a href="#标量类型">标量类型</a></li>
        <li><a href="#数值类型">数值类型</a></li>
        <li><a href="#字符串">字符串</a></li>
        <li><a href="#字节和-unicode">字节和 Unicode</a></li>
        <li><a href="#布尔值">布尔值</a></li>
        <li><a href="#类型转换">类型转换</a></li>
        <li><a href="#none"><code>None</code></a></li>
        <li><a href="#日期和时间">日期和时间</a></li>
        <li><a href="#控制流">控制流</a></li>
        <li><a href="#ifelif和else"><code>if</code>、<code>elif</code>和<code>else</code></a></li>
        <li><a href="#for循环"><code>for</code>循环</a></li>
        <li><a href="#while循环"><code>while</code>循环</a></li>
        <li><a href="#pass"><code>pass</code></a></li>
        <li><a href="#range"><code>range</code></a></li>
        <li><a href="#三元表达式">三元表达式</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="第-2-章-python-语法基础ipython-和-jupyter-笔记本">第 2 章 Python 语法基础，IPython 和 Jupyter 笔记本</h1>
<p>当我在 2011 年和 2012 年写作本书的第一版时，可用的学习 Python 数据分析的资源很少。这部分上是一个鸡和蛋的问题：我们现在使用的库，比如 pandas、scikit-learn 和 statsmodels，那时相对来说并不成熟。2017 年，数据科学、数据分析和机器学习的资源已经很多，原来通用的科学计算拓展到了计算机科学家、物理学家和其它研究领域的工作人员。学习 Python 和成为软件工程师的优秀书籍也有了。</p>
<p>因为这本书是专注于 Python 数据处理的，对于一些 Python 的数据结构和库的特性难免不足。因此，本章和第 3 章的内容只够你能学习本书后面的内容。</p>
<p>在我来看，没有必要为了数据分析而去精通 Python。我鼓励你使用 IPython shell 和 Jupyter 试验示例代码，并学习不同类型、函数和方法的文档。虽然我已尽力让本书内容循序渐进，但读者偶尔仍会碰到没有之前介绍过的内容。</p>
<p>本书大部分内容关注的是基于表格的分析和处理大规模数据集的数据准备工具。为了使用这些工具，必须首先将混乱的数据规整为整洁的表格（或结构化）形式。幸好，Python 是一个理想的语言，可以快速整理数据。Python 使用得越熟练，越容易准备新数据集以进行分析。</p>
<p>最好在 IPython 和 Jupyter 中亲自尝试本书中使用的工具。当你学会了如何启动 Ipython 和 Jupyter，我建议你跟随示例代码进行练习。与任何键盘驱动的操作环境一样，记住常见的命令也是学习曲线的一部分。</p>
<blockquote>
<p>笔记：本章没有介绍 Python 的某些概念，如类和面向对象编程，你可能会发现它们在 Python 数据分析中很有用。 为了加强 Python 知识，我建议你学习<a href="https://docs.python.org/3/" target="_blank" rel="noopener noreffer ">官方 Python 教程</a>，或是通用的 Python 教程书籍，比如：</p>
<ul>
<li>Python Cookbook，第 3 版，David Beazley 和 Brian K. Jones 著（O’Reilly）</li>
<li>流畅的 Python，Luciano Ramalho 著（O’Reilly）</li>
<li>高效的 Python，Brett Slatkin 著（Pearson）</li>
</ul>
</blockquote>
<h2 id="21-python-解释器">2.1 Python 解释器</h2>
<p>Python 是解释性语言。Python 解释器同一时间只能运行一个程序的一条语句。标准的交互 Python 解释器可以在命令行中通过键入<code>python</code>命令打开：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ python
</span></span><span class="line"><span class="cl">Python 3.6.0 | packaged by conda-forge | (default, Jan 13 2017, 23:17:12)
</span></span><span class="line"><span class="cl">[GCC 4.8.2 20140120 (Red Hat 4.8.2-15)] on linux
</span></span><span class="line"><span class="cl">Type &#34;help&#34;, &#34;copyright&#34;, &#34;credits&#34; or &#34;license&#34; for more information.
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; a = 5
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; print(a)
</span></span><span class="line"><span class="cl">5
</span></span></code></pre></div><p><code>&gt;&gt;&gt;</code>提示输入代码。要退出 Python 解释器返回终端，可以输入<code>exit()</code>或按 Ctrl-D。</p>
<p>运行 Python 程序只需调用 Python 的同时，使用一个<code>.py</code>文件作为它的第一个参数。假设创建了一个<code>hello_world.py</code>文件，它的内容是：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello world&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>你可以用下面的命令运行它（<code>hello_world.py</code>文件必须位于终端的工作目录）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">python</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="n">Hello</span> <span class="n">world</span>
</span></span></code></pre></div><p>一些 Python 程序员总是这样执行 Python 代码的，从事数据分析和科学计算的人却会使用 IPython，一个强化的 Python 解释器，或 Jupyter 笔记本，一个网页代码笔记本，它原先是 IPython 的一个子项目。在本章中，我介绍了如何使用 IPython 和 Jupyter，在附录 A 中有更深入的介绍。当你使用<code>%run</code>命令，IPython 会同样执行指定文件中的代码，结束之后，还可以与结果交互：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ ipython
</span></span><span class="line"><span class="cl">Python 3.6.0 | packaged by conda-forge | (default, Jan 13 2017, 23:17:12)
</span></span><span class="line"><span class="cl">Type &#34;copyright&#34;, &#34;credits&#34; or &#34;license&#34; for more information.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">IPython 5.1.0 -- An enhanced Interactive Python.
</span></span><span class="line"><span class="cl">?         -&gt; Introduction and overview of IPython&#39;s features.
</span></span><span class="line"><span class="cl">%quickref -&gt; Quick reference.
</span></span><span class="line"><span class="cl">help      -&gt; Python&#39;s own help system.
</span></span><span class="line"><span class="cl">object?   -&gt; Details about &#39;object&#39;, use &#39;object??&#39; for extra details.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [1]: %run hello_world.py
</span></span><span class="line"><span class="cl">Hello world
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [2]:
</span></span></code></pre></div><p>IPython 默认采用序号的格式<code>In [2]:</code>，与标准的<code>&gt;&gt;&gt;</code>提示符不同。</p>
<h2 id="22-ipython-基础">2.2 IPython 基础</h2>
<p>在本节中，我们会教你打开运行 IPython shell 和 jupyter 笔记本，并介绍一些基本概念。</p>
<h3 id="运行-ipython-shell">运行 IPython Shell</h3>
<p>你可以用<code>ipython</code>在命令行打开 IPython Shell，就像打开普通的 Python 解释器：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ ipython
</span></span><span class="line"><span class="cl">Python 3.6.0 | packaged by conda-forge | (default, Jan 13 2017, 23:17:12)
</span></span><span class="line"><span class="cl">Type &#34;copyright&#34;, &#34;credits&#34; or &#34;license&#34; for more information.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">IPython 5.1.0 -- An enhanced Interactive Python.
</span></span><span class="line"><span class="cl">?         -&gt; Introduction and overview of IPython&#39;s features.
</span></span><span class="line"><span class="cl">%quickref -&gt; Quick reference.
</span></span><span class="line"><span class="cl">help      -&gt; Python&#39;s own help system.
</span></span><span class="line"><span class="cl">object?   -&gt; Details about &#39;object&#39;, use &#39;object??&#39; for extra details.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [1]: a = 5
</span></span><span class="line"><span class="cl">In [2]: a
</span></span><span class="line"><span class="cl">Out[2]: 5
</span></span></code></pre></div><p>你可以通过输入代码并按<code>Return</code>（或<code>Enter</code>），运行任意 Python 语句。当你只输入一个变量，它会显示代表的对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.20470765948471295</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="mi">1</span><span class="p">:</span> <span class="mf">0.47894333805754824</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="mi">2</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5194387150567381</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="mi">3</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.55573030434749</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="mi">4</span><span class="p">:</span> <span class="mf">1.9657805725027142</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="mi">5</span><span class="p">:</span> <span class="mf">1.3934058329729904</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span><span class="p">:</span> <span class="mf">0.09290787674371767</span><span class="p">}</span>
</span></span></code></pre></div><p>前两行是 Python 代码语句；第二条语句创建一个名为<code>data</code>的变量，它引用一个新创建的 Python 字典。最后一行打印<code>data</code>的值。</p>
<p>许多 Python 对象被格式化为更易读的形式，或称作<code>pretty-printed</code>，它与普通的<code>print</code>不同。如果在标准 Python 解释器中打印上述<code>data</code>变量，则可读性要降低：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">&gt;&gt;&gt; from numpy.random import randn
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; data = {i : randn() for i in range(7)}
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; print(data)
</span></span><span class="line"><span class="cl">{0: -1.5948255432744511, 1: 0.10569006472787983, 2: 1.972367135977295,
</span></span><span class="line"><span class="cl">3: 0.15455217573074576, 4: -0.24058577449429575, 5: -1.2904897053651216,
</span></span><span class="line"><span class="cl">6: 0.3308507317325902}
</span></span></code></pre></div><p>IPython 还支持执行任意代码块（通过一个华丽的复制-粘贴方法）和整段 Python 脚本的功能。你也可以使用 Jupyter 笔记本运行大代码块，接下来就会看到。</p>
<h3 id="运行-jupyter-笔记本">运行 Jupyter 笔记本</h3>
<p>笔记本是 Jupyter 项目的重要组件之一，它是一个代码、文本（有标记或无标记）、数据可视化或其它输出的交互式文档。Jupyter 笔记本需要与内核互动，内核是 Jupyter 与其它编程语言的交互编程协议。Python 的 Jupyter 内核是使用 IPython。要启动 Jupyter，在命令行中输入<code>jupyter notebook</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ jupyter notebook
</span></span><span class="line"><span class="cl">[I 15:20:52.739 NotebookApp] Serving notebooks from local directory:
</span></span><span class="line"><span class="cl">/home/wesm/code/pydata-book
</span></span><span class="line"><span class="cl">[I 15:20:52.739 NotebookApp] 0 active kernels
</span></span><span class="line"><span class="cl">[I 15:20:52.739 NotebookApp] The Jupyter Notebook is running at:
</span></span><span class="line"><span class="cl">http://localhost:8888/
</span></span><span class="line"><span class="cl">[I 15:20:52.740 NotebookApp] Use Control-C to stop this server and shut down
</span></span><span class="line"><span class="cl">all kernels (twice to skip confirmation).
</span></span><span class="line"><span class="cl">Created new window in existing browser session.
</span></span></code></pre></div><p>在多数平台上，Jupyter 会自动打开默认的浏览器（除非指定了<code>--no-browser</code>）。或者，可以在启动笔记本之后，手动打开网页<code>http://localhost:8888/</code>。图 2-1 展示了 Google Chrome 中的笔记本。</p>
<blockquote>
<p>笔记：许多人使用 Jupyter 作为本地的计算环境，但它也可以部署到服务器上远程访问。这里不做介绍，如果需要的话，鼓励读者自行到网上学习。</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-c76c4f40777d3ef1.png"
        data-srcset="img/7178691-c76c4f40777d3ef1.png, img/7178691-c76c4f40777d3ef1.png 1.5x, img/7178691-c76c4f40777d3ef1.png 2x"
        data-sizes="auto"
        alt="img/7178691-c76c4f40777d3ef1.png"
        title="图2-1 Jupyter notebook启动页面" /></p>
<p>要新建一个笔记本，点击按钮<code>New</code>，选择<code>Python3</code>或<code>conda</code>（默认项）。如果是第一次，点击空格，输入一行 Python 代码。然后按<code>Shift-Enter</code>执行。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-86a6813291ead445.png"
        data-srcset="img/7178691-86a6813291ead445.png, img/7178691-86a6813291ead445.png 1.5x, img/7178691-86a6813291ead445.png 2x"
        data-sizes="auto"
        alt="img/7178691-86a6813291ead445.png"
        title="图2-2 Jupyter新notebook页面" /></p>
<p>当保存笔记本时（<code>File</code>目录下的<code>Save and Checkpoint</code>），会创建一个后缀名为<code>.ipynb</code>的文件。这是一个自包含文件格式，包含当前笔记本中的所有内容（包括所有已评估的代码输出）。可以被其它 Jupyter 用户加载和编辑。要加载存在的笔记本，把它放到启动笔记本进程的相同目录内。你可以用本书的示例代码练习，见图 2-3。</p>
<p>虽然 Jupyter 笔记本和 IPython shell 使用起来不同，本章中几乎所有的命令和工具都可以通用。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-bc9a0b4c30363747.png"
        data-srcset="img/7178691-bc9a0b4c30363747.png, img/7178691-bc9a0b4c30363747.png 1.5x, img/7178691-bc9a0b4c30363747.png 2x"
        data-sizes="auto"
        alt="img/7178691-bc9a0b4c30363747.png"
        title="图2-3 Jupyter查看一个存在的notebook的页面" /></p>
<h3 id="tab补全"><code>Tab</code>补全</h3>
<p>从外观上，IPython shell 和标准的 Python 解释器只是看起来不同。IPython shell 的进步之一是具备其它 IDE 和交互计算分析环境都有的<code>Tab</code>补全功能。在 shell 中输入表达式，按下<code>Tab</code>，会搜索已输入变量（对象、函数等等）的命名空间：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [1]: an_apple = 27
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [2]: an_example = 42
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [3]: an&lt;Tab&gt;
</span></span><span class="line"><span class="cl">an_apple    and         an_example  any
</span></span></code></pre></div><p>在这个例子中，IPython 呈现出了之前两个定义的变量和 Python 的关键字和内建的函数<code>any</code>。当然，你也可以补全任何对象的方法和属性：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [3]: b = [1, 2, 3]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [4]: b.&lt;Tab&gt;
</span></span><span class="line"><span class="cl">b.append  b.count   b.insert  b.reverse
</span></span><span class="line"><span class="cl">b.clear   b.extend  b.pop     b.sort
</span></span><span class="line"><span class="cl">b.copy    b.index   b.remove
</span></span></code></pre></div><p>同样也适用于模块：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [1]: import datetime
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [2]: datetime.&lt;Tab&gt;
</span></span><span class="line"><span class="cl">datetime.date          datetime.MAXYEAR       datetime.timedelta
</span></span><span class="line"><span class="cl">datetime.datetime      datetime.MINYEAR       datetime.timezone
</span></span><span class="line"><span class="cl">datetime.datetime_CAPI datetime.time          datetime.tzinfo
</span></span></code></pre></div><p>在 Jupyter 笔记本和新版的 IPython（5.0 及以上），自动补全功能是下拉框的形式。</p>
<blockquote>
<p>笔记：注意，默认情况下，IPython 会隐藏下划线开头的方法和属性，比如魔术方法和内部的“私有”方法和属性，以避免混乱的显示（和让新手迷惑！）这些也可以<code>Tab</code>补全，但是你必须首先键入一个下划线才能看到它们。如果你喜欢总是在<code>Tab</code>补全中看到这样的方法，你可以 IPython 配置中进行设置。可以在 IPython 文档中查找方法。</p>
</blockquote>
<p>除了补全命名、对象和模块属性，<code>Tab</code>还可以补全其它的。当输入看似文件路径时（即使是 Python 字符串），按下<code>Tab</code>也可以补全电脑上对应的文件信息：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [7]: datasets/movielens/&lt;Tab&gt;
</span></span><span class="line"><span class="cl">datasets/movielens/movies.dat    datasets/movielens/README
</span></span><span class="line"><span class="cl">datasets/movielens/ratings.dat   datasets/movielens/users.dat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [7]: path = &#39;datasets/movielens/&lt;Tab&gt;
</span></span><span class="line"><span class="cl">datasets/movielens/movies.dat    datasets/movielens/README
</span></span><span class="line"><span class="cl">datasets/movielens/ratings.dat   datasets/movielens/users.dat
</span></span></code></pre></div><p>结合<code>%run</code>，<code>Tab</code>补全可以节省许多键盘操作。</p>
<p>另外，<code>Tab</code>补全可以补全函数的关键词参数（包括等于号<code>=</code>）。见图 2-4。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-8188b0386238c16a.png"
        data-srcset="img/7178691-8188b0386238c16a.png, img/7178691-8188b0386238c16a.png 1.5x, img/7178691-8188b0386238c16a.png 2x"
        data-sizes="auto"
        alt="img/7178691-8188b0386238c16a.png"
        title="图2-4 Jupyter notebook中自动补全函数关键词" /></p>
<p>后面会仔细地学习函数。</p>
<h3 id="自省">自省</h3>
<p>在变量前后使用问号？，可以显示对象的信息：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">b</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="n">Type</span><span class="p">:</span>       <span class="nb">list</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">Form</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Length</span><span class="p">:</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">Docstring</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="nb">list</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">new</span> <span class="n">empty</span> <span class="nb">list</span>
</span></span><span class="line"><span class="cl"><span class="nb">list</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">new</span> <span class="nb">list</span> <span class="n">initialized</span> <span class="kn">from</span> <span class="nn">iterable</span><span class="s1">&#39;s items</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">print</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="n">Docstring</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Prints</span> <span class="n">the</span> <span class="n">values</span> <span class="n">to</span> <span class="n">a</span> <span class="n">stream</span><span class="p">,</span> <span class="ow">or</span> <span class="n">to</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="n">by</span> <span class="n">default</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Optional</span> <span class="n">keyword</span> <span class="n">arguments</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">file</span><span class="p">:</span>  <span class="n">a</span> <span class="n">file</span><span class="o">-</span><span class="n">like</span> <span class="nb">object</span> <span class="p">(</span><span class="n">stream</span><span class="p">);</span> <span class="n">defaults</span> <span class="n">to</span> <span class="n">the</span> <span class="n">current</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">sep</span><span class="p">:</span>   <span class="n">string</span> <span class="n">inserted</span> <span class="n">between</span> <span class="n">values</span><span class="p">,</span> <span class="n">default</span> <span class="n">a</span> <span class="n">space</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">end</span><span class="p">:</span>   <span class="n">string</span> <span class="n">appended</span> <span class="n">after</span> <span class="n">the</span> <span class="n">last</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span> <span class="n">a</span> <span class="n">newline</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">flush</span><span class="p">:</span> <span class="n">whether</span> <span class="n">to</span> <span class="n">forcibly</span> <span class="n">flush</span> <span class="n">the</span> <span class="n">stream</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Type</span><span class="p">:</span>      <span class="n">builtin_function_or_method</span>
</span></span></code></pre></div><p>这可以作为对象的自省。如果对象是一个函数或实例方法，定义过的文档字符串，也会显示出信息。假设我们写了一个如下的函数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_numbers</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Add two numbers together
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    the_sum : type of arguments
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></span></code></pre></div><p>然后使用?符号，就可以显示如下的文档字符串：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">add_numbers</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="n">Signature</span><span class="p">:</span> <span class="n">add_numbers</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Docstring</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">Add</span> <span class="n">two</span> <span class="n">numbers</span> <span class="n">together</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Returns</span>
</span></span><span class="line"><span class="cl"><span class="o">-------</span>
</span></span><span class="line"><span class="cl"><span class="n">the_sum</span> <span class="p">:</span> <span class="nb">type</span> <span class="n">of</span> <span class="n">arguments</span>
</span></span><span class="line"><span class="cl"><span class="n">File</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="mi">6</span><span class="n">a548a216e27</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Type</span><span class="p">:</span>      <span class="n">function</span>
</span></span></code></pre></div><p>使用??会显示函数的源码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">add_numbers</span><span class="err">??</span>
</span></span><span class="line"><span class="cl"><span class="n">Signature</span><span class="p">:</span> <span class="n">add_numbers</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Source</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_numbers</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Add two numbers together
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    the_sum : type of arguments
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">File</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="mi">6</span><span class="n">a548a216e27</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Type</span><span class="p">:</span>      <span class="n">function</span>
</span></span></code></pre></div><p>?还有一个用途，就是像 Unix 或 Windows 命令行一样搜索 IPython 的命名空间。字符与通配符结合可以匹配所有的名字。例如，我们可以获得所有包含<code>load</code>的顶级 NumPy 命名空间：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">np</span><span class="o">.*</span><span class="n">load</span><span class="o">*</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="n">np</span><span class="o">.</span><span class="n">__loader__</span>
</span></span><span class="line"><span class="cl"><span class="n">np</span><span class="o">.</span><span class="n">load</span>
</span></span><span class="line"><span class="cl"><span class="n">np</span><span class="o">.</span><span class="n">loads</span>
</span></span><span class="line"><span class="cl"><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span>
</span></span><span class="line"><span class="cl"><span class="n">np</span><span class="o">.</span><span class="n">pkgload</span>
</span></span></code></pre></div><h3 id="run-命令">%run 命令</h3>
<p>你可以用<code>%run</code>命令运行所有的 Python 程序。假设有一个文件<code>ipython_script_test.py</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">z</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="mf">7.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span></code></pre></div><p>可以如下运行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="o">%</span><span class="n">run</span> <span class="n">ipython_script_test</span><span class="o">.</span><span class="n">py</span>
</span></span></code></pre></div><p>这段脚本运行在空的命名空间（没有<code>import</code>和其它定义的变量），因此结果和普通的运行方式<code>python script.py</code>相同。文件中所有定义的变量（<code>import</code>、函数和全局变量，除非抛出异常），都可以在 IPython shell 中随后访问：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="mf">7.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="mf">1.4666666666666666</span>
</span></span></code></pre></div><p>如果一个 Python 脚本需要命令行参数（在<code>sys.argv</code>中查找），可以在文件路径之后传递，就像在命令行上运行一样。</p>
<blockquote>
<p>笔记：如果想让一个脚本访问 IPython 已经定义过的变量，可以使用<code>%run -i</code>。</p>
</blockquote>
<p>在 Jupyter 笔记本中，你也可以使用<code>%load</code>，它将脚本导入到一个代码格中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">&gt;&gt;&gt; %load ipython_script_test.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def f(x, y, z):
</span></span><span class="line"><span class="cl">        return (x + y) / z
</span></span><span class="line"><span class="cl">    a = 5
</span></span><span class="line"><span class="cl">    b = 6
</span></span><span class="line"><span class="cl">    c = 7.5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    result = f(a, b, c)
</span></span></code></pre></div><h3 id="中断运行的代码">中断运行的代码</h3>
<p>代码运行时按<code>Ctrl-C</code>，无论是%run 或长时间运行命令，都会导致<code>KeyboardInterrupt</code>。这会导致几乎所有 Python 程序立即停止，除非一些特殊情况。</p>
<blockquote>
<p>警告：当 Python 代码调用了一些编译的扩展模块，按<code>Ctrl-C</code>不一定将执行的程序立即停止。在这种情况下，你必须等待，直到控制返回 Python 解释器，或者在更糟糕的情况下强制终止 Python 进程。</p>
</blockquote>
<h3 id="从剪贴板执行程序">从剪贴板执行程序</h3>
<p>如果使用 Jupyter 笔记本，你可以将代码复制粘贴到任意代码格执行。在 IPython shell 中也可以从剪贴板执行。假设在其它应用中复制了如下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="mi">8</span>
</span></span></code></pre></div><p>最简单的方法是使用<code>%paste</code>和<code>%cpaste</code>函数。<code>%paste</code>可以直接运行剪贴板中的代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="o">%</span><span class="n">paste</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="c1">## -- End pasted text --</span>
</span></span></code></pre></div><p><code>%cpaste</code>功能类似，但会给出一条提示：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="o">%</span><span class="n">cpaste</span>
</span></span><span class="line"><span class="cl"><span class="n">Pasting</span> <span class="n">code</span><span class="p">;</span> <span class="n">enter</span> <span class="s1">&#39;--&#39;</span> <span class="n">alone</span> <span class="n">on</span> <span class="n">the</span> <span class="n">line</span> <span class="n">to</span> <span class="n">stop</span> <span class="ow">or</span> <span class="n">use</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">D</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="p">:</span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="p">:</span><span class="n">y</span> <span class="o">=</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="p">:</span><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="p">:</span>    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="p">:</span>    <span class="n">y</span> <span class="o">=</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="p">:</span><span class="o">--</span>
</span></span></code></pre></div><p>使用<code>%cpaste</code>，你可以粘贴任意多的代码再运行。你可能想在运行前，先看看代码。如果粘贴了错误的代码，可以用<code>Ctrl-C</code>中断。</p>
<h3 id="键盘快捷键">键盘快捷键</h3>
<p>IPython 有许多键盘快捷键进行导航提示（类似 Emacs 文本编辑器或 UNIX bash Shell）和交互 shell 的历史命令。表 2-1 总结了常见的快捷键。图 2-5 展示了一部分，如移动光标。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-9ed3866ea25c11f8.png"
        data-srcset="img/7178691-9ed3866ea25c11f8.png, img/7178691-9ed3866ea25c11f8.png 1.5x, img/7178691-9ed3866ea25c11f8.png 2x"
        data-sizes="auto"
        alt="img/7178691-9ed3866ea25c11f8.png"
        title="图2-5 IPython shell中一些快捷键的说明" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-e179f5ea00e50691.png"
        data-srcset="img/7178691-e179f5ea00e50691.png, img/7178691-e179f5ea00e50691.png 1.5x, img/7178691-e179f5ea00e50691.png 2x"
        data-sizes="auto"
        alt="img/7178691-e179f5ea00e50691.png"
        title="表2-1 IPython的标准快捷键" /></p>
<p>Jupyter 笔记本有另外一套庞大的快捷键。因为它的快捷键比 IPython 的变化快，建议你参阅 Jupyter 笔记本的帮助文档。</p>
<h3 id="魔术命令">魔术命令</h3>
<p>IPython 中特殊的命令（Python 中没有）被称作“魔术”命令。这些命令可以使普通任务更便捷，更容易控制 IPython 系统。魔术命令是在指令前添加百分号%前缀。例如，可以用<code>%timeit</code>（这个命令后面会详谈）测量任何 Python 语句，例如矩阵乘法，的执行时间：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="o">%</span><span class="n">timeit</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">10000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">20.9</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span>
</span></span></code></pre></div><p>魔术命令可以被看做 IPython 中运行的命令行。许多魔术命令有“命令行”选项，可以通过？查看：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [21]: %debug?
</span></span><span class="line"><span class="cl">Docstring:
</span></span><span class="line"><span class="cl">::
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  %debug [--breakpoint FILE:LINE] [statement [statement ...]]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Activate the interactive debugger.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">This magic command support two ways of activating debugger.
</span></span><span class="line"><span class="cl">One is to activate debugger before executing code.  This way, you
</span></span><span class="line"><span class="cl">can set a break point, to step through the code from the point.
</span></span><span class="line"><span class="cl">You can use this mode by giving statements to execute and optionally
</span></span><span class="line"><span class="cl">a breakpoint.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The other one is to activate debugger in post-mortem mode.  You can
</span></span><span class="line"><span class="cl">activate this mode simply running %debug without any argument.
</span></span><span class="line"><span class="cl">If an exception has just occurred, this lets you inspect its stack
</span></span><span class="line"><span class="cl">frames interactively.  Note that this will always work only on the last
</span></span><span class="line"><span class="cl">traceback that occurred, so you must call this quickly after an
</span></span><span class="line"><span class="cl">exception that you wish to inspect has fired, because if another one
</span></span><span class="line"><span class="cl">occurs, it clobbers the previous one.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">If you want IPython to automatically do this on every exception, see
</span></span><span class="line"><span class="cl">the %pdb magic for more details.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">positional arguments:
</span></span><span class="line"><span class="cl">  statement             Code to run in debugger. You can omit this in cell
</span></span><span class="line"><span class="cl">                        magic mode.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">optional arguments:
</span></span><span class="line"><span class="cl">  --breakpoint &lt;FILE:LINE&gt;, -b &lt;FILE:LINE&gt;
</span></span><span class="line"><span class="cl">                        Set break point at LINE in FILE.
</span></span></code></pre></div><p>魔术函数默认可以不用百分号，只要没有变量和函数名相同。这个特点被称为“自动魔术”，可以用<code>%automagic</code>打开或关闭。</p>
<p>一些魔术函数与 Python 函数很像，它的结果可以赋值给一个变量：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [22]: %pwd
</span></span><span class="line"><span class="cl">Out[22]: &#39;/home/wesm/code/pydata-book
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [23]: foo = %pwd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [24]: foo
</span></span><span class="line"><span class="cl">Out[24]: &#39;/home/wesm/code/pydata-book&#39;
</span></span></code></pre></div><p>IPython 的文档可以在 shell 中打开，我建议你用<code>%quickref</code>或<code>%magic</code>学习下所有特殊命令。表 2-2 列出了一些可以提高生产率的交互计算和 Python 开发的 IPython 指令。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-c72b11add9b8ccf8.png"
        data-srcset="img/7178691-c72b11add9b8ccf8.png, img/7178691-c72b11add9b8ccf8.png 1.5x, img/7178691-c72b11add9b8ccf8.png 2x"
        data-sizes="auto"
        alt="img/7178691-c72b11add9b8ccf8.png"
        title="表2-2 一些常用的IPython魔术命令" /></p>
<h3 id="集成-matplotlib">集成 Matplotlib</h3>
<p>IPython 在分析计算领域能够流行的原因之一是它非常好的集成了数据可视化和其它用户界面库，比如 matplotlib。不用担心以前没用过 matplotlib，本书后面会详细介绍。<code>%matplotlib</code>魔术函数配置了 IPython shell 和 Jupyter 笔记本中的 matplotlib。这点很重要，其它创建的图不会出现（笔记本）或获取会话的控制，直到结束（shell）。</p>
<p>在 IPython shell 中，运行<code>%matplotlib</code>可以进行设置，可以创建多个绘图窗口，而不会干扰控制台会话：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [26]: %matplotlib
</span></span><span class="line"><span class="cl">Using matplotlib backend: Qt4Agg
</span></span></code></pre></div><p>在 JUpyter 中，命令有所不同（图 2-6）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [26]: %matplotlib inline
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-3ab3738a92a15486.png"
        data-srcset="img/7178691-3ab3738a92a15486.png, img/7178691-3ab3738a92a15486.png 1.5x, img/7178691-3ab3738a92a15486.png 2x"
        data-sizes="auto"
        alt="img/7178691-3ab3738a92a15486.png"
        title="图2-6 Jupyter行内matplotlib作图" /></p>
<h2 id="23-python-语法基础">2.3 Python 语法基础</h2>
<p>在本节中，我将概述基本的 Python 概念和语言机制。在下一章，我将详细介绍 Python 的数据结构、函数和其它内建工具。</p>
<h3 id="语言的语义">语言的语义</h3>
<p>Python 的语言设计强调的是可读性、简洁和清晰。有些人称 Python 为“可执行的伪代码”。</p>
<h3 id="使用缩进而不是括号">使用缩进，而不是括号</h3>
<p>Python 使用空白字符（<code>Tab</code>和空格）来组织代码，而不是像其它语言，比如 R、C++、JAVA 和 Perl 那样使用括号。看一个排序算法的<code>for</code>循环：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">array</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">less</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><p>冒号标志着缩进代码块的开始，冒号之后的所有代码的缩进量必须相同，直到代码块结束。不管是否喜欢这种形式，使用空白符是 Python 程序员开发的一部分，在我看来，这可以让 python 的代码可读性大大优于其它语言。虽然期初看起来很奇怪，经过一段时间，你就能适应了。</p>
<blockquote>
<p>笔记：我强烈建议你使用四个空格作为默认的缩进，可以使用<code>Tab</code>代替四个空格。许多文本编辑器的设置是使用制表位替代空格。某些人使用<code>Tab</code>或不同数目的空格数，常见的是使用两个空格。大多数情况下，四个空格是大多数人采用的方法，因此建议你也这样做。</p>
</blockquote>
<p>你应该已经看到，Python 的语句不需要用分号结尾。但是，分号却可以用来给同在一行的语句切分：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">7</span>
</span></span></code></pre></div><p>Python 不建议将多条语句放到一行，这会降低代码的可读性。</p>
<h3 id="万物皆对象">万物皆对象</h3>
<p>Python 语言的一个重要特性就是它的对象模型的一致性。每个数字、字符串、数据结构、函数、类、模块等等，都是在 Python 解释器的自有“盒子”内，它被认为是 Python 对象。每个对象都有类型（例如，字符串或函数）和内部数据。在实际中，这可以让语言非常灵活，因为函数也可以被当做对象使用。</p>
<h3 id="注释">注释</h3>
<p>任何前面带有井号<code>#</code>的文本都会被 Python 解释器忽略。这通常被用来添加注释。有时，你会想排除一段代码，但并不删除。简便的方法就是将其注释掉：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file_handle</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># keep the empty lines for now</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># if len(line) == 0:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#   continue</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">))</span>
</span></span></code></pre></div><p>也可以在执行过的代码后面添加注释。一些人习惯在代码之前添加注释，前者这种方法有时也是有用的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Reached this line&#34;</span><span class="p">)</span>  <span class="c1"># Simple status report</span>
</span></span></code></pre></div><h3 id="函数和对象方法调用">函数和对象方法调用</h3>
<p>你可以用圆括号调用函数，传递零个或几个参数，或者将返回值给一个变量：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="p">()</span>
</span></span></code></pre></div><p>几乎 Python 中的每个对象都有附加的函数，称作方法，可以用来访问对象的内容。可以用下面的语句调用：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">obj</span><span class="o">.</span><span class="n">some_method</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</span></span></code></pre></div><p>函数可以使用位置和关键词参数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>后面会有更多介绍。</p>
<h3 id="变量和参数传递">变量和参数传递</h3>
<p>当在 Python 中创建变量（或名字），你就在等号右边创建了一个对这个变量的引用。考虑一个整数列表：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span></code></pre></div><p>假设将<code>a</code>赋值给一个新变量<code>b</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
</span></span></code></pre></div><p>在有些方法中，这个赋值会将数据<code>[1, 2, 3]</code>也复制。在 Python 中，<code>a</code>和<code>b</code>实际上是同一个对象，即原有列表<code>[1, 2, 3]</code>（见图 2-7）。你可以在<code>a</code>中添加一个元素，然后检查<code>b</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-3e3a8c6b9c5040fc.png"
        data-srcset="img/7178691-3e3a8c6b9c5040fc.png, img/7178691-3e3a8c6b9c5040fc.png 1.5x, img/7178691-3e3a8c6b9c5040fc.png 2x"
        data-sizes="auto"
        alt="img/7178691-3e3a8c6b9c5040fc.png"
        title="图2-7 对同一对象的双重引用" /></p>
<p>理解 Python 的引用的含义，数据是何时、如何、为何复制的，是非常重要的。尤其是当你用 Python 处理大的数据集时。</p>
<blockquote>
<p>笔记：赋值也被称作绑定，我们是把一个名字绑定给一个对象。变量名有时可能被称为绑定变量。</p>
</blockquote>
<p>当你将对象作为参数传递给函数时，新的局域变量创建了对原始对象的引用，而不是复制。如果在函数里绑定一个新对象到一个变量，这个变动不会反映到上一层。因此可以改变可变参数的内容。假设有以下函数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">append_element</span><span class="p">(</span><span class="n">some_list</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">some_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</span></span></code></pre></div><p>然后有：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">append_element</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></span></code></pre></div><h3 id="动态引用强类型">动态引用，强类型</h3>
<p>与许多编译语言（如 JAVA 和 C++）对比，Python 中的对象引用不包含附属的类型。下面的代码是没有问题的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">str</span>
</span></span></code></pre></div><p>变量是在特殊命名空间中的对象的名字，类型信息保存在对象自身中。一些人可能会说 Python 不是“类型化语言”。这是不正确的，看下面的例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [16]: &#39;5&#39; + 5
</span></span><span class="line"><span class="cl">---------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">TypeError                                 Traceback (most recent call last)
</span></span><span class="line"><span class="cl">&lt;ipython-input-16-f9dbf5f0b234&gt; in &lt;module&gt;()
</span></span><span class="line"><span class="cl">----&gt; 1 &#39;5&#39; + 5
</span></span><span class="line"><span class="cl">TypeError: must be str, not int
</span></span></code></pre></div><p>在某些语言中，例如 Visual Basic，字符串<code>&quot;5&quot;</code>可能被默许转换（或投射）为整数，因此会产生 10。但在其它语言中，例如 JavaScript，整数 5 会被投射成字符串，结果是联结字符串<code>&quot;55&quot;</code>。在这个方面，Python 被认为是强类型化语言，意味着每个对象都有明确的类型（或类），默许转换只会发生在特定的情况下，例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [17]: a = 4.5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [18]: b = 2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># String formatting, to be visited later
</span></span><span class="line"><span class="cl">In [19]: print(&#39;a is {0}, b is {1}&#39;.format(type(a), type(b)))
</span></span><span class="line"><span class="cl">a is &lt;class &#39;float&#39;&gt;, b is &lt;class &#39;int&#39;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [20]: a / b
</span></span><span class="line"><span class="cl">Out[20]: 2.25
</span></span></code></pre></div><p>知道对象的类型很重要，最好能让函数可以处理多种类型的输入。你可以用<code>isinstance</code>函数检查对象是某个类型的实例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [21]: a = 5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [22]: isinstance(a, int)
</span></span><span class="line"><span class="cl">Out[22]: True
</span></span></code></pre></div><p><code>isinstance</code>可以用类型元组，检查对象的类型是否在元组中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [23]: a = 5; b = 4.5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [24]: isinstance(a, (int, float))
</span></span><span class="line"><span class="cl">Out[24]: True
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [25]: isinstance(b, (int, float))
</span></span><span class="line"><span class="cl">Out[25]: True
</span></span></code></pre></div><h3 id="属性和方法">属性和方法</h3>
<p>Python 的对象通常都有属性（其它存储在对象内部的 Python 对象）和方法（对象的附属函数可以访问对象的内部数据）。可以用<code>obj.attribute_name</code>访问属性和方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [1]: a = &#39;foo&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [2]: a.&lt;Press Tab&gt;
</span></span><span class="line"><span class="cl">a.capitalize  a.format      a.isupper     a.rindex      a.strip
</span></span><span class="line"><span class="cl">a.center      a.index       a.join        a.rjust       a.swapcase
</span></span><span class="line"><span class="cl">a.count       a.isalnum     a.ljust       a.rpartition  a.title
</span></span><span class="line"><span class="cl">a.decode      a.isalpha     a.lower       a.rsplit      a.translate
</span></span><span class="line"><span class="cl">a.encode      a.isdigit     a.lstrip      a.rstrip      a.upper
</span></span><span class="line"><span class="cl">a.endswith    a.islower     a.partition   a.split       a.zfill
</span></span><span class="line"><span class="cl">a.expandtabs  a.isspace     a.replace     a.splitlines
</span></span><span class="line"><span class="cl">a.find        a.istitle     a.rfind       a.startswith
</span></span></code></pre></div><p>也可以用<code>getattr</code>函数，通过名字访问属性和方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [27]: getattr(a, &#39;split&#39;)
</span></span><span class="line"><span class="cl">Out[27]: &lt;function str.split&gt;
</span></span></code></pre></div><p>在其它语言中，访问对象的名字通常称作“反射”。本书不会大量使用<code>getattr</code>函数和相关的<code>hasattr</code>和<code>setattr</code>函数，使用这些函数可以高效编写原生的、可重复使用的代码。</p>
<h3 id="鸭子类型">鸭子类型</h3>
<p>经常地，你可能不关心对象的类型，只关心对象是否有某些方法或用途。这通常被称为“鸭子类型”，来自“走起来像鸭子、叫起来像鸭子，那么它就是鸭子”的说法。例如，你可以通过验证一个对象是否遵循迭代协议，判断它是可迭代的。对于许多对象，这意味着它有一个<code>__iter__</code>魔术方法，其它更好的判断方法是使用<code>iter</code>函数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">isiterable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">iter</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c1"># not iterable</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span></code></pre></div><p>这个函数会返回字符串以及大多数 Python 集合类型为<code>True</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">In [29]: isiterable(&#39;a string&#39;)
</span></span><span class="line"><span class="cl">Out[29]: True
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [30]: isiterable([1, 2, 3])
</span></span><span class="line"><span class="cl">Out[30]: True
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [31]: isiterable(5)
</span></span><span class="line"><span class="cl">Out[31]: False
</span></span></code></pre></div><p>我总是用这个功能编写可以接受多种输入类型的函数。常见的例子是编写一个函数可以接受任意类型的序列（<code>list</code>、<code>tuple</code>、<code>ndarray</code>）或是迭代器。你可先检验对象是否是列表（或是 NUmPy 数组），如果不是的话，将其转变成列表：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="引入">引入</h3>
<p>在 Python 中，模块就是一个有<code>.py</code>扩展名、包含 Python 代码的文件。假设有以下模块：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># some_module.py</span>
</span></span><span class="line"><span class="cl"><span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></span></code></pre></div><p>如果想从同目录下的另一个文件访问<code>some_module.py</code>中定义的变量和函数，可以：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">some_module</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">some_module</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pi</span> <span class="o">=</span> <span class="n">some_module</span><span class="o">.</span><span class="n">PI</span>
</span></span></code></pre></div><p>或者：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">some_module</span> <span class="kn">import</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">PI</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">PI</span><span class="p">)</span>
</span></span></code></pre></div><p>使用<code>as</code>关键词，你可以给引入起不同的变量名：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">some_module</span> <span class="k">as</span> <span class="nn">sm</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">some_module</span> <span class="kn">import</span> <span class="n">PI</span> <span class="k">as</span> <span class="n">pi</span><span class="p">,</span> <span class="n">g</span> <span class="k">as</span> <span class="n">gf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r2</span> <span class="o">=</span> <span class="n">gf</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">pi</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="二元运算符和比较运算符">二元运算符和比较运算符</h3>
<p>大多数二元数学运算和比较都不难想到：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="mi">5</span> <span class="o">-</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="o">-</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="mi">12</span> <span class="o">+</span> <span class="mf">21.5</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="mf">33.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="mi">5</span> <span class="o">&lt;=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="kc">False</span>
</span></span></code></pre></div><p>表 2-3 列出了所有的二元运算符。</p>
<p>要判断两个引用是否指向同一个对象，可以使用<code>is</code>方法。<code>is not</code>可以判断两个对象是不同的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">a</span> <span class="ow">is</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="kc">True</span>
</span></span></code></pre></div><p>因为<code>list</code>总是创建一个新的 Python 列表（即复制），我们可以断定<code>c</code>是不同于<code>a</code>的。使用<code>is</code>比较与<code>==</code>运算符不同，如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">a</span> <span class="o">==</span> <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="kc">True</span>
</span></span></code></pre></div><p><code>is</code>和<code>is not</code>常用来判断一个变量是否为<code>None</code>，因为只有一个<code>None</code>的实例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="kc">True</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-9fb5f25b33166acf.png"
        data-srcset="img/7178691-9fb5f25b33166acf.png, img/7178691-9fb5f25b33166acf.png 1.5x, img/7178691-9fb5f25b33166acf.png 2x"
        data-sizes="auto"
        alt="img/7178691-9fb5f25b33166acf.png"
        title="表2-3 二元运算符" /></p>
<h3 id="可变与不可变对象">可变与不可变对象</h3>
<p>Python 中的大多数对象，比如列表、字典、NumPy 数组，和用户定义的类型（类），都是可变的。意味着这些对象或包含的值可以被修改：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">a_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">a_list</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
</span></span></code></pre></div><p>其它的，例如字符串和元组，是不可变的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">a_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">a_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;four&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">---------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">47</span><span class="o">-</span><span class="n">b7966a9ae0f1</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">a_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;four&#39;</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;tuple&#39;</span> <span class="nb">object</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">item</span> <span class="n">assignment</span>
</span></span></code></pre></div><p>记住，可以修改一个对象并不意味就要修改它。这被称为副作用。例如，当写一个函数，任何副作用都要在文档或注释中写明。如果可能的话，我推荐避免副作用，采用不可变的方式，即使要用到可变对象。</p>
<h3 id="标量类型">标量类型</h3>
<p>Python 的标准库中有一些内建的类型，用于处理数值数据、字符串、布尔值，和日期时间。这些单值类型被称为标量类型，本书中称其为标量。表 2-4 列出了主要的标量。日期和时间处理会另外讨论，因为它们是标准库的<code>datetime</code>模块提供的。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-27a30ac3e7d262a1.png"
        data-srcset="img/7178691-27a30ac3e7d262a1.png, img/7178691-27a30ac3e7d262a1.png 1.5x, img/7178691-27a30ac3e7d262a1.png 2x"
        data-sizes="auto"
        alt="img/7178691-27a30ac3e7d262a1.png"
        title="表2-4 Python的标量" /></p>
<h3 id="数值类型">数值类型</h3>
<p>Python 的主要数值类型是<code>int</code>和<code>float</code>。<code>int</code>可以存储任意大的数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">ival</span> <span class="o">=</span> <span class="mi">17239871</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">ival</span> <span class="o">**</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="mi">26254519291092456596965462913230729701102721</span>
</span></span></code></pre></div><p>浮点数使用 Python 的<code>float</code>类型。每个数都是双精度（64 位）的值。也可以用科学计数法表示：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">fval</span> <span class="o">=</span> <span class="mf">7.243</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">fval2</span> <span class="o">=</span> <span class="mf">6.78e-5</span>
</span></span></code></pre></div><p>不能得到整数的除法会得到浮点数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="mf">1.5</span>
</span></span></code></pre></div><p>要获得 C 风格的整除（去掉小数部分），可以使用底除运算符<code>//</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="mi">1</span>
</span></span></code></pre></div><h3 id="字符串">字符串</h3>
<p>许多人是因为 Python 强大而灵活的字符串处理而使用 Python 的。你可以用单引号或双引号来写字符串：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;one way of writing a string&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="s2">&#34;another way&#34;</span>
</span></span></code></pre></div><p>对于有换行符的字符串，可以使用三引号，&lsquo;&lsquo;&lsquo;或&quot;&ldquo;&ldquo;都行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">This is a longer string that
</span></span></span><span class="line"><span class="cl"><span class="s2">spans multiple lines
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>字符串<code>c</code>实际包含四行文本，<code>&quot;&quot;&quot;</code>后面和<code>lines</code>后面的换行符。可以用<code>count</code>方法计算<code>c</code>中的新的行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">c</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="mi">3</span>
</span></span></code></pre></div><p>Python 的字符串是不可变的，不能修改字符串：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;this is a string&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">---------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">57</span><span class="o">-</span><span class="mi">5</span><span class="n">ca625d1e504</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span> <span class="nb">object</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">item</span> <span class="n">assignment</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;longer string&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="s1">&#39;this is a longer string&#39;</span>
</span></span></code></pre></div><p>经过以上的操作，变量<code>a</code>并没有被修改：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="s1">&#39;this is a string&#39;</span>
</span></span></code></pre></div><p>许多 Python 对象使用<code>str</code>函数可以被转化为字符串：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">5.6</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mf">5.6</span>
</span></span></code></pre></div><p>字符串是一个序列的 Unicode 字符，因此可以像其它序列，比如列表和元组（下一章会详细介绍两者）一样处理：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;python&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="n">s</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="s1">&#39;pyt&#39;</span>
</span></span></code></pre></div><p>语法<code>s[:3]</code>被称作切片，适用于许多 Python 序列。后面会更详细的介绍，本书中用到很多切片。</p>
<p>反斜杠是转义字符，意思是它备用来表示特殊字符，比如换行符<code>\n</code>或 Unicode 字符。要写一个包含反斜杠的字符串，需要进行转义：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;12</span><span class="se">\\</span><span class="s1">34&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">12</span>\<span class="mi">34</span>
</span></span></code></pre></div><p>如果字符串中包含许多反斜杠，但没有特殊字符，这样做就很麻烦。幸好，可以在字符串前面加一个<code>r</code>，表明字符就是它自身：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;this\has\no\special\characters&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="s1">&#39;this</span><span class="se">\\</span><span class="s1">has</span><span class="se">\\</span><span class="s1">no</span><span class="se">\\</span><span class="s1">special</span><span class="se">\\</span><span class="s1">characters&#39;</span>
</span></span></code></pre></div><p><code>r</code>表示原始。</p>
<p>将两个字符串合并，会产生一个新的字符串：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;this is the first half &#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;and this is the second half&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="s1">&#39;this is the first half and this is the second half&#39;</span>
</span></span></code></pre></div><p>字符串的模板化或格式化，是另一个重要的主题。Python 3 拓展了此类的方法，这里只介绍一些。字符串对象有<code>format</code>方法，可以替换格式化的参数为字符串，产生一个新的字符串：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">]:</span> <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1"> </span><span class="si">{1:s}</span><span class="s1"> are worth US$</span><span class="si">{2:d}</span><span class="s1">&#39;</span>
</span></span></code></pre></div><p>在这个字符串中，</p>
<ul>
<li><code>{0:.2f}</code>表示格式化第一个参数为带有两位小数的浮点数。</li>
<li><code>{1:s}</code>表示格式化第二个参数为字符串。</li>
<li><code>{2:d}</code>表示格式化第三个参数为一个整数。</li>
</ul>
<p>要替换参数为这些格式化的参数，我们传递<code>format</code>方法一个序列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">75</span><span class="p">]:</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">4.5560</span><span class="p">,</span> <span class="s1">&#39;Argentine Pesos&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">75</span><span class="p">]:</span> <span class="s1">&#39;4.56 Argentine Pesos are worth US$1&#39;</span>
</span></span></code></pre></div><p>字符串格式化是一个很深的主题，有多种方法和大量的选项，可以控制字符串中的值是如何格式化的。推荐参阅 Python 官方文档。</p>
<p>这里概括介绍字符串处理，第 8 章的数据分析会详细介绍。</p>
<h3 id="字节和-unicode">字节和 Unicode</h3>
<p>在 Python 3 及以上版本中，Unicode 是一级的字符串类型，这样可以更一致的处理 ASCII 和非 ASCII 文本。在老的 Python 版本中，字符串都是字节，不使用 Unicode 编码。假如知道字符编码，可以将其转化为 Unicode。看一个例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">76</span><span class="p">]:</span> <span class="n">val</span> <span class="o">=</span> <span class="s2">&#34;español&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">77</span><span class="p">]:</span> <span class="n">val</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">77</span><span class="p">]:</span> <span class="s1">&#39;español&#39;</span>
</span></span></code></pre></div><p>可以用<code>encode</code>将这个 Unicode 字符串编码为 UTF-8：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="n">val_utf8</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">val_utf8</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;espa</span><span class="se">\xc3\xb1</span><span class="s1">ol&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">val_utf8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="nb">bytes</span>
</span></span></code></pre></div><p>如果你知道一个字节对象的 Unicode 编码，用<code>decode</code>方法可以解码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="n">val_utf8</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="s1">&#39;español&#39;</span>
</span></span></code></pre></div><p>虽然 UTF-8 编码已经变成主流，但因为历史的原因，你仍然可能碰到其它编码的数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="n">val</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;espa</span><span class="se">\xf1</span><span class="s1">ol&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="n">val</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-16&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff\xfe</span><span class="s1">e</span><span class="se">\x00</span><span class="s1">s</span><span class="se">\x00</span><span class="s1">p</span><span class="se">\x00</span><span class="s1">a</span><span class="se">\x00\xf1\x00</span><span class="s1">o</span><span class="se">\x00</span><span class="s1">l</span><span class="se">\x00</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="n">val</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-16le&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;e</span><span class="se">\x00</span><span class="s1">s</span><span class="se">\x00</span><span class="s1">p</span><span class="se">\x00</span><span class="s1">a</span><span class="se">\x00\xf1\x00</span><span class="s1">o</span><span class="se">\x00</span><span class="s1">l</span><span class="se">\x00</span><span class="s1">&#39;</span>
</span></span></code></pre></div><p>工作中碰到的文件很多都是字节对象，盲目地将所有数据编码为 Unicode 是不可取的。</p>
<p>虽然用的不多，你可以在字节文本的前面加上一个<code>b</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">85</span><span class="p">]:</span> <span class="n">bytes_val</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;this is bytes&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="n">bytes_val</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;this is bytes&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="n">decoded</span> <span class="o">=</span> <span class="n">bytes_val</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="n">decoded</span>  <span class="c1"># this is str (Unicode) now</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="s1">&#39;this is bytes&#39;</span>
</span></span></code></pre></div><h3 id="布尔值">布尔值</h3>
<p>Python 中的布尔值有两个，<code>True</code>和<code>False</code>。比较和其它条件表达式可以用<code>True</code>和<code>False</code>判断。布尔值可以与<code>and</code>和<code>or</code>结合使用：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="kc">True</span> <span class="ow">and</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="kc">False</span> <span class="ow">or</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="kc">True</span>
</span></span></code></pre></div><h3 id="类型转换">类型转换</h3>
<p><code>str</code>、<code>bool</code>、<code>int</code>和<code>float</code>也是函数，可以用来转换类型：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">91</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;3.14159&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">fval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">fval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="nb">float</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="n">fval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="kc">False</span>
</span></span></code></pre></div><h3 id="none"><code>None</code></h3>
<p><code>None</code>是 Python 的空值类型。如果一个函数没有明确的返回值，就会默认返回<code>None</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">97</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">98</span><span class="p">]:</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">98</span><span class="p">]:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">99</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">100</span><span class="p">]:</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">100</span><span class="p">]:</span> <span class="kc">True</span>
</span></span></code></pre></div><p><code>None</code>也常常作为函数的默认参数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_and_maybe_multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="n">c</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span></code></pre></div><p>另外，<code>None</code>不仅是一个保留字，还是唯一的<code>NoneType</code>的实例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">101</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">101</span><span class="p">]:</span> <span class="n">NoneType</span>
</span></span></code></pre></div><h3 id="日期和时间">日期和时间</h3>
<p>Python 内建的<code>datetime</code>模块提供了<code>datetime</code>、<code>date</code>和<code>time</code>类型。<code>datetime</code>类型结合了<code>date</code>和<code>time</code>，是最常使用的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">102</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">103</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">104</span><span class="p">]:</span> <span class="n">dt</span><span class="o">.</span><span class="n">day</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">104</span><span class="p">]:</span> <span class="mi">29</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">105</span><span class="p">]:</span> <span class="n">dt</span><span class="o">.</span><span class="n">minute</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">105</span><span class="p">]:</span> <span class="mi">30</span>
</span></span></code></pre></div><p>根据<code>datetime</code>实例，你可以用<code>date</code>和<code>time</code>提取出各自的对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">106</span><span class="p">]:</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">106</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">dt</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
</span></span></code></pre></div><p><code>strftime</code>方法可以将<code>datetime</code>格式化为字符串：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">108</span><span class="p">]:</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %H:%M&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">108</span><span class="p">]:</span> <span class="s1">&#39;10/29/2011 20:30&#39;</span>
</span></span></code></pre></div><p><code>strptime</code>可以将字符串转换成<code>datetime</code>对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;20091031&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></div><p>表 2-5 列出了所有的格式化命令。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-100f9a20c1536553.png"
        data-srcset="img/7178691-100f9a20c1536553.png, img/7178691-100f9a20c1536553.png 1.5x, img/7178691-100f9a20c1536553.png 2x"
        data-sizes="auto"
        alt="img/7178691-100f9a20c1536553.png"
        title="表2-5 Datetime格式化指令（与ISO C89兼容）" /></p>
<p>当你聚类或对时间序列进行分组，替换<code>datetime</code>的<code>time</code>字段有时会很有用。例如，用 0 替换分和秒：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></div><p>因为<code>datetime.datetime</code>是不可变类型，上面的方法会产生新的对象。</p>
<p>两个<code>datetime</code>对象的差会产生一个<code>datetime.timedelta</code>类型：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">111</span><span class="p">]:</span> <span class="n">dt2</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">dt2</span> <span class="o">-</span> <span class="n">dt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="n">delta</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7179</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span>
</span></span></code></pre></div><p>结果<code>timedelta(17, 7179)</code>指明了<code>timedelta</code>将 17 天、7179 秒的编码方式。</p>
<p>将<code>timedelta</code>添加到<code>datetime</code>，会产生一个新的偏移<code>datetime</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">dt</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">delta</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="控制流">控制流</h3>
<p>Python 有若干内建的关键字进行条件逻辑、循环和其它控制流操作。</p>
<h3 id="ifelif和else"><code>if</code>、<code>elif</code>和<code>else</code></h3>
<p><code>if</code>是最广为人知的控制流语句。它检查一个条件，如果为<code>True</code>，就执行后面的语句：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;It&#39;</span><span class="n">s</span> <span class="n">negative</span><span class="s1">&#39;)</span>
</span></span></code></pre></div><p><code>if</code>后面可以跟一个或多个<code>elif</code>，所有条件都是<code>False</code>时，还可以添加一个<code>else</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;It&#39;</span><span class="n">s</span> <span class="n">negative</span><span class="s1">&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Equal to zero&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Positive but smaller than 5&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Positive and larger than or equal to 5&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>如果某个条件为<code>True</code>，后面的<code>elif</code>就不会被执行。当使用<code>and</code>和<code>or</code>时，复合条件语句是从左到右执行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Made it&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Made</span> <span class="n">it</span>
</span></span></code></pre></div><p>在这个例子中，<code>c &gt; d</code>不会被执行，因为第一个比较是<code>True</code>：</p>
<p>也可以把比较式串在一起：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="mi">4</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="kc">True</span>
</span></span></code></pre></div><h3 id="for循环"><code>for</code>循环</h3>
<p><code>for</code>循环是在一个集合（列表或元组）中进行迭代，或者就是一个迭代器。<code>for</code>循环的标准语法是：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># do something with value</span>
</span></span></code></pre></div><p>你可以用<code>continue</code>使<code>for</code>循环提前，跳过剩下的部分。看下面这个例子，将一个列表中的整数相加，跳过<code>None</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="n">total</span> <span class="o">+=</span> <span class="n">value</span>
</span></span></code></pre></div><p>可以用<code>break</code>跳出<code>for</code>循环。下面的代码将各元素相加，直到遇到 5：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">total_until_5</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">total_until_5</span> <span class="o">+=</span> <span class="n">value</span>
</span></span></code></pre></div><p><code>break</code>只中断<code>for</code>循环的最内层，其余的<code>for</code>循环仍会运行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">121</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>     <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>         <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>             <span class="k">break</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>         <span class="nb">print</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></div><p>如果集合或迭代器中的元素序列（元组或列表），可以用<code>for</code>循环将其方便地拆分成变量：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># do something</span>
</span></span></code></pre></div><h3 id="while循环"><code>while</code>循环</h3>
<p><code>while</code>循环指定了条件和代码，当条件为<code>False</code>或用<code>break</code>退出循环，代码才会退出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">256</span>
</span></span><span class="line"><span class="cl"><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">total</span> <span class="o">+=</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">//</span> <span class="mi">2</span>
</span></span></code></pre></div><h3 id="pass"><code>pass</code></h3>
<p><code>pass</code>是 Python 中的非操作语句。代码块不需要任何动作时可以使用（作为未执行代码的占位符）；因为 Python 需要使用空白字符划定代码块，所以需要<code>pass</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;negative!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># TODO: put something smart here</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;positive!&#39;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="range"><code>range</code></h3>
<p><code>range</code>函数返回一个迭代器，它产生一个均匀分布的整数序列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">122</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">122</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
</span></span></code></pre></div><p><code>range</code>的三个参数是（起点，终点，步进）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">125</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">125</span><span class="p">]:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span></code></pre></div><p>可以看到，<code>range</code>产生的整数不包括终点。<code>range</code>的常见用法是用序号迭代序列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span></code></pre></div><p>可以使用<code>list</code>来存储<code>range</code>在其他数据结构中生成的所有整数，默认的迭代器形式通常是你想要的。下面的代码对 0 到 99999 中 3 或 5 的倍数求和：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># % is the modulo operator</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">sum</span> <span class="o">+=</span> <span class="n">i</span>
</span></span></code></pre></div><p>虽然<code>range</code>可以产生任意大的数，但任意时刻耗用的内存却很小。</p>
<h3 id="三元表达式">三元表达式</h3>
<p>Python 中的三元表达式可以将<code>if-else</code>语句放到一行里。语法如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="n">true</span><span class="o">-</span><span class="n">expr</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="n">false</span><span class="o">-</span><span class="n">expr</span>
</span></span></code></pre></div><p><code>true-expr</code>或<code>false-expr</code>可以是任何 Python 代码。它和下面的代码效果相同：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="n">true</span><span class="o">-</span><span class="n">expr</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="n">false</span><span class="o">-</span><span class="n">expr</span>
</span></span></code></pre></div><p>下面是一个更具体的例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">126</span><span class="p">]:</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">127</span><span class="p">]:</span> <span class="s1">&#39;Non-negative&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;Negative&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">127</span><span class="p">]:</span> <span class="s1">&#39;Non-negative&#39;</span>
</span></span></code></pre></div><p>和<code>if-else</code>一样，只有一个表达式会被执行。因此，三元表达式中的<code>if</code>和<code>else</code>可以包含大量的计算，但只有<code>True</code>的分支会被执行。因此，三元表达式中的<code>if</code>和<code>else</code>可以包含大量的计算，但只有<code>True</code>的分支会被执行。</p>
<p>虽然使用三元表达式可以压缩代码，但会降低代码可读性。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 0001-01-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://localhost:1313/posts/pyda-2e-zh/2/" data-title=""><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/pyda-2e-zh/2/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/posts/pyda-2e-zh/2/" data-title=""><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://localhost:1313/posts/pyda-2e-zh/2/" data-title=""><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://localhost:1313/posts/pyda-2e-zh/2/" data-title=""><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/pyda-2e-zh/3/" class="prev" rel="prev" title=""><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i></a>
            <a href="/posts/pyda-2e-zh/14/" class="next" rel="next" title=""><i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.118.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Aphros</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>

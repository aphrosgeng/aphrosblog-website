<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title> - Aphros的个人博客</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="" />
<meta property="og:description" content="第 5 章 pandas 入门 pandas 是本书后续内容的首选库。它含有使数据清洗和分析工作变得更快更简单的数据结构和操作工具。pandas 经常和其它工具一同使用，如数" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/pyda-2e-zh/5/" /><meta property="article:section" content="posts" />

<meta property="og:site_name" content="Aphros的博客" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="第 5 章 pandas 入门 pandas 是本书后续内容的首选库。它含有使数据清洗和分析工作变得更快更简单的数据结构和操作工具。pandas 经常和其它工具一同使用，如数"/>
<meta name="application-name" content="Aphros的博客">
<meta name="apple-mobile-web-app-title" content="Aphros的博客"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/posts/pyda-2e-zh/5/" /><link rel="prev" href="http://localhost:1313/posts/pyda-2e-zh/6/" /><link rel="next" href="http://localhost:1313/posts/pyda-2e-zh/4/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/pyda-2e-zh\/5\/"
        },"genre": "posts","wordcount":  12163 ,
        "url": "http:\/\/localhost:1313\/posts\/pyda-2e-zh\/5\/","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Aphros"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Aphros的个人博客">Aphros的博客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Aphros的个人博客">Aphros的博客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX"></h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Aphros</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="0001-01-01">0001-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;12163 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;25 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#series"><code>Series</code></a></li>
    <li><a href="#dataframe"><code>DataFrame</code></a></li>
    <li><a href="#索引对象">索引对象</a></li>
  </ul>

  <ul>
    <li><a href="#重新索引">重新索引</a></li>
    <li><a href="#丢弃指定轴上的项">丢弃指定轴上的项</a></li>
    <li><a href="#索引选取和过滤">索引、选取和过滤</a></li>
    <li><a href="#用loc和iloc进行选取">用<code>loc</code>和<code>iloc</code>进行选取</a></li>
    <li><a href="#整数索引">整数索引</a></li>
    <li><a href="#算术运算和数据对齐">算术运算和数据对齐</a></li>
    <li><a href="#在算术方法中填充值">在算术方法中填充值</a></li>
    <li><a href="#dataframe和series之间的运算"><code>DataFrame</code>和<code>Series</code>之间的运算</a></li>
    <li><a href="#函数应用和映射">函数应用和映射</a></li>
    <li><a href="#排序和排名">排序和排名</a></li>
    <li><a href="#带有重复标签的轴索引">带有重复标签的轴索引</a></li>
  </ul>

  <ul>
    <li><a href="#相关系数与协方差">相关系数与协方差</a></li>
    <li><a href="#唯一值值计数以及成员资格">唯一值、值计数以及成员资格</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="第-5-章-pandas-入门">第 5 章 pandas 入门</h1>
<p>pandas 是本书后续内容的首选库。它含有使数据清洗和分析工作变得更快更简单的数据结构和操作工具。pandas 经常和其它工具一同使用，如数值计算工具 NumPy 和 SciPy，分析库 statsmodels 和 scikit-learn，和数据可视化库 matplotlib。pandas 是基于 NumPy 数组构建的，特别是基于数组的函数和不使用<code>for</code>循环的数据处理。</p>
<p>虽然 pandas 采用了大量的 NumPy 编码风格，但二者最大的不同是 pandas 是专门为处理表格和混杂数据设计的。而 NumPy 更适合处理统一的数值数组数据。</p>
<p>自从 2010 年 pandas 开源以来，pandas 逐渐成长为一个非常大的库，应用于许多真实案例。开发者社区已经有了 800 个独立的贡献者，他们在解决日常数据问题的同时为这个项目提供贡献。</p>
<p>在本书后续部分中，我将使用下面这样的 pandas 引入约定：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span></code></pre></div><p>因此，只要你在代码中看到 pd.，就得想到这是 pandas。因为<code>Series</code>和<code>DataFrame</code>用的次数非常多，所以将其引入本地命名空间中会更方便：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Series</span><span class="p">,</span> <span class="n">DataFrame</span>
</span></span></code></pre></div><h1 id="51-pandas-的数据结构介绍">5.1 pandas 的数据结构介绍</h1>
<p>要使用 pandas，你首先就得熟悉它的两个主要数据结构：<code>Series</code>和<code>DataFrame</code>。虽然它们并不能解决所有问题，但它们为大多数应用提供了一种可靠的、易于使用的基础。</p>
<h2 id="series"><code>Series</code></h2>
<p><code>Series</code>是一种类似于一维数组的对象，它由一组数据（各种 NumPy 数据类型）以及一组与之相关的数据标签（即索引）组成。仅由一组数据即可产生最简单的<code>Series</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="o">-</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p><code>Series</code>的字符串表现形式为：索引在左边，值在右边。由于我们没有为数据指定索引，于是会自动创建一个 0 到<code>N-1</code>（<code>N</code>为数据的长度）的整数型索引。你可以通过<code>Series</code>的<code>values</code>和<code>index</code>属性获取其数组表示形式和索引对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">index</span>  <span class="c1"># like range(4)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">RangeIndex</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></div><p>通常，我们希望所创建的<code>Series</code>带有一个可以对各个数据点进行标记的索引：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">obj2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">obj2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="o">-</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">obj2</span><span class="o">.</span><span class="n">index</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>与普通 NumPy 数组相比，你可以通过索引的方式选取<code>Series</code>中的单个或一组值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">obj2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="o">-</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">obj2</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">obj2</span><span class="p">[[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="o">-</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p><code>['c', 'a', 'd']</code>是索引列表，即使它包含的是字符串而不是整数。</p>
<p>使用 NumPy 函数或类似 NumPy 的运算（如根据布尔型数组进行过滤、标量乘法、应用数学函数等）都会保留索引值的链接：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">obj2</span><span class="p">[</span><span class="n">obj2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">obj2</span> <span class="o">*</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">12</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">14</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="o">-</span><span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>     <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">d</span>     <span class="mf">403.428793</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1096.633158</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>       <span class="mf">0.006738</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>      <span class="mf">20.085537</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>还可以将<code>Series</code>看成是一个定长的有序字典，因为它是索引值到数据值的一个映射。它可以用在许多原本需要字典参数的函数中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="s1">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">obj2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="s1">&#39;e&#39;</span> <span class="ow">in</span> <span class="n">obj2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="kc">False</span>
</span></span></code></pre></div><p>如果数据被存放在一个 Python 字典中，也可以直接通过这个字典来创建<code>Series</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">sdata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Ohio&#39;</span><span class="p">:</span> <span class="mi">35000</span><span class="p">,</span> <span class="s1">&#39;Texas&#39;</span><span class="p">:</span> <span class="mi">71000</span><span class="p">,</span> <span class="s1">&#39;Oregon&#39;</span><span class="p">:</span> <span class="mi">16000</span><span class="p">,</span> <span class="s1">&#39;Utah&#39;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">obj3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sdata</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">obj3</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>      <span class="mi">35000</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>    <span class="mi">16000</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>     <span class="mi">71000</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>       <span class="mi">5000</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p>如果只传入一个字典，则结果<code>Series</code>中的索引就是原字典的键（有序排列）。你可以传入排好序的字典的键以改变顺序：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;California&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Oregon&#39;</span><span class="p">,</span> <span class="s1">&#39;Texas&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">obj4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sdata</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">obj4</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">California</span>        <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>          <span class="mf">35000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>        <span class="mf">16000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>         <span class="mf">71000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>在这个例子中，<code>sdata</code>中跟<code>states</code>索引相匹配的那 3 个值会被找出来并放到相应的位置上，但由于<code>&quot;California&quot;</code>所对应的<code>sdata</code>值找不到，所以其结果就为<code>NaN</code>（即“非数字”（not a number），在 pandas 中，它用于表示缺失或 NA 值）。因为<code>Utah</code>不在<code>states</code>中，它被从结果中除去。</p>
<p>我将使用缺失（missing）或 NA 表示缺失数据。pandas 的<code>isnull</code>和<code>notnull</code>函数可用于检测缺失数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">obj4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">California</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>          <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>        <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>         <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">obj4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">California</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>           <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>         <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>          <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>
</span></span></code></pre></div><p><code>Series</code>也有类似的实例方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">obj4</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">California</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>          <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>        <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>         <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>
</span></span></code></pre></div><p>我将在第 7 章详细讲解如何处理缺失数据。</p>
<p>对于许多应用而言，<code>Series</code>最重要的一个功能是，它会根据运算的索引标签自动对齐数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">obj3</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>      <span class="mi">35000</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>    <span class="mi">16000</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>     <span class="mi">71000</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>       <span class="mi">5000</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">obj4</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">36</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">California</span>        <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>          <span class="mf">35000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>        <span class="mf">16000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>         <span class="mf">71000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">obj3</span> <span class="o">+</span> <span class="n">obj4</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">California</span>         <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>           <span class="mf">70000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>         <span class="mf">32000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>         <span class="mf">142000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>               <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>数据对齐功能将在后面详细讲解。如果你使用过数据库，你可以认为是类似<code>join</code>的操作。</p>
<p><code>Series</code>对象本身及其索引都有一个<code>name</code>属性，该属性跟 pandas 其他的关键功能关系非常密切：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">obj4</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;population&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">obj4</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;state&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">obj4</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>
</span></span><span class="line"><span class="cl"><span class="n">California</span>        <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>          <span class="mf">35000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>        <span class="mf">16000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>         <span class="mf">71000.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">population</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p><code>Series</code>的索引可以通过赋值的方式就地修改：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="o">-</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Steve&#39;</span><span class="p">,</span> <span class="s1">&#39;Jeff&#39;</span><span class="p">,</span> <span class="s1">&#39;Ryan&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">Bob</span>      <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">Steve</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Jeff</span>    <span class="o">-</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">Ryan</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><h2 id="dataframe"><code>DataFrame</code></h2>
<p><code>DataFrame</code>是一个表格型的数据结构，它含有一组有序的列，每列可以是不同的值类型（数值、字符串、布尔值等）。<code>DataFrame</code>既有行索引也有列索引，它可以被看做由<code>Series</code>组成的字典（共用同一个索引）。<code>DataFrame</code>中的数据是以一个或多个二维块存放的（而不是列表、字典或别的一维数据结构）。有关<code>DataFrame</code>内部的技术细节远远超出了本书所讨论的范围。</p>
<blockquote>
<p>笔记：虽然<code>DataFrame</code>是以二维结构保存数据的，但你仍然可以轻松地将其表示为更高维度的数据（层次化索引的表格型结构，这是 pandas 中许多高级数据处理功能的关键要素，我们会在第 8 章讨论这个问题）。</p>
</blockquote>
<p>建<code>DataFrame</code>的办法有很多，最常用的一种是直接传入一个由等长列表或 NumPy 数组组成的字典：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2003</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.9</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl"><span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span></code></pre></div><p>结果<code>DataFrame</code>会自动加上索引（跟<code>Series</code>一样），且全部列会被有序排列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">45</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">pop</span>   <span class="n">state</span>  <span class="n">year</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.5</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">1.7</span>    <span class="n">Ohio</span>  <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">3.6</span>    <span class="n">Ohio</span>  <span class="mi">2002</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">2.4</span>  <span class="n">Nevada</span>  <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">2.9</span>  <span class="n">Nevada</span>  <span class="mi">2002</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="mf">3.2</span>  <span class="n">Nevada</span>  <span class="mi">2003</span>
</span></span></code></pre></div><p>如果你使用的是 Jupyter 笔记本，pandas <code>DataFrame</code>对象会以对浏览器友好的 HTML 表格的方式呈现。</p>
<p>对于特别大的<code>DataFrame</code>，<code>head</code>方法会选取前五行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">46</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">pop</span>   <span class="n">state</span>  <span class="n">year</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.5</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">1.7</span>    <span class="n">Ohio</span>  <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">3.6</span>    <span class="n">Ohio</span>  <span class="mi">2002</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">2.4</span>  <span class="n">Nevada</span>  <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">2.9</span>  <span class="n">Nevada</span>  <span class="mi">2002</span>
</span></span></code></pre></div><p>如果指定了列序列，则<code>DataFrame</code>的列就会按照指定顺序进行排列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">year</span>   <span class="n">state</span>  <span class="n">pop</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">2000</span>    <span class="n">Ohio</span>  <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">2001</span>    <span class="n">Ohio</span>  <span class="mf">1.7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mi">2002</span>    <span class="n">Ohio</span>  <span class="mf">3.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mi">2001</span>  <span class="n">Nevada</span>  <span class="mf">2.4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mi">2002</span>  <span class="n">Nevada</span>  <span class="mf">2.9</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="mi">2003</span>  <span class="n">Nevada</span>  <span class="mf">3.2</span>
</span></span></code></pre></div><p>如果传入的列在数据中找不到，就会在结果中产生缺失值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">frame2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">,</span> <span class="s1">&#39;debt&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                              <span class="s1">&#39;five&#39;</span><span class="p">,</span> <span class="s1">&#39;six&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">frame2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">year</span>   <span class="n">state</span>  <span class="n">pop</span> <span class="n">debt</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mi">2000</span>    <span class="n">Ohio</span>  <span class="mf">1.5</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="mi">2001</span>    <span class="n">Ohio</span>  <span class="mf">1.7</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="mi">2002</span>    <span class="n">Ohio</span>  <span class="mf">3.6</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">four</span>   <span class="mi">2001</span>  <span class="n">Nevada</span>  <span class="mf">2.4</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">five</span>   <span class="mi">2002</span>  <span class="n">Nevada</span>  <span class="mf">2.9</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">six</span>    <span class="mi">2003</span>  <span class="n">Nevada</span>  <span class="mf">3.2</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">frame2</span><span class="o">.</span><span class="n">columns</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">,</span> <span class="s1">&#39;debt&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>通过类似字典标记的方式或属性的方式，可以将<code>DataFrame</code>的列获取为一个<code>Series</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">frame2</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">51</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>        <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>        <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>      <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="n">four</span>     <span class="n">Nevada</span>
</span></span><span class="line"><span class="cl"><span class="n">five</span>     <span class="n">Nevada</span>
</span></span><span class="line"><span class="cl"><span class="n">six</span>      <span class="n">Nevada</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">frame2</span><span class="o">.</span><span class="n">year</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>      <span class="mi">2000</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>      <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>    <span class="mi">2002</span>
</span></span><span class="line"><span class="cl"><span class="n">four</span>     <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="n">five</span>     <span class="mi">2002</span>
</span></span><span class="line"><span class="cl"><span class="n">six</span>      <span class="mi">2003</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><blockquote>
<p>笔记：IPython 提供了类似属性的访问（即<code>frame2.year</code>）和<code>Tab</code>补全。
<code>frame2[column]</code>适用于任何列的名，但是<code>frame2.column</code>只有在列名是一个合理的 Python 变量名时才适用。</p>
</blockquote>
<p>注意，返回的<code>Series</code>拥有原<code>DataFrame</code>相同的索引，且其<code>name</code>属性也已经被相应地设置好了。</p>
<p>行也可以通过位置或名称的方式进行获取，比如用<code>loc</code>属性（稍后将对此进行详细讲解）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">frame2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">year</span>     <span class="mi">2002</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span>    <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="n">pop</span>       <span class="mf">3.6</span>
</span></span><span class="line"><span class="cl"><span class="n">debt</span>      <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">three</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span></code></pre></div><p>列可以通过赋值的方式进行修改。例如，我们可以给那个空的&quot;debt&quot;列赋上一个标量值或一组值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">frame2</span><span class="p">[</span><span class="s1">&#39;debt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">16.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">frame2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">year</span>   <span class="n">state</span>  <span class="n">pop</span>  <span class="n">debt</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mi">2000</span>    <span class="n">Ohio</span>  <span class="mf">1.5</span>  <span class="mf">16.5</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="mi">2001</span>    <span class="n">Ohio</span>  <span class="mf">1.7</span>  <span class="mf">16.5</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="mi">2002</span>    <span class="n">Ohio</span>  <span class="mf">3.6</span>  <span class="mf">16.5</span>
</span></span><span class="line"><span class="cl"><span class="n">four</span>   <span class="mi">2001</span>  <span class="n">Nevada</span>  <span class="mf">2.4</span>  <span class="mf">16.5</span>
</span></span><span class="line"><span class="cl"><span class="n">five</span>   <span class="mi">2002</span>  <span class="n">Nevada</span>  <span class="mf">2.9</span>  <span class="mf">16.5</span>
</span></span><span class="line"><span class="cl"><span class="n">six</span>    <span class="mi">2003</span>  <span class="n">Nevada</span>  <span class="mf">3.2</span>  <span class="mf">16.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">frame2</span><span class="p">[</span><span class="s1">&#39;debt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">6.</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">frame2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">57</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">year</span>   <span class="n">state</span>  <span class="n">pop</span>  <span class="n">debt</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mi">2000</span>    <span class="n">Ohio</span>  <span class="mf">1.5</span>   <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="mi">2001</span>    <span class="n">Ohio</span>  <span class="mf">1.7</span>   <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="mi">2002</span>    <span class="n">Ohio</span>  <span class="mf">3.6</span>   <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">four</span>   <span class="mi">2001</span>  <span class="n">Nevada</span>  <span class="mf">2.4</span>   <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">five</span>   <span class="mi">2002</span>  <span class="n">Nevada</span>  <span class="mf">2.9</span>   <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">six</span>    <span class="mi">2003</span>  <span class="n">Nevada</span>  <span class="mf">3.2</span>   <span class="mf">5.0</span>
</span></span></code></pre></div><p>将列表或数组赋值给某个列时，其长度必须跟<code>DataFrame</code>的长度相匹配。如果赋值的是一个<code>Series</code>，就会精确匹配<code>DataFrame</code>的索引，所有的空位都将被填上缺失值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">val</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">,</span> <span class="s1">&#39;five&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">frame2</span><span class="p">[</span><span class="s1">&#39;debt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">frame2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">60</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">year</span>   <span class="n">state</span>  <span class="n">pop</span>  <span class="n">debt</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mi">2000</span>    <span class="n">Ohio</span>  <span class="mf">1.5</span>   <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="mi">2001</span>    <span class="n">Ohio</span>  <span class="mf">1.7</span>  <span class="o">-</span><span class="mf">1.2</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="mi">2002</span>    <span class="n">Ohio</span>  <span class="mf">3.6</span>   <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">four</span>   <span class="mi">2001</span>  <span class="n">Nevada</span>  <span class="mf">2.4</span>  <span class="o">-</span><span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="n">five</span>   <span class="mi">2002</span>  <span class="n">Nevada</span>  <span class="mf">2.9</span>  <span class="o">-</span><span class="mf">1.7</span>
</span></span><span class="line"><span class="cl"><span class="n">six</span>    <span class="mi">2003</span>  <span class="n">Nevada</span>  <span class="mf">3.2</span>   <span class="n">NaN</span>
</span></span></code></pre></div><p>为不存在的列赋值会创建出一个新列。关键字<code>del</code>用于删除列。</p>
<p>作为<code>del</code>的例子，我先添加一个新的布尔值的列，<code>state</code>是否为<code>'Ohio'</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">frame2</span><span class="p">[</span><span class="s1">&#39;eastern&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame2</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;Ohio&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="n">frame2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">62</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">year</span>   <span class="n">state</span>  <span class="n">pop</span>  <span class="n">debt</span>  <span class="n">eastern</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mi">2000</span>    <span class="n">Ohio</span>  <span class="mf">1.5</span>   <span class="n">NaN</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="mi">2001</span>    <span class="n">Ohio</span>  <span class="mf">1.7</span>  <span class="o">-</span><span class="mf">1.2</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="mi">2002</span>    <span class="n">Ohio</span>  <span class="mf">3.6</span>   <span class="n">NaN</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">four</span>   <span class="mi">2001</span>  <span class="n">Nevada</span>  <span class="mf">2.4</span>  <span class="o">-</span><span class="mf">1.5</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">five</span>   <span class="mi">2002</span>  <span class="n">Nevada</span>  <span class="mf">2.9</span>  <span class="o">-</span><span class="mf">1.7</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">six</span>    <span class="mi">2003</span>  <span class="n">Nevada</span>  <span class="mf">3.2</span>   <span class="n">NaN</span>    <span class="kc">False</span>
</span></span></code></pre></div><blockquote>
<p>注意：不能用<code>frame2.eastern</code>创建新的列。</p>
</blockquote>
<p><code>del</code>方法可以用来删除这列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="k">del</span> <span class="n">frame2</span><span class="p">[</span><span class="s1">&#39;eastern&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">frame2</span><span class="o">.</span><span class="n">columns</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">,</span> <span class="s1">&#39;debt&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>注意：通过索引方式返回的列只是相应数据的视图而已，并不是副本。因此，对返回的<code>Series</code>所做的任何就地修改全都会反映到源<code>DataFrame</code>上。通过<code>Series</code>的<code>copy</code>方法即可指定复制列。</p>
</blockquote>
<p>另一种常见的数据形式是嵌套字典：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="n">pop</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Nevada&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2001</span><span class="p">:</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mi">2002</span><span class="p">:</span> <span class="mf">2.9</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="o">....</span><span class="p">:</span>        <span class="s1">&#39;Ohio&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2000</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2001</span><span class="p">:</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mi">2002</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">}}</span>
</span></span></code></pre></div><p>如果嵌套字典传给<code>DataFrame</code>，pandas 就会被解释为：外层字典的键作为列，内层键则作为行索引：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="n">frame3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">frame3</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">67</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">      <span class="n">Nevada</span>  <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="mi">2000</span>     <span class="n">NaN</span>   <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2001</span>     <span class="mf">2.4</span>   <span class="mf">1.7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2002</span>     <span class="mf">2.9</span>   <span class="mf">3.6</span>
</span></span></code></pre></div><p>你也可以使用类似 NumPy 数组的方法，对<code>DataFrame</code>进行转置（交换行和列）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="n">frame3</span><span class="o">.</span><span class="n">T</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">68</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">        <span class="mi">2000</span>  <span class="mi">2001</span>  <span class="mi">2002</span>
</span></span><span class="line"><span class="cl"><span class="n">Nevada</span>   <span class="n">NaN</span>   <span class="mf">2.4</span>   <span class="mf">2.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>     <span class="mf">1.5</span>   <span class="mf">1.7</span>   <span class="mf">3.6</span>
</span></span></code></pre></div><p>内层字典的键会被合并、排序以形成最终的索引。如果明确指定了索引，则不会这样：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2003</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">69</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">      <span class="n">Nevada</span>  <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="mi">2001</span>     <span class="mf">2.4</span>   <span class="mf">1.7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2002</span>     <span class="mf">2.9</span>   <span class="mf">3.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">2003</span>     <span class="n">NaN</span>   <span class="n">NaN</span>
</span></span></code></pre></div><p>由<code>Series</code>组成的字典差不多也是一样的用法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">pdata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Ohio&#39;</span><span class="p">:</span> <span class="n">frame3</span><span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="o">....</span><span class="p">:</span>          <span class="s1">&#39;Nevada&#39;</span><span class="p">:</span> <span class="n">frame3</span><span class="p">[</span><span class="s1">&#39;Nevada&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pdata</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">71</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">      <span class="n">Nevada</span>  <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="mi">2000</span>     <span class="n">NaN</span>   <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2001</span>     <span class="mf">2.4</span>   <span class="mf">1.7</span>
</span></span></code></pre></div><p>表 5-1 列出了<code>DataFrame</code>构造函数所能接受的各种数据。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-106835b28c0cea5a.png"
        data-srcset="img/7178691-106835b28c0cea5a.png, img/7178691-106835b28c0cea5a.png 1.5x, img/7178691-106835b28c0cea5a.png 2x"
        data-sizes="auto"
        alt="img/7178691-106835b28c0cea5a.png"
        title="img/7178691-106835b28c0cea5a.png" /></p>
<p>如果设置了<code>DataFrame</code>的<code>index</code>和<code>columns</code>的<code>name</code>属性，则这些信息也会被显示出来：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span> <span class="n">frame3</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;year&#39;</span><span class="p">;</span> <span class="n">frame3</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;state&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="n">frame3</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">73</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>  <span class="n">Nevada</span>  <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="n">year</span>
</span></span><span class="line"><span class="cl"><span class="mi">2000</span>      <span class="n">NaN</span>   <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2001</span>      <span class="mf">2.4</span>   <span class="mf">1.7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2002</span>      <span class="mf">2.9</span>   <span class="mf">3.6</span>
</span></span></code></pre></div><p>跟<code>Series</code>一样，<code>values</code>属性也会以二维<code>ndarray</code>的形式返回<code>DataFrame</code>中的数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">]:</span> <span class="n">frame3</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">74</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">array</span><span class="p">([[</span> <span class="n">nan</span><span class="p">,</span>  <span class="mf">1.5</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mf">2.4</span><span class="p">,</span>  <span class="mf">1.7</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mf">2.9</span><span class="p">,</span>  <span class="mf">3.6</span><span class="p">]])</span>
</span></span></code></pre></div><p>如果<code>DataFrame</code>各列的数据类型不同，则值数组的<code>dtype</code>就会选用能兼容所有列的数据类型：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">75</span><span class="p">]:</span> <span class="n">frame2</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">75</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">array</span><span class="p">([[</span><span class="mi">2000</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span><span class="mi">2001</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span><span class="mi">2002</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span><span class="mi">2001</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span><span class="mi">2002</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="mf">2.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span><span class="mi">2003</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="n">nan</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="索引对象">索引对象</h2>
<p>pandas 的索引对象负责管理轴标签和其他元数据（比如轴名称等）。构建<code>Series</code>或<code>DataFrame</code>时，所用到的任何数组或其他序列的标签都会被转换成一个<code>Index</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">76</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">77</span><span class="p">]:</span> <span class="n">index</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">index</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="n">index</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p><code>Index</code>对象是不可变的，因此用户不能对其进行修改：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span>  <span class="c1"># TypeError</span>
</span></span></code></pre></div><p>不可变可以使<code>Index</code>对象在多个数据结构之间安全共享：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="n">labels</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="n">Int64Index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="n">obj2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="n">obj2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">83</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="o">-</span><span class="mf">2.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="n">obj2</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="n">labels</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="kc">True</span>
</span></span></code></pre></div><blockquote>
<p>注意：虽然用户不需要经常使用<code>Index</code>的功能，但是因为一些操作会生成包含被索引化的数据，理解它们的工作原理是很重要的。</p>
</blockquote>
<p>除了类似于数组，<code>Index</code>的功能也类似一个固定大小的集合：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">85</span><span class="p">]:</span> <span class="n">frame3</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">85</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>  <span class="n">Nevada</span>  <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="n">year</span>               
</span></span><span class="line"><span class="cl"><span class="mi">2000</span>      <span class="n">NaN</span>   <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2001</span>      <span class="mf">2.4</span>   <span class="mf">1.7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2002</span>      <span class="mf">2.9</span>   <span class="mf">3.6</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="n">frame3</span><span class="o">.</span><span class="n">columns</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="s1">&#39;Ohio&#39;</span> <span class="ow">in</span> <span class="n">frame3</span><span class="o">.</span><span class="n">columns</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="mi">2003</span> <span class="ow">in</span> <span class="n">frame3</span><span class="o">.</span><span class="n">index</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="kc">False</span>
</span></span></code></pre></div><p>与 python 的集合不同，pandas 的<code>Index</code>可以包含重复的标签：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="n">dup_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="n">dup_labels</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>选择重复的标签，会显示所有的结果。</p>
<p>每个索引都有一些方法和属性，它们可用于设置逻辑并回答有关该索引所包含的数据的常见问题。表 5-2 列出了这些函数。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-5499d14f0e2cd639.jpg"
        data-srcset="img/7178691-5499d14f0e2cd639.jpg, img/7178691-5499d14f0e2cd639.jpg 1.5x, img/7178691-5499d14f0e2cd639.jpg 2x"
        data-sizes="auto"
        alt="img/7178691-5499d14f0e2cd639.jpg"
        title="img/7178691-5499d14f0e2cd639.jpg" /></p>
<h1 id="52-基本功能">5.2 基本功能</h1>
<p>本节中，我将介绍操作<code>Series</code>和<code>DataFrame</code>中的数据的基本手段。后续章节将更加深入地挖掘 pandas 在数据分析和处理方面的功能。本书不是 pandas 库的详尽文档，主要关注的是最重要的功能，那些不大常用的内容（也就是那些更深奥的内容）就交给你自己去摸索吧。</p>
<h2 id="重新索引">重新索引</h2>
<p>pandas 对象的一个重要方法是<code>reindex</code>，其作用是创建一个新对象，它的数据符合新的索引。看下面的例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">91</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.3</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">92</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">7.2</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="o">-</span><span class="mf">5.3</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">3.6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>用该<code>Series</code>的<code>reindex</code>将会根据新索引进行重排。如果某个索引值当前不存在，就引入缺失值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="n">obj2</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="n">obj2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">94</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="o">-</span><span class="mf">5.3</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">7.2</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">3.6</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>对于时间序列这样的有序数据，重新索引时可能需要做一些插值处理。<code>method</code>选项即可达到此目的，例如，使用<code>ffill</code>可以实现前向值填充：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="n">obj3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="n">obj3</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">96</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="n">blue</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">purple</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="n">yellow</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">97</span><span class="p">]:</span> <span class="n">obj3</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">97</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="n">blue</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="n">blue</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">purple</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="n">purple</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="n">yellow</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="n">yellow</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span></code></pre></div><p>借助<code>DataFrame</code>，<code>reindex</code>可以修改（行）索引和列。只传递一个序列时，会重新索引结果的行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">98</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Texas&#39;</span><span class="p">,</span> <span class="s1">&#39;California&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">99</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">99</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Texas</span>  <span class="n">California</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>     <span class="mi">0</span>      <span class="mi">1</span>           <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>     <span class="mi">3</span>      <span class="mi">4</span>           <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>     <span class="mi">6</span>      <span class="mi">7</span>           <span class="mi">8</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">100</span><span class="p">]:</span> <span class="n">frame2</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">101</span><span class="p">]:</span> <span class="n">frame2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">101</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Texas</span>  <span class="n">California</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">0.0</span>    <span class="mf">1.0</span>         <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>   <span class="n">NaN</span>    <span class="n">NaN</span>         <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>    <span class="mf">4.0</span>         <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>   <span class="mf">6.0</span>    <span class="mf">7.0</span>         <span class="mf">8.0</span>
</span></span></code></pre></div><p>列可以用<code>columns</code>关键字重新索引：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">102</span><span class="p">]:</span> <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Texas&#39;</span><span class="p">,</span> <span class="s1">&#39;Utah&#39;</span><span class="p">,</span> <span class="s1">&#39;California&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">103</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">103</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Texas</span>  <span class="n">Utah</span>  <span class="n">California</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>      <span class="mi">1</span>   <span class="n">NaN</span>           <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>      <span class="mi">4</span>   <span class="n">NaN</span>           <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>      <span class="mi">7</span>   <span class="n">NaN</span>           <span class="mi">8</span>
</span></span></code></pre></div><p>表 5-3 列出了<code>reindex</code>函数的各参数及说明。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-efa3dbd4b83c61ec.jpg"
        data-srcset="img/7178691-efa3dbd4b83c61ec.jpg, img/7178691-efa3dbd4b83c61ec.jpg 1.5x, img/7178691-efa3dbd4b83c61ec.jpg 2x"
        data-sizes="auto"
        alt="img/7178691-efa3dbd4b83c61ec.jpg"
        title="img/7178691-efa3dbd4b83c61ec.jpg" /></p>
<h2 id="丢弃指定轴上的项">丢弃指定轴上的项</h2>
<p>丢弃某条轴上的一个或多个项很简单，只要有一个索引数组或列表即可。由于需要执行一些数据整理和集合逻辑，所以<code>drop</code>方法返回的是一个在指定轴上删除了指定值的新对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">105</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">5.</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">106</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">106</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">new_obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">108</span><span class="p">]:</span> <span class="n">new_obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">108</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">109</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>对于<code>DataFrame</code>，可以删除任意轴上的索引值。为了演示，先新建一个<code>DataFrame</code>例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Colorado&#39;</span><span class="p">,</span> <span class="s1">&#39;Utah&#39;</span><span class="p">,</span> <span class="s1">&#39;New York&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">111</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">111</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>  <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>    <span class="mi">1</span>      <span class="mi">2</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">4</span>    <span class="mi">5</span>      <span class="mi">6</span>     <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">8</span>    <span class="mi">9</span>     <span class="mi">10</span>    <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>   <span class="mi">12</span>   <span class="mi">13</span>     <span class="mi">14</span>    <span class="mi">15</span>
</span></span></code></pre></div><p>用标签序列调用<code>drop</code>会从行标签（轴 0）删除值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Colorado&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">112</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>  <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">8</span>    <span class="mi">9</span>     <span class="mi">10</span>    <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>   <span class="mi">12</span>   <span class="mi">13</span>     <span class="mi">14</span>    <span class="mi">15</span>
</span></span></code></pre></div><p>通过传递<code>axis=1</code>或<code>axis='columns'</code>可以删除列的值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">113</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">one</span>  <span class="n">three</span>  <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>      <span class="mi">2</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">4</span>      <span class="mi">6</span>     <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">8</span>     <span class="mi">10</span>    <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>   <span class="mi">12</span>     <span class="mi">14</span>    <span class="mi">15</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">114</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">one</span>  <span class="n">three</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">4</span>      <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">8</span>     <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>   <span class="mi">12</span>     <span class="mi">14</span>
</span></span></code></pre></div><p>许多函数，如<code>drop</code>，会修改<code>Series</code>或<code>DataFrame</code>的大小或形状，可以就地修改对象，不会返回新的对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">116</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>小心使用<code>inplace</code>，它会销毁所有被删除的数据。</p>
<h2 id="索引选取和过滤">索引、选取和过滤</h2>
<p><code>Series</code>索引（<code>obj[...]</code>）的工作方式类似于 NumPy 数组的索引，只不过<code>Series</code>的索引值不只是整数。下面是几个例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">4.</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">118</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">121</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">121</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">122</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">122</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">123</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[</span><span class="n">obj</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">124</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>利用标签的切片运算与普通的 Python 切片运算不同，其末端是包含的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">125</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">125</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>用切片可以对<code>Series</code>的相应部分进行设置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">126</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">127</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">127</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>用一个值或序列对<code>DataFrame</code>进行索引其实就是获取一个或多个列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">128</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Colorado&#39;</span><span class="p">,</span> <span class="s1">&#39;Utah&#39;</span><span class="p">,</span> <span class="s1">&#39;New York&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">129</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">129</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>  <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>    <span class="mi">1</span>      <span class="mi">2</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">4</span>    <span class="mi">5</span>      <span class="mi">6</span>     <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">8</span>    <span class="mi">9</span>     <span class="mi">10</span>    <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>   <span class="mi">12</span>   <span class="mi">13</span>     <span class="mi">14</span>    <span class="mi">15</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">130</span><span class="p">]:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;two&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">130</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>         <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>         <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>    <span class="mi">13</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">two</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">131</span><span class="p">]:</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">131</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">three</span>  <span class="n">one</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>          <span class="mi">2</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>      <span class="mi">6</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>         <span class="mi">10</span>    <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>     <span class="mi">14</span>   <span class="mi">12</span>
</span></span></code></pre></div><p>这种索引方式有几个特殊的情况。首先通过切片或布尔型数组选取数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">132</span><span class="p">]:</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">132</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>  <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>    <span class="mi">1</span>      <span class="mi">2</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">4</span>    <span class="mi">5</span>      <span class="mi">6</span>     <span class="mi">7</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">133</span><span class="p">]:</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">133</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>  <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">4</span>    <span class="mi">5</span>      <span class="mi">6</span>     <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">8</span>    <span class="mi">9</span>     <span class="mi">10</span>    <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>   <span class="mi">12</span>   <span class="mi">13</span>     <span class="mi">14</span>    <span class="mi">15</span>
</span></span></code></pre></div><p>选取行的语法<code>data[:2]</code>十分方便。向<code>[ ]</code>传递单一的元素或列表，就可选择列。</p>
<p>另一种用法是通过布尔型<code>DataFrame</code>（比如下面这个由标量比较运算得出的）进行索引：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">134</span><span class="p">]:</span> <span class="n">data</span> <span class="o">&lt;</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">134</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">one</span>    <span class="n">two</span>  <span class="n">three</span>   <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>       <span class="kc">True</span>   <span class="kc">True</span>   <span class="kc">True</span>   <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>   <span class="kc">True</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>      <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">135</span><span class="p">]:</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">136</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">136</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>  <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>    <span class="mi">0</span>      <span class="mi">0</span>     <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">0</span>    <span class="mi">5</span>      <span class="mi">6</span>     <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">8</span>    <span class="mi">9</span>     <span class="mi">10</span>    <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>   <span class="mi">12</span>   <span class="mi">13</span>     <span class="mi">14</span>    <span class="mi">15</span>
</span></span></code></pre></div><p>这使得<code>DataFrame</code>的语法与 NumPy 二维数组的语法很像。</p>
<h2 id="用loc和iloc进行选取">用<code>loc</code>和<code>iloc</code>进行选取</h2>
<p>对于<code>DataFrame</code>的行的标签索引，我引入了特殊的标签运算符<code>loc</code>和<code>iloc</code>。它们可以让你用类似 NumPy 的标记，使用轴标签（<code>loc</code>）或整数索引（<code>iloc</code>），从<code>DataFrame</code>选择行和列的子集。</p>
<p>作为一个初步示例，让我们通过标签选择一行和多列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">137</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Colorado&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">137</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">two</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Colorado</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p>然后用<code>iloc</code>和整数进行选取：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">138</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">138</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">four</span>    <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>      <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>      <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Utah</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">139</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">139</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>       <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>       <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>    <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">four</span>     <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Utah</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">140</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">140</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">four</span>  <span class="n">one</span>  <span class="n">two</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>     <span class="mi">7</span>    <span class="mi">0</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">11</span>    <span class="mi">8</span>    <span class="mi">9</span>
</span></span></code></pre></div><p>这两个索引函数也适用于一个标签或多个标签的切片：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">141</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s1">&#39;Utah&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">141</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">two</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">142</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">][</span><span class="n">data</span><span class="o">.</span><span class="n">three</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">142</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">0</span>    <span class="mi">5</span>      <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>        <span class="mi">8</span>    <span class="mi">9</span>     <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="n">York</span>   <span class="mi">12</span>   <span class="mi">13</span>     <span class="mi">14</span>
</span></span></code></pre></div><p>所以，在 pandas 中，有多个方法可以选取和重新组合数据。对于<code>DataFrame</code>，表 5-4 进行了总结。后面会看到，还有更多的方法进行层级化索引。</p>
<blockquote>
<p>笔记：在一开始设计 pandas 时，我觉得用<code>frame[:, col]</code>选取列过于繁琐（也容易出错），因为列的选择是非常常见的操作。我做了些取舍，将花式索引的功能（标签和整数）放到了<code>ix</code>运算符中。在实践中，这会导致许多边缘情况，数据的轴标签是整数，所以 pandas 团队决定创造<code>loc</code>和<code>iloc</code>运算符分别处理严格基于标签和整数的索引。
<code>ix</code>运算符仍然可用，但并不推荐。</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-64354f2ab777bd8c.png"
        data-srcset="img/7178691-64354f2ab777bd8c.png, img/7178691-64354f2ab777bd8c.png 1.5x, img/7178691-64354f2ab777bd8c.png 2x"
        data-sizes="auto"
        alt="img/7178691-64354f2ab777bd8c.png"
        title="表 5-4 &lt;code&gt;DataFrame&lt;/code&gt;的索引选项" /></p>
<h2 id="整数索引">整数索引</h2>
<p>处理整数索引的 pandas 对象常常难住新手，因为它与 Python 内置的列表和元组的索引语法不同。例如，你可能不认为下面的代码会出错：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">3.</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span></code></pre></div><p>这里，pandas 可以勉强进行整数索引，但是会导致小 bug。我们有包含<code>0,1,2</code>的索引，但是引入用户想要的东西（基于标签或位置的索引）很难：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">144</span><span class="p">]:</span> <span class="n">ser</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">144</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>另外，对于非整数索引，不会产生歧义：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">145</span><span class="p">]:</span> <span class="n">ser2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">3.</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">146</span><span class="p">]:</span> <span class="n">ser2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">146</span><span class="p">]:</span> <span class="mf">2.0</span>
</span></span></code></pre></div><p>为了进行统一，如果轴索引含有整数，数据选取总会使用标签。为了更准确，请使用<code>loc</code>（标签）或<code>iloc</code>（整数）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">147</span><span class="p">]:</span> <span class="n">ser</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">147</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">148</span><span class="p">]:</span> <span class="n">ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">148</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">149</span><span class="p">]:</span> <span class="n">ser</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">149</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><h2 id="算术运算和数据对齐">算术运算和数据对齐</h2>
<p>pandas 最重要的一个功能是，它可以对不同索引的对象进行算术运算。在将对象相加时，如果存在不同的索引对，则结果的索引就是该索引对的并集。对于有数据库经验的用户，这就像在索引标签上进行自动外连接。看一个简单的例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">150</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">7.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">151</span><span class="p">]:</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="o">-</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">152</span><span class="p">]:</span> <span class="n">s1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">152</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">7.3</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="o">-</span><span class="mf">2.5</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">3.4</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">153</span><span class="p">]:</span> <span class="n">s2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">153</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="o">-</span><span class="mf">2.1</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">3.6</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="o">-</span><span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>    <span class="mf">3.1</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>将它们相加就会产生：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">154</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">154</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">5.2</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>自动的数据对齐操作在不重叠的索引处引入了 NA 值。缺失值会在算术运算过程中传播。</p>
<p>对于<code>DataFrame</code>，对齐操作会同时发生在行和列上：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">155</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">9.</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;bcd&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Texas&#39;</span><span class="p">,</span> <span class="s1">&#39;Colorado&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">156</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">12.</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;bde&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Utah&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Texas&#39;</span><span class="p">,</span> <span class="s1">&#39;Oregon&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">157</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">157</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">b</span>    <span class="n">c</span>    <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>      <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>     <span class="mf">3.0</span>  <span class="mf">4.0</span>  <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>  <span class="mf">6.0</span>  <span class="mf">7.0</span>  <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">158</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">158</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">b</span>     <span class="n">d</span>     <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>    <span class="mf">0.0</span>   <span class="mf">1.0</span>   <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>    <span class="mf">3.0</span>   <span class="mf">4.0</span>   <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>   <span class="mf">6.0</span>   <span class="mf">7.0</span>   <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>  <span class="mf">9.0</span>  <span class="mf">10.0</span>  <span class="mf">11.0</span>
</span></span></code></pre></div><p>把它们相加后将会返回一个新的<code>DataFrame</code>，其索引和列为原来那两个<code>DataFrame</code>的并集：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">159</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">+</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">159</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">b</span>   <span class="n">c</span>     <span class="n">d</span>   <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>  <span class="n">NaN</span> <span class="n">NaN</span>   <span class="n">NaN</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>      <span class="mf">3.0</span> <span class="n">NaN</span>   <span class="mf">6.0</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>    <span class="n">NaN</span> <span class="n">NaN</span>   <span class="n">NaN</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>     <span class="mf">9.0</span> <span class="n">NaN</span>  <span class="mf">12.0</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>      <span class="n">NaN</span> <span class="n">NaN</span>   <span class="n">NaN</span> <span class="n">NaN</span>
</span></span></code></pre></div><p>因为&rsquo;c&rsquo;和&rsquo;e&rsquo;列均不在两个<code>DataFrame</code>对象中，在结果中以缺省值呈现。行也是同样。</p>
<p>如果<code>DataFrame</code>对象相加，没有共用的列或行标签，结果都会是空：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">160</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">161</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">162</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">162</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">A</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">163</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">163</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">164</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">-</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">164</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">A</span>   <span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span> <span class="n">NaN</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="n">NaN</span> <span class="n">NaN</span>
</span></span></code></pre></div><h2 id="在算术方法中填充值">在算术方法中填充值</h2>
<p>在对不同索引的对象进行算术运算时，你可能希望当一个对象中某个轴标签在另一个对象中找不到时填充一个特殊值（比如 0）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">165</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">12.</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">166</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">20.</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcde&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">167</span><span class="p">]:</span> <span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">168</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">168</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">a</span>    <span class="n">b</span>     <span class="n">c</span>     <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>   <span class="mf">2.0</span>   <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">4.0</span>  <span class="mf">5.0</span>   <span class="mf">6.0</span>   <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">8.0</span>  <span class="mf">9.0</span>  <span class="mf">10.0</span>  <span class="mf">11.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">169</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">169</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">      <span class="n">a</span>     <span class="n">b</span>     <span class="n">c</span>     <span class="n">d</span>     <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>   <span class="mf">1.0</span>   <span class="mf">2.0</span>   <span class="mf">3.0</span>   <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="mf">5.0</span>   <span class="n">NaN</span>   <span class="mf">7.0</span>   <span class="mf">8.0</span>   <span class="mf">9.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">10.0</span>  <span class="mf">11.0</span>  <span class="mf">12.0</span>  <span class="mf">13.0</span>  <span class="mf">14.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">15.0</span>  <span class="mf">16.0</span>  <span class="mf">17.0</span>  <span class="mf">18.0</span>  <span class="mf">19.0</span>
</span></span></code></pre></div><p>将它们相加时，没有重叠的位置就会产生 NA 值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">170</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">+</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">170</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">      <span class="n">a</span>     <span class="n">b</span>     <span class="n">c</span>     <span class="n">d</span>   <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>   <span class="mf">2.0</span>   <span class="mf">4.0</span>   <span class="mf">6.0</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="mf">9.0</span>   <span class="n">NaN</span>  <span class="mf">13.0</span>  <span class="mf">15.0</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">18.0</span>  <span class="mf">20.0</span>  <span class="mf">22.0</span>  <span class="mf">24.0</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="n">NaN</span>   <span class="n">NaN</span>   <span class="n">NaN</span>   <span class="n">NaN</span> <span class="n">NaN</span>
</span></span></code></pre></div><p>使用<code>df1</code>的<code>add</code>方法，传入<code>df2</code>以及一个<code>fill_value</code>参数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">171</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">171</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">      <span class="n">a</span>     <span class="n">b</span>     <span class="n">c</span>     <span class="n">d</span>     <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>   <span class="mf">2.0</span>   <span class="mf">4.0</span>   <span class="mf">6.0</span>   <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="mf">9.0</span>   <span class="mf">5.0</span>  <span class="mf">13.0</span>  <span class="mf">15.0</span>   <span class="mf">9.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">18.0</span>  <span class="mf">20.0</span>  <span class="mf">22.0</span>  <span class="mf">24.0</span>  <span class="mf">14.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">15.0</span>  <span class="mf">16.0</span>  <span class="mf">17.0</span>  <span class="mf">18.0</span>  <span class="mf">19.0</span>
</span></span></code></pre></div><p>表 5-5 列出了<code>Series</code>和<code>DataFrame</code>的算术方法。它们每个都有一个副本，以字母<code>r</code>开头，它会翻转参数。因此这两个语句是等价的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">172</span><span class="p">]:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">172</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">a</span>         <span class="n">b</span>         <span class="n">c</span>         <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>       <span class="n">inf</span>  <span class="mf">1.000000</span>  <span class="mf">0.500000</span>  <span class="mf">0.333333</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">0.250000</span>  <span class="mf">0.200000</span>  <span class="mf">0.166667</span>  <span class="mf">0.142857</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">0.125000</span>  <span class="mf">0.111111</span>  <span class="mf">0.100000</span>  <span class="mf">0.090909</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">173</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">rdiv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">173</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">a</span>         <span class="n">b</span>         <span class="n">c</span>         <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>       <span class="n">inf</span>  <span class="mf">1.000000</span>  <span class="mf">0.500000</span>  <span class="mf">0.333333</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">0.250000</span>  <span class="mf">0.200000</span>  <span class="mf">0.166667</span>  <span class="mf">0.142857</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">0.125000</span>  <span class="mf">0.111111</span>  <span class="mf">0.100000</span>  <span class="mf">0.090909</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-16857a1021f98d1f.png"
        data-srcset="img/7178691-16857a1021f98d1f.png, img/7178691-16857a1021f98d1f.png 1.5x, img/7178691-16857a1021f98d1f.png 2x"
        data-sizes="auto"
        alt="img/7178691-16857a1021f98d1f.png"
        title="表 5-5 灵活的算术方法" /></p>
<p>与此类似，在对<code>Series</code>或<code>DataFrame</code>重新索引时，也可以指定一个填充值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">174</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">174</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">a</span>    <span class="n">b</span>     <span class="n">c</span>     <span class="n">d</span>  <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>   <span class="mf">2.0</span>   <span class="mf">3.0</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">4.0</span>  <span class="mf">5.0</span>   <span class="mf">6.0</span>   <span class="mf">7.0</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">8.0</span>  <span class="mf">9.0</span>  <span class="mf">10.0</span>  <span class="mf">11.0</span>  <span class="mi">0</span>
</span></span></code></pre></div><h2 id="dataframe和series之间的运算"><code>DataFrame</code>和<code>Series</code>之间的运算</h2>
<p>跟不同维度的 NumPy 数组一样，<code>DataFrame</code>和<code>Series</code>之间算术运算也是有明确规定的。先来看一个具有启发性的例子，计算一个二维数组与其某行之间的差：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">175</span><span class="p">]:</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">12.</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">176</span><span class="p">]:</span> <span class="n">arr</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">176</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">array</span><span class="p">([[</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">,</span>   <span class="mf">2.</span><span class="p">,</span>   <span class="mf">3.</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span>  <span class="mf">4.</span><span class="p">,</span>   <span class="mf">5.</span><span class="p">,</span>   <span class="mf">6.</span><span class="p">,</span>   <span class="mf">7.</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span>  <span class="mf">8.</span><span class="p">,</span>   <span class="mf">9.</span><span class="p">,</span>  <span class="mf">10.</span><span class="p">,</span>  <span class="mf">11.</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">177</span><span class="p">]:</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">177</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">2.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">178</span><span class="p">]:</span> <span class="n">arr</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">178</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mf">4.</span><span class="p">,</span>  <span class="mf">4.</span><span class="p">,</span>  <span class="mf">4.</span><span class="p">,</span>  <span class="mf">4.</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mf">8.</span><span class="p">,</span>  <span class="mf">8.</span><span class="p">,</span>  <span class="mf">8.</span><span class="p">,</span>  <span class="mf">8.</span><span class="p">]])</span>
</span></span></code></pre></div><p>当我们从<code>arr</code>减去<code>arr[0]</code>，每一行都会执行这个操作。这就叫做广播（broadcasting），附录 A 将对此进行详细讲解。<code>DataFrame</code>和<code>Series</code>之间的运算差不多也是如此：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">179</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">12.</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                      <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;bde&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Utah&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Texas&#39;</span><span class="p">,</span> <span class="s1">&#39;Oregon&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">180</span><span class="p">]:</span> <span class="n">series</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">181</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">181</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">b</span>     <span class="n">d</span>     <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>    <span class="mf">0.0</span>   <span class="mf">1.0</span>   <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>    <span class="mf">3.0</span>   <span class="mf">4.0</span>   <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>   <span class="mf">6.0</span>   <span class="mf">7.0</span>   <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>  <span class="mf">9.0</span>  <span class="mf">10.0</span>  <span class="mf">11.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">182</span><span class="p">]:</span> <span class="n">series</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">182</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Utah</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>默认情况下，<code>DataFrame</code>和<code>Series</code>之间的算术运算会将<code>Series</code>的索引匹配到<code>DataFrame</code>的列，然后沿着行一直向下广播：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">183</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">-</span> <span class="n">series</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">183</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">b</span>    <span class="n">d</span>    <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>    <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>    <span class="mf">3.0</span>  <span class="mf">3.0</span>  <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>   <span class="mf">6.0</span>  <span class="mf">6.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>  <span class="mf">9.0</span>  <span class="mf">9.0</span>  <span class="mf">9.0</span>
</span></span></code></pre></div><p>如果某个索引值在<code>DataFrame</code>的列或<code>Series</code>的索引中找不到，则参与运算的两个对象就会被重新索引以形成并集：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">184</span><span class="p">]:</span> <span class="n">series2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">185</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">+</span> <span class="n">series2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">185</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">b</span>   <span class="n">d</span>     <span class="n">e</span>   <span class="n">f</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>    <span class="mf">0.0</span> <span class="n">NaN</span>   <span class="mf">3.0</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>    <span class="mf">3.0</span> <span class="n">NaN</span>   <span class="mf">6.0</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>   <span class="mf">6.0</span> <span class="n">NaN</span>   <span class="mf">9.0</span> <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>  <span class="mf">9.0</span> <span class="n">NaN</span>  <span class="mf">12.0</span> <span class="n">NaN</span>
</span></span></code></pre></div><p>如果你希望匹配行且在列上广播，则必须使用算术运算方法。例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">186</span><span class="p">]:</span> <span class="n">series3</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">187</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">187</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">b</span>     <span class="n">d</span>     <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>    <span class="mf">0.0</span>   <span class="mf">1.0</span>   <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>    <span class="mf">3.0</span>   <span class="mf">4.0</span>   <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>   <span class="mf">6.0</span>   <span class="mf">7.0</span>   <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>  <span class="mf">9.0</span>  <span class="mf">10.0</span>  <span class="mf">11.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">188</span><span class="p">]:</span> <span class="n">series3</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">188</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>       <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>       <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>      <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>    <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">d</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">189</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">series3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">189</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">b</span>    <span class="n">d</span>    <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>   <span class="o">-</span><span class="mf">1.0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>   <span class="o">-</span><span class="mf">1.0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>  <span class="o">-</span><span class="mf">1.0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span> <span class="o">-</span><span class="mf">1.0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>
</span></span></code></pre></div><p>传入的轴号就是希望匹配的轴。在本例中，我们的目的是匹配<code>DataFrame</code>的行索引（<code>axis='index'</code>或<code>axis=0</code>）并进行广播。</p>
<h2 id="函数应用和映射">函数应用和映射</h2>
<p>NumPy 的<code>ufuncs</code>（元素级数组方法）也可用于操作 pandas 对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">190</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;bde&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Utah&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Texas&#39;</span><span class="p">,</span> <span class="s1">&#39;Oregon&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">191</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">191</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">               <span class="n">b</span>         <span class="n">d</span>         <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>   <span class="o">-</span><span class="mf">0.204708</span>  <span class="mf">0.478943</span> <span class="o">-</span><span class="mf">0.519439</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>   <span class="o">-</span><span class="mf">0.555730</span>  <span class="mf">1.965781</span>  <span class="mf">1.393406</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>   <span class="mf">0.092908</span>  <span class="mf">0.281746</span>  <span class="mf">0.769023</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>  <span class="mf">1.246435</span>  <span class="mf">1.007189</span> <span class="o">-</span><span class="mf">1.296221</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">192</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">192</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">               <span class="n">b</span>         <span class="n">d</span>         <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>    <span class="mf">0.204708</span>  <span class="mf">0.478943</span>  <span class="mf">0.519439</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>    <span class="mf">0.555730</span>  <span class="mf">1.965781</span>  <span class="mf">1.393406</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>   <span class="mf">0.092908</span>  <span class="mf">0.281746</span>  <span class="mf">0.769023</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>  <span class="mf">1.246435</span>  <span class="mf">1.007189</span>  <span class="mf">1.296221</span>
</span></span></code></pre></div><p>另一个常见的操作是，将函数应用到由各列或行所形成的一维数组上。<code>DataFrame</code>的<code>apply</code>方法即可实现此功能：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">193</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">194</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">194</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.802165</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">1.684034</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">2.689627</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>这里的函数<code>f</code>，计算了一个<code>Series</code>的最大值和最小值的差，在<code>frame</code>的每列都执行了一次。结果是一个<code>Series</code>，使用<code>frame</code>的列作为索引。</p>
<p>如果传递<code>axis='columns'</code>到<code>apply</code>，这个函数会在每行执行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">195</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">195</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>      <span class="mf">0.998382</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>      <span class="mf">2.521511</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>     <span class="mf">0.676115</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>    <span class="mf">2.542656</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>许多最为常见的数组统计功能都被实现成<code>DataFrame</code>的方法（如<code>sum</code>和<code>mean</code>），因此无需使用<code>apply</code>方法。</p>
<p>传递到<code>apply</code>的函数不是必须返回一个标量，还可以返回由多个值组成的<code>Series</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">196</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">197</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">197</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">b</span>         <span class="n">d</span>         <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="nb">min</span> <span class="o">-</span><span class="mf">0.555730</span>  <span class="mf">0.281746</span> <span class="o">-</span><span class="mf">1.296221</span>
</span></span><span class="line"><span class="cl"><span class="nb">max</span>  <span class="mf">1.246435</span>  <span class="mf">1.965781</span>  <span class="mf">1.393406</span>
</span></span></code></pre></div><p>元素级的 Python 函数也是可以用的。假如你想得到<code>frame</code>中各个浮点值的格式化字符串，使用<code>applymap</code>即可：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">198</span><span class="p">]:</span> <span class="nb">format</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">199</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">199</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">b</span>     <span class="n">d</span>      <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>    <span class="o">-</span><span class="mf">0.20</span>  <span class="mf">0.48</span>  <span class="o">-</span><span class="mf">0.52</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>    <span class="o">-</span><span class="mf">0.56</span>  <span class="mf">1.97</span>   <span class="mf">1.39</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>    <span class="mf">0.09</span>  <span class="mf">0.28</span>   <span class="mf">0.77</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>   <span class="mf">1.25</span>  <span class="mf">1.01</span>  <span class="o">-</span><span class="mf">1.30</span>
</span></span></code></pre></div><p>之所以叫做<code>applymap</code>，是因为<code>Series</code>有一个用于应用元素级函数的<code>map</code>方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">200</span><span class="p">]:</span> <span class="n">frame</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">200</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">Utah</span>      <span class="o">-</span><span class="mf">0.52</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>       <span class="mf">1.39</span>
</span></span><span class="line"><span class="cl"><span class="n">Texas</span>      <span class="mf">0.77</span>
</span></span><span class="line"><span class="cl"><span class="n">Oregon</span>    <span class="o">-</span><span class="mf">1.30</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">e</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span></code></pre></div><h2 id="排序和排名">排序和排名</h2>
<p>根据条件对数据集排序（sorting）也是一种重要的内置运算。要对行或列索引进行排序（按字典顺序），可使用<code>sort_index</code>方法，它将返回一个已排序的新对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">201</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">202</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">202</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p>对于<code>DataFrame</code>，则可以根据任意一个轴上的索引进行排序：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">203</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                      <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">204</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">204</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">d</span>  <span class="n">a</span>  <span class="n">b</span>  <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mi">4</span>  <span class="mi">5</span>  <span class="mi">6</span>  <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">205</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">205</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">       <span class="n">a</span>  <span class="n">b</span>  <span class="n">c</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">3</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mi">5</span>  <span class="mi">6</span>  <span class="mi">7</span>  <span class="mi">4</span>
</span></span></code></pre></div><p>数据默认是按升序排序的，但也可以降序排序：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">206</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">206</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">d</span>  <span class="n">c</span>  <span class="n">b</span>  <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="mi">0</span>  <span class="mi">3</span>  <span class="mi">2</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mi">4</span>  <span class="mi">7</span>  <span class="mi">6</span>  <span class="mi">5</span>
</span></span></code></pre></div><p>若要按值对<code>Series</code>进行排序，可使用其<code>sort_values</code>方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">207</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">208</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">208</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="o">-</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p>在排序时，任何缺失值默认都会被放到<code>Series</code>的末尾：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">209</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">210</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">210</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="o">-</span><span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>当排序一个<code>DataFrame</code>时，你可能希望根据一个或多个列中的值进行排序。将一个或多个列的名字传递给<code>sort_values</code>的<code>by</code>选项即可达到该目的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">211</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">212</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">212</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">a</span>  <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mi">0</span> <span class="o">-</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mi">1</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">213</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">213</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">a</span>  <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mi">0</span> <span class="o">-</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mi">1</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">7</span>
</span></span></code></pre></div><p>要根据多个列进行排序，传入名称的列表即可：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">214</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">214</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">a</span>  <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mi">0</span> <span class="o">-</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mi">1</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">7</span>
</span></span></code></pre></div><p>排名会从 1 开始一直到数组中有效数据的数量。接下来介绍<code>Series</code>和<code>DataFrame</code>的<code>rank</code>方法。默认情况下，<code>rank</code>是通过“为各组分配一个平均排名”的方式破坏平级关系的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">215</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">216</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">216</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">6.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">6.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>也可以根据值在原数据中出现的顺序给出排名：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">217</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">217</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>这里，条目 0 和 2 没有使用平均排名 6.5，它们被设成了 6 和 7，因为数据中标签 0 位于标签 2 的前面。</p>
<p>你也可以按降序进行排名：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Assign tie values the maximum rank in the group</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">218</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">218</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>表 5-6 列出了所有用于破坏平级关系的<code>method</code>选项。<code>DataFrame</code>可以在行或列上计算排名：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">219</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                       <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">220</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">220</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">a</span>    <span class="n">b</span>    <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">0</span>  <span class="mf">4.3</span> <span class="o">-</span><span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">1</span>  <span class="mf">7.0</span>  <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mi">0</span> <span class="o">-</span><span class="mf">3.0</span>  <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mi">1</span>  <span class="mf">2.0</span> <span class="o">-</span><span class="mf">2.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">221</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">221</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">a</span>    <span class="n">b</span>    <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">2.0</span>  <span class="mf">3.0</span>  <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">1.0</span>  <span class="mf">3.0</span>  <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">2.0</span>  <span class="mf">1.0</span>  <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">2.0</span>  <span class="mf">3.0</span>  <span class="mf">1.0</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-7edfab5b4a147581.png"
        data-srcset="img/7178691-7edfab5b4a147581.png, img/7178691-7edfab5b4a147581.png 1.5x, img/7178691-7edfab5b4a147581.png 2x"
        data-sizes="auto"
        alt="img/7178691-7edfab5b4a147581.png"
        title="表 5-6 排名时用于破坏平级关系的方法" /></p>
<h2 id="带有重复标签的轴索引">带有重复标签的轴索引</h2>
<p>直到目前为止，我所介绍的所有范例都有着唯一的轴标签（索引值）。虽然许多 pandas 函数（如<code>reindex</code>）都要求标签唯一，但这并不是强制性的。我们来看看下面这个简单的带有重复索引值的<code>Series</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">222</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">223</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">223</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p>索引的<code>is_unique</code>属性可以告诉你它的值是否是唯一的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">224</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">224</span><span class="p">]:</span> <span class="kc">False</span>
</span></span></code></pre></div><p>对于带有重复值的索引，数据选取的行为将会有些不同。如果某个索引对应多个值，则返回一个<code>Series</code>；而对应单个值的，则返回一个标量值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">225</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">225</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">226</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">226</span><span class="p">]:</span> <span class="mi">4</span>
</span></span></code></pre></div><p>这样会使代码变复杂，因为索引的输出类型会根据标签是否有重复发生变化。</p>
<p>对<code>DataFrame</code>的行进行索引时也是如此：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">227</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">228</span><span class="p">]:</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">228</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="mi">0</span>         <span class="mi">1</span>         <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.274992</span>  <span class="mf">0.228913</span>  <span class="mf">1.352917</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.886429</span> <span class="o">-</span><span class="mf">2.001637</span> <span class="o">-</span><span class="mf">0.371843</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.669025</span> <span class="o">-</span><span class="mf">0.438570</span> <span class="o">-</span><span class="mf">0.539741</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">0.476985</span>  <span class="mf">3.248944</span> <span class="o">-</span><span class="mf">1.021228</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">229</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">229</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="mi">0</span>         <span class="mi">1</span>         <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.669025</span> <span class="o">-</span><span class="mf">0.438570</span> <span class="o">-</span><span class="mf">0.539741</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">0.476985</span>  <span class="mf">3.248944</span> <span class="o">-</span><span class="mf">1.021228</span>
</span></span></code></pre></div><h1 id="53-汇总和计算描述统计">5.3 汇总和计算描述统计</h1>
<p>pandas 对象拥有一组常用的数学和统计方法。它们大部分都属于约简和汇总统计，用于从<code>Series</code>中提取单个值（如<code>sum</code>或<code>mean</code>）或从<code>DataFrame</code>的行或列中提取一个<code>Series</code>。跟对应的 NumPy 数组方法相比，它们都是基于没有缺失数据的假设而构建的。看一个简单的<code>DataFrame</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">230</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="mf">7.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                   <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">231</span><span class="p">]:</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">231</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">one</span>  <span class="n">two</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">1.40</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">7.10</span> <span class="o">-</span><span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="mf">0.75</span> <span class="o">-</span><span class="mf">1.3</span>
</span></span></code></pre></div><p>调用<code>DataFrame</code>的<code>sum</code>方法将会返回一个含有列的和的<code>Series</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">232</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">232</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mf">9.25</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>   <span class="o">-</span><span class="mf">5.80</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>传入<code>axis='columns'</code>或<code>axis=1</code>将会按行进行求和运算：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">233</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">233</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">1.40</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">2.60</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>     <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>   <span class="o">-</span><span class="mf">0.55</span>
</span></span></code></pre></div><p>NA 值会自动被排除，除非整个切片（这里指的是行或列）都是 NA。通过<code>skipna</code>选项可以禁用该功能：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">234</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">234</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>      <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">1.300</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>      <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>   <span class="o">-</span><span class="mf">0.275</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>表 5-7 列出了这些约简方法的常用选项。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-af35e3809278410e.jpg"
        data-srcset="img/7178691-af35e3809278410e.jpg, img/7178691-af35e3809278410e.jpg 1.5x, img/7178691-af35e3809278410e.jpg 2x"
        data-sizes="auto"
        alt="img/7178691-af35e3809278410e.jpg"
        title="img/7178691-af35e3809278410e.jpg" /></p>
<p>有些方法（如<code>idxmin</code>和<code>idxmax</code>）返回的是间接统计（比如达到最小值或最大值的索引）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">235</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">235</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span></code></pre></div><p>另一些方法则是累计型的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">236</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">236</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">one</span>  <span class="n">two</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">1.40</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">8.50</span> <span class="o">-</span><span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="mf">9.25</span> <span class="o">-</span><span class="mf">5.8</span>
</span></span></code></pre></div><p>还有一种方法，它既不是约简型也不是累计型。<code>describe</code>就是一个例子，它用于一次性产生多个汇总统计：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">237</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">237</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">one</span>       <span class="n">two</span>
</span></span><span class="line"><span class="cl"><span class="n">count</span>  <span class="mf">3.000000</span>  <span class="mf">2.000000</span>
</span></span><span class="line"><span class="cl"><span class="n">mean</span>   <span class="mf">3.083333</span> <span class="o">-</span><span class="mf">2.900000</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span>    <span class="mf">3.493685</span>  <span class="mf">2.262742</span>
</span></span><span class="line"><span class="cl"><span class="nb">min</span>    <span class="mf">0.750000</span> <span class="o">-</span><span class="mf">4.500000</span>
</span></span><span class="line"><span class="cl"><span class="mi">25</span><span class="o">%</span>    <span class="mf">1.075000</span> <span class="o">-</span><span class="mf">3.700000</span>
</span></span><span class="line"><span class="cl"><span class="mi">50</span><span class="o">%</span>    <span class="mf">1.400000</span> <span class="o">-</span><span class="mf">2.900000</span>
</span></span><span class="line"><span class="cl"><span class="mi">75</span><span class="o">%</span>    <span class="mf">4.250000</span> <span class="o">-</span><span class="mf">2.100000</span>
</span></span><span class="line"><span class="cl"><span class="nb">max</span>    <span class="mf">7.100000</span> <span class="o">-</span><span class="mf">1.300000</span>
</span></span></code></pre></div><p>对于非数值型数据，<code>describe</code>会产生另外一种汇总统计：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">238</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">239</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">239</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">count</span>     <span class="mi">16</span>
</span></span><span class="line"><span class="cl"><span class="n">unique</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">top</span>        <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="n">freq</span>       <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span></code></pre></div><p>表 5-8 列出了所有与描述统计相关的方法。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-11fa967f658ac314.jpg"
        data-srcset="img/7178691-11fa967f658ac314.jpg, img/7178691-11fa967f658ac314.jpg 1.5x, img/7178691-11fa967f658ac314.jpg 2x"
        data-sizes="auto"
        alt="img/7178691-11fa967f658ac314.jpg"
        title="img/7178691-11fa967f658ac314.jpg" /></p>
<h2 id="相关系数与协方差">相关系数与协方差</h2>
<p>有些汇总统计（如相关系数和协方差）是通过参数对计算出来的。我们来看几个<code>DataFrame</code>，它们的数据来自 Yahoo!Finance 的股票价格和成交量，使用的是<code>pandas-datareader</code>包（可以用<code>conda</code>或<code>pip</code>安装）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">conda</span> <span class="n">install</span> <span class="n">pandas</span><span class="o">-</span><span class="n">datareader</span>
</span></span></code></pre></div><p>我使用<code>pandas_datareader</code>模块下载了一些股票数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas_datareader.data</span> <span class="k">as</span> <span class="nn">web</span>
</span></span><span class="line"><span class="cl"><span class="n">all_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">ticker</span><span class="p">:</span> <span class="n">web</span><span class="o">.</span><span class="n">get_data_yahoo</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;IBM&#39;</span><span class="p">,</span> <span class="s1">&#39;MSFT&#39;</span><span class="p">,</span> <span class="s1">&#39;GOOG&#39;</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">price</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">ticker</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                     <span class="k">for</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">all_data</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</span></span><span class="line"><span class="cl"><span class="n">volume</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">ticker</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Volume&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                      <span class="k">for</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">all_data</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</span></span></code></pre></div><blockquote>
<p>注意：此时 Yahoo! Finance 已经不存在了，因为 2017 年 Yahoo! 被 Verizon 收购了。参阅<code>pandas-datareader</code>文档，可以学习最新的功能。</p>
</blockquote>
<p>现在计算价格的百分数变化，时间序列的操作会在第 11 章介绍：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">242</span><span class="p">]:</span> <span class="n">returns</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">243</span><span class="p">]:</span> <span class="n">returns</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">243</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">                <span class="n">AAPL</span>      <span class="n">GOOG</span>       <span class="n">IBM</span>      <span class="n">MSFT</span>
</span></span><span class="line"><span class="cl"><span class="n">Date</span>                                              
</span></span><span class="line"><span class="cl"><span class="mi">2016</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">17</span> <span class="o">-</span><span class="mf">0.000680</span>  <span class="mf">0.001837</span>  <span class="mf">0.002072</span> <span class="o">-</span><span class="mf">0.003483</span>
</span></span><span class="line"><span class="cl"><span class="mi">2016</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">18</span> <span class="o">-</span><span class="mf">0.000681</span>  <span class="mf">0.019616</span> <span class="o">-</span><span class="mf">0.026168</span>  <span class="mf">0.007690</span>
</span></span><span class="line"><span class="cl"><span class="mi">2016</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">19</span> <span class="o">-</span><span class="mf">0.002979</span>  <span class="mf">0.007846</span>  <span class="mf">0.003583</span> <span class="o">-</span><span class="mf">0.002255</span>
</span></span><span class="line"><span class="cl"><span class="mi">2016</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">20</span> <span class="o">-</span><span class="mf">0.000512</span> <span class="o">-</span><span class="mf">0.005652</span>  <span class="mf">0.001719</span> <span class="o">-</span><span class="mf">0.004867</span>
</span></span><span class="line"><span class="cl"><span class="mi">2016</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">21</span> <span class="o">-</span><span class="mf">0.003930</span>  <span class="mf">0.003011</span> <span class="o">-</span><span class="mf">0.012474</span>  <span class="mf">0.042096</span>
</span></span></code></pre></div><p><code>Series</code>的<code>corr</code>方法用于计算两个<code>Series</code>中重叠的、非 NA 的、按索引对齐的值的相关系数。与此类似，<code>cov</code>用于计算协方差：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">244</span><span class="p">]:</span> <span class="n">returns</span><span class="p">[</span><span class="s1">&#39;MSFT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s1">&#39;IBM&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">244</span><span class="p">]:</span> <span class="mf">0.49976361144151144</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">245</span><span class="p">]:</span> <span class="n">returns</span><span class="p">[</span><span class="s1">&#39;MSFT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s1">&#39;IBM&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">245</span><span class="p">]:</span> <span class="mf">8.8706554797035462e-05</span>
</span></span></code></pre></div><p>因为<code>MSTF</code>是一个合理的 Python 属性，我们还可以用更简洁的语法选择列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">246</span><span class="p">]:</span> <span class="n">returns</span><span class="o">.</span><span class="n">MSFT</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">IBM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">246</span><span class="p">]:</span> <span class="mf">0.49976361144151144</span>
</span></span></code></pre></div><p>另一方面，<code>DataFrame</code>的<code>corr</code>和<code>cov</code>方法将以<code>DataFrame</code>的形式分别返回完整的相关系数或协方差矩阵：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">247</span><span class="p">]:</span> <span class="n">returns</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">247</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">AAPL</span>      <span class="n">GOOG</span>       <span class="n">IBM</span>      <span class="n">MSFT</span>
</span></span><span class="line"><span class="cl"><span class="n">AAPL</span>  <span class="mf">1.000000</span>  <span class="mf">0.407919</span>  <span class="mf">0.386817</span>  <span class="mf">0.389695</span>
</span></span><span class="line"><span class="cl"><span class="n">GOOG</span>  <span class="mf">0.407919</span>  <span class="mf">1.000000</span>  <span class="mf">0.405099</span>  <span class="mf">0.465919</span>
</span></span><span class="line"><span class="cl"><span class="n">IBM</span>   <span class="mf">0.386817</span>  <span class="mf">0.405099</span>  <span class="mf">1.000000</span>  <span class="mf">0.499764</span>
</span></span><span class="line"><span class="cl"><span class="n">MSFT</span>  <span class="mf">0.389695</span>  <span class="mf">0.465919</span>  <span class="mf">0.499764</span>  <span class="mf">1.000000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">248</span><span class="p">]:</span> <span class="n">returns</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">248</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">AAPL</span>      <span class="n">GOOG</span>       <span class="n">IBM</span>      <span class="n">MSFT</span>
</span></span><span class="line"><span class="cl"><span class="n">AAPL</span>  <span class="mf">0.000277</span>  <span class="mf">0.000107</span>  <span class="mf">0.000078</span>  <span class="mf">0.000095</span>
</span></span><span class="line"><span class="cl"><span class="n">GOOG</span>  <span class="mf">0.000107</span>  <span class="mf">0.000251</span>  <span class="mf">0.000078</span>  <span class="mf">0.000108</span>
</span></span><span class="line"><span class="cl"><span class="n">IBM</span>   <span class="mf">0.000078</span>  <span class="mf">0.000078</span>  <span class="mf">0.000146</span>  <span class="mf">0.000089</span>
</span></span><span class="line"><span class="cl"><span class="n">MSFT</span>  <span class="mf">0.000095</span>  <span class="mf">0.000108</span>  <span class="mf">0.000089</span>  <span class="mf">0.000215</span>
</span></span></code></pre></div><p>利用<code>DataFrame</code>的<code>corrwith</code>方法，你可以计算其列或行跟另一个<code>Series</code>或<code>DataFrame</code>之间的相关系数。传入一个<code>Series</code>将会返回一个相关系数值<code>Series</code>（针对各列进行计算）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">249</span><span class="p">]:</span> <span class="n">returns</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">IBM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">249</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">AAPL</span>    <span class="mf">0.386817</span>
</span></span><span class="line"><span class="cl"><span class="n">GOOG</span>    <span class="mf">0.405099</span>
</span></span><span class="line"><span class="cl"><span class="n">IBM</span>     <span class="mf">1.000000</span>
</span></span><span class="line"><span class="cl"><span class="n">MSFT</span>    <span class="mf">0.499764</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>传入一个<code>DataFrame</code>则会计算按列名配对的相关系数。这里，我计算百分比变化与成交量的相关系数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">250</span><span class="p">]:</span> <span class="n">returns</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">250</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">AAPL</span>   <span class="o">-</span><span class="mf">0.075565</span>
</span></span><span class="line"><span class="cl"><span class="n">GOOG</span>   <span class="o">-</span><span class="mf">0.007067</span>
</span></span><span class="line"><span class="cl"><span class="n">IBM</span>    <span class="o">-</span><span class="mf">0.204849</span>
</span></span><span class="line"><span class="cl"><span class="n">MSFT</span>   <span class="o">-</span><span class="mf">0.092950</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>传入<code>axis='columns'</code>即可按行进行计算。无论如何，在计算相关系数之前，所有的数据项都会按标签对齐。</p>
<h2 id="唯一值值计数以及成员资格">唯一值、值计数以及成员资格</h2>
<p>还有一类方法可以从一维<code>Series</code>的值中抽取信息。看下面的例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">251</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span></code></pre></div><p>第一个函数是<code>unique</code>，它可以得到<code>Series</code>中的唯一值数组：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">252</span><span class="p">]:</span> <span class="n">uniques</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">253</span><span class="p">]:</span> <span class="n">uniques</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">253</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span></span></code></pre></div><p>返回的唯一值是未排序的，如果需要的话，可以对结果再次进行排序（<code>uniques.sort()</code>）。相似的，<code>value_counts</code>用于计算一个<code>Series</code>中各值出现的频率：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">254</span><span class="p">]:</span> <span class="n">obj</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">254</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p>为了便于查看，结果<code>Series</code>是按值频率降序排列的。<code>value_counts</code>还是一个顶级 pandas 方法，可用于任何数组或序列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">255</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">255</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p><code>isin</code>用于判断向量化集合的成员资格，可用于过滤<code>Series</code>中或<code>DataFrame</code>列中数据的子集：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">256</span><span class="p">]:</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">256</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>    <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>    <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">257</span><span class="p">]:</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">258</span><span class="p">]:</span> <span class="n">mask</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">258</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>     <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">259</span><span class="p">]:</span> <span class="n">obj</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">259</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>    <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>    <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span></code></pre></div><p>与<code>isin</code>类似的是<code>Index.get_indexer</code>方法，它可以给你一个索引数组，从可能包含重复值的数组到另一个不同值的数组：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">260</span><span class="p">]:</span> <span class="n">to_match</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">261</span><span class="p">]:</span> <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">262</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">(</span><span class="n">to_match</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">262</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span></span></code></pre></div><p>表 5-9 给出了这几个方法的一些参考信息。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-b53c4a9d65a2db32.png"
        data-srcset="img/7178691-b53c4a9d65a2db32.png, img/7178691-b53c4a9d65a2db32.png 1.5x, img/7178691-b53c4a9d65a2db32.png 2x"
        data-sizes="auto"
        alt="img/7178691-b53c4a9d65a2db32.png"
        title="表 5-9 唯一值、值计数、成员资格方法" /></p>
<p>有时，你可能希望得到<code>DataFrame</code>中多个相关列的一张柱状图。例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">263</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Qu1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                      <span class="s1">&#39;Qu2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                      <span class="s1">&#39;Qu3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">264</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">264</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Qu1</span>  <span class="n">Qu2</span>  <span class="n">Qu3</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mi">1</span>    <span class="mi">2</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mi">3</span>    <span class="mi">3</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mi">4</span>    <span class="mi">1</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mi">3</span>    <span class="mi">2</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mi">4</span>    <span class="mi">3</span>    <span class="mi">4</span>
</span></span></code></pre></div><p>将<code>pandas.value_counts</code>传给该<code>DataFrame</code>的<code>apply</code>函数，就会出现：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">265</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">266</span><span class="p">]:</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">266</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Qu1</span>  <span class="n">Qu2</span>  <span class="n">Qu3</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">1.0</span>  <span class="mf">1.0</span>  <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">0.0</span>  <span class="mf">2.0</span>  <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">2.0</span>  <span class="mf">2.0</span>  <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">2.0</span>  <span class="mf">0.0</span>  <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>
</span></span></code></pre></div><p>这里，结果中的行标签是所有列的唯一值。后面的频率值是每个列中这些值的相应计数。</p>
<h1 id="54-总结">5.4 总结</h1>
<p>在下一章，我们将讨论用 pandas 读取（或加载）和写入数据集的工具。</p>
<p>之后，我们将更深入地研究使用 pandas 进行数据清洗、规整、分析和可视化工具。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 0001-01-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://localhost:1313/posts/pyda-2e-zh/5/" data-title=""><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/pyda-2e-zh/5/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/posts/pyda-2e-zh/5/" data-title=""><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://localhost:1313/posts/pyda-2e-zh/5/" data-title=""><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://localhost:1313/posts/pyda-2e-zh/5/" data-title=""><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/pyda-2e-zh/6/" class="prev" rel="prev" title=""><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i></a>
            <a href="/posts/pyda-2e-zh/4/" class="next" rel="next" title=""><i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.118.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Aphros</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>

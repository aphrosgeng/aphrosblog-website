<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title> - Aphros的个人博客</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="" />
<meta property="og:description" content="第 8 章 数据规整：聚合、合并和重塑 在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/pyda-2e-zh/8/" /><meta property="article:section" content="posts" />

<meta property="og:site_name" content="Aphros的博客" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="第 8 章 数据规整：聚合、合并和重塑 在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方"/>
<meta name="application-name" content="Aphros的博客">
<meta name="apple-mobile-web-app-title" content="Aphros的博客"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/posts/pyda-2e-zh/8/" /><link rel="prev" href="http://localhost:1313/posts/pyda-2e-zh/9/" /><link rel="next" href="http://localhost:1313/posts/pyda-2e-zh/7/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/pyda-2e-zh\/8\/"
        },"genre": "posts","wordcount":  8965 ,
        "url": "http:\/\/localhost:1313\/posts\/pyda-2e-zh\/8\/","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Aphros"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Aphros的个人博客">Aphros的博客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Aphros的个人博客">Aphros的博客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX"></h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Aphros</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="0001-01-01">0001-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;8965 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;18 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#重排与分级排序">重排与分级排序</a></li>
    <li><a href="#根据级别汇总统计">根据级别汇总统计</a></li>
    <li><a href="#使用dataframe的列进行索引">使用<code>DataFrame</code>的列进行索引</a></li>
  </ul>

  <ul>
    <li><a href="#数据库风格的dataframe合并">数据库风格的<code>DataFrame</code>合并</a></li>
    <li><a href="#索引上的合并">索引上的合并</a></li>
    <li><a href="#轴向连接">轴向连接</a></li>
    <li><a href="#合并重叠数据">合并重叠数据</a></li>
  </ul>

  <ul>
    <li><a href="#重塑层次化索引">重塑层次化索引</a></li>
    <li><a href="#将长格式旋转为宽格式">将“长格式”旋转为“宽格式”</a></li>
    <li><a href="#将宽格式旋转为长格式">将“宽格式”旋转为“长格式”</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="第-8-章-数据规整聚合合并和重塑">第 8 章 数据规整：聚合、合并和重塑</h1>
<p>在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方法。</p>
<p>首先，我会介绍 pandas 的层次化索引，它广泛用于以上操作。然后，我深入介绍了一些特殊的数据操作。在第 14 章，你可以看到这些工具的多种应用。</p>
<h1 id="81-层次化索引">8.1 层次化索引</h1>
<p>层次化索引（hierarchical indexing）是 pandas 的一项重要功能，它使你能在一个轴上拥有多个（两个以上）索引级别。抽象点说，它使你能以低维度形式处理高维度数据。我们先来看一个简单的例子：创建一个<code>Series</code>，并用一个由列表或数组组成的列表作为索引：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span>                  <span class="n">index</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span>                         <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.204708</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.478943</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>   <span class="o">-</span><span class="mf">0.519439</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="mi">1</span>    <span class="mf">1.393406</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.092908</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="mi">2</span>    <span class="mf">0.281746</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">0.769023</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>看到的结果是经过美化的带有<code>MultiIndex</code>索引的<code>Series</code>的格式。索引之间的“间隔”表示“直接使用上面的标签”：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">MultiIndex</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">           <span class="n">labels</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
</span></span></code></pre></div><p>对于一个层次化索引的对象，可以使用所谓的部分索引，使用它选取数据子集的操作更简单：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="mi">1</span>    <span class="mf">1.393406</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.092908</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="mi">2</span>    <span class="mf">0.281746</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">0.769023</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>有时甚至还可以在“内层”中进行选取：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.478943</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">0.092908</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">0.281746</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>层次化索引在数据重塑和基于分组的操作（如透视表生成）中扮演着重要的角色。例如，可以通过<code>unstack</code>方法将这段数据重新安排到一个<code>DataFrame</code>中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="mi">1</span>         <span class="mi">2</span>         <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">-</span><span class="mf">0.204708</span>  <span class="mf">0.478943</span> <span class="o">-</span><span class="mf">0.519439</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">-</span><span class="mf">0.555730</span>       <span class="n">NaN</span>  <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="mf">1.393406</span>  <span class="mf">0.092908</span>       <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.281746</span>  <span class="mf">0.769023</span>
</span></span></code></pre></div><p><code>unstack</code>的逆运算是<code>stack</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.204708</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.478943</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>   <span class="o">-</span><span class="mf">0.519439</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="mi">1</span>    <span class="mf">1.393406</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.092908</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="mi">2</span>    <span class="mf">0.281746</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">0.769023</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p><code>stack</code>和<code>unstack</code>将在本章后面详细讲解。</p>
<p>对于一个<code>DataFrame</code>，每条轴都可以有分层索引：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">index</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">columns</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Colorado&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                               <span class="p">[</span><span class="s1">&#39;Green&#39;</span><span class="p">,</span> <span class="s1">&#39;Red&#39;</span><span class="p">,</span> <span class="s1">&#39;Green&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl">    <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="mi">1</span>     <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl">  <span class="mi">2</span>     <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="mi">1</span>     <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl">  <span class="mi">2</span>     <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span>
</span></span></code></pre></div><p>各层都可以有名字（可以是字符串，也可以是别的 Python 对象）。如果指定了名称，它们就会显示在控制台输出中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>      <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span>     <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key1</span> <span class="n">key2</span>                   
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>        <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>        <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>        <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>        <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span>
</span></span></code></pre></div><blockquote>
<p>注意：小心区分索引名<code>state</code>、<code>color</code>与行标签。</p>
</blockquote>
<p>有了部分列索引，因此可以轻松选取列分组：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">frame</span><span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">color</span>      <span class="n">Green</span>  <span class="n">Red</span>
</span></span><span class="line"><span class="cl"><span class="n">key1</span> <span class="n">key2</span>            
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>         <span class="mi">0</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>         <span class="mi">3</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>         <span class="mi">6</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>         <span class="mi">9</span>   <span class="mi">10</span>
</span></span></code></pre></div><p>可以单独创建<code>MultiIndex</code>然后复用。上面那个<code>DataFrame</code>中的（带有分级名称）列可以这样创建：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Colorado&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Green&#39;</span><span class="p">,</span> <span class="s1">&#39;Red&#39;</span><span class="p">,</span> <span class="s1">&#39;Green&#39;</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">                       <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">])</span>
</span></span></code></pre></div><h2 id="重排与分级排序">重排与分级排序</h2>
<p>有时，你需要重新调整某条轴上各级别的顺序，或根据指定级别上的值对数据进行排序。<code>swaplevel</code>接受两个级别编号或名称，并返回一个互换了级别的新对象（但数据不会发生变化）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>      <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span>     <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key2</span> <span class="n">key1</span>                   
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="n">a</span>        <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">a</span>        <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="n">b</span>        <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">b</span>        <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span>
</span></span></code></pre></div><p>而<code>sort_index</code>则根据单个级别中的值对数据进行排序。交换级别时，常常也会用到<code>sort_index</code>，这样最终结果就是按照指定顺序进行字母排序了：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>      <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span>     <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key1</span> <span class="n">key2</span>                   
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>        <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>        <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">2</span>        <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>        <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>      <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span>     <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key2</span> <span class="n">key1</span>                   
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="n">a</span>        <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>        <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">a</span>        <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>        <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span>
</span></span></code></pre></div><h2 id="根据级别汇总统计">根据级别汇总统计</h2>
<p>许多对<code>DataFrame</code>和<code>Series</code>的描述和汇总统计都有一个<code>level</code>选项，它用于指定在某条轴上求和的级别。再以上面那个<code>DataFrame</code>为例，我们可以根据行或列上的级别来进行求和：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;key2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>  <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span> <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key2</span>                    
</span></span><span class="line"><span class="cl"><span class="mi">1</span>         <span class="mi">6</span>   <span class="mi">8</span>       <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>        <span class="mi">12</span>  <span class="mi">14</span>       <span class="mi">16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">color</span>      <span class="n">Green</span>  <span class="n">Red</span>
</span></span><span class="line"><span class="cl"><span class="n">key1</span> <span class="n">key2</span>            
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>         <span class="mi">2</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>         <span class="mi">8</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>        <span class="mi">14</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>        <span class="mi">20</span>   <span class="mi">10</span>
</span></span></code></pre></div><p>这其实是利用了 pandas 的<code>groupby</code>功能，本书稍后将对其进行详细讲解。</p>
<h2 id="使用dataframe的列进行索引">使用<code>DataFrame</code>的列进行索引</h2>
<p>人们经常想要将<code>DataFrame</code>的一个或多个列当做行索引来用，或者可能希望将行索引变成<code>DataFrame</code>的列。以下面这个<code>DataFrame</code>为例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                             <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">a</span>  <span class="n">b</span>    <span class="n">c</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>  <span class="n">one</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">6</span>  <span class="n">one</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="n">one</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mi">3</span>  <span class="mi">4</span>  <span class="n">two</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mi">4</span>  <span class="mi">3</span>  <span class="n">two</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="mi">5</span>  <span class="mi">2</span>  <span class="n">two</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>  <span class="mi">6</span>  <span class="mi">1</span>  <span class="n">two</span>  <span class="mi">3</span>
</span></span></code></pre></div><p><code>DataFrame</code>的<code>set_index</code>函数会将其一个或多个列转换为行索引，并创建一个新的<code>DataFrame</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">frame2</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">frame2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">a</span>  <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="n">d</span>      
</span></span><span class="line"><span class="cl"><span class="n">one</span> <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">6</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>  <span class="mi">2</span>  <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span> <span class="mi">0</span>  <span class="mi">3</span>  <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">3</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">1</span>
</span></span></code></pre></div><p>默认情况下，那些列会从<code>DataFrame</code>中移除，但也可以将其保留下来：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">a</span>  <span class="n">b</span>    <span class="n">c</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="n">d</span>              
</span></span><span class="line"><span class="cl"><span class="n">one</span> <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>  <span class="n">one</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">6</span>  <span class="n">one</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="n">one</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span> <span class="mi">0</span>  <span class="mi">3</span>  <span class="mi">4</span>  <span class="n">two</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">3</span>  <span class="n">two</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">2</span>  <span class="n">two</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">1</span>  <span class="n">two</span>  <span class="mi">3</span>
</span></span></code></pre></div><p><code>reset_index</code>的功能跟<code>set_index</code>刚好相反，层次化索引的级别会被转移到列里面：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">frame2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="n">d</span>  <span class="n">a</span>  <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">one</span>  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">one</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">one</span>  <span class="mi">2</span>  <span class="mi">2</span>  <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">two</span>  <span class="mi">0</span>  <span class="mi">3</span>  <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">two</span>  <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">two</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>  <span class="n">two</span>  <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">1</span>
</span></span></code></pre></div><h1 id="82-合并数据集">8.2 合并数据集</h1>
<p>pandas 对象中的数据可以通过一些方式进行合并：</p>
<ul>
<li><code>pandas.merge</code>可根据一个或多个键将不同<code>DataFrame</code>中的行连接起来。SQL 或其他关系型数据库的用户对此应该会比较熟悉，因为它实现的就是数据库的连接操作。</li>
<li><code>pandas.concat</code>可以沿着一条轴将多个对象堆叠到一起。</li>
<li>实例方法<code>combine_first</code>可以将重复数据拼接在一起，用一个对象中的值填充另一个对象中的缺失值。</li>
</ul>
<p>我将分别对它们进行讲解，并给出一些例子。本书剩余部分的示例中将经常用到它们。</p>
<h2 id="数据库风格的dataframe合并">数据库风格的<code>DataFrame</code>合并</h2>
<p>数据集的合并（merge）或连接（join）运算是通过一个或多个键将行连接起来的。这些运算是关系型数据库（基于 SQL）的核心。pandas 的<code>merge</code>函数是对数据应用这些算法的主要切入点。</p>
<p>以一个简单的例子开始：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data1&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data2&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">2</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">3</span>   <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>      <span class="mi">6</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data2</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">2</span>   <span class="n">d</span>
</span></span></code></pre></div><p>这是一种多对一的合并。<code>df1</code>中的数据有多个被标记为<code>a</code>和<code>b</code>的行，而<code>df2</code>中<code>key</code>列的每个值则仅对应一行。对这些对象调用<code>merge</code>即可得到：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">39</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">6</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">2</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span></code></pre></div><p>注意，我并没有指明要用哪个列进行连接。如果没有指定，<code>merge</code>就会将重叠列的列名当做键。不过，最好明确指定一下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">6</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">2</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span></code></pre></div><p>如果两个对象的列名不同，也可以分别进行指定：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;lkey&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data1&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">df4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;rkey&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data2&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df3</span><span class="p">,</span> <span class="n">df4</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;lkey&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;rkey&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">lkey</span>  <span class="n">data2</span> <span class="n">rkey</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>    <span class="n">b</span>      <span class="mi">1</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>    <span class="n">b</span>      <span class="mi">1</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">6</span>    <span class="n">b</span>      <span class="mi">1</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">2</span>    <span class="n">a</span>      <span class="mi">0</span>    <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>    <span class="n">a</span>      <span class="mi">0</span>    <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>    <span class="n">a</span>      <span class="mi">0</span>    <span class="n">a</span>
</span></span></code></pre></div><p>可能你已经注意到了，结果里面<code>c</code>和<code>d</code>以及与之相关的数据消失了。默认情况下，<code>merge</code>做的是“内连接”；结果中的键是交集。其他方式还有<code>&quot;left&quot;</code>、<code>&quot;right&quot;</code>以及<code>&quot;outer&quot;</code>。外连接求取的是键的并集，组合了左连接和右连接的效果：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">44</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">0.0</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mf">1.0</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">6.0</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mf">2.0</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mf">4.0</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="mf">5.0</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>    <span class="mf">3.0</span>   <span class="n">c</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>    <span class="n">NaN</span>   <span class="n">d</span>    <span class="mf">2.0</span>
</span></span></code></pre></div><p>表 8-1 对这些选项进行了总结。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-e49b3341f4a3c90e.png"
        data-srcset="img/7178691-e49b3341f4a3c90e.png, img/7178691-e49b3341f4a3c90e.png 1.5x, img/7178691-e49b3341f4a3c90e.png 2x"
        data-sizes="auto"
        alt="img/7178691-e49b3341f4a3c90e.png"
        title="表 8-1 不同的连接类型" /></p>
<p>多对多的合并有些不直观。看下面的例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data1&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data2&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">2</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">3</span>   <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">48</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data2</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">2</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">3</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">d</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>       <span class="mi">0</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>       <span class="mi">0</span>   <span class="n">b</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>       <span class="mi">1</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>       <span class="mi">1</span>   <span class="n">b</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>       <span class="mi">2</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>       <span class="mi">2</span>   <span class="n">a</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>       <span class="mi">3</span>   <span class="n">c</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>       <span class="mi">4</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>       <span class="mi">4</span>   <span class="n">a</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">9</span>       <span class="mi">5</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>      <span class="mi">5</span>   <span class="n">b</span>    <span class="mf">3.0</span>
</span></span></code></pre></div><p>多对多连接产生的是行的笛卡尔积。由于左边的<code>DataFrame</code>有 3 个<code>&quot;b&quot;</code>行，右边的有 2 个，所以最终结果中就有 6 个<code>&quot;b&quot;</code>行。连接方式只影响出现在结果中的不同的键的值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">0</span>   <span class="n">b</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">1</span>   <span class="n">b</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">5</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">b</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>      <span class="mi">2</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>      <span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>      <span class="mi">4</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">9</span>      <span class="mi">4</span>   <span class="n">a</span>      <span class="mi">2</span>
</span></span></code></pre></div><p>要根据多个键进行合并，传入一个由列名组成的列表即可：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="s1">&#39;lval&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;rval&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key1</span> <span class="n">key2</span>  <span class="n">lval</span>  <span class="n">rval</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>  <span class="n">one</span>   <span class="mf">1.0</span>   <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">foo</span>  <span class="n">one</span>   <span class="mf">1.0</span>   <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">foo</span>  <span class="n">two</span>   <span class="mf">2.0</span>   <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">bar</span>  <span class="n">one</span>   <span class="mf">3.0</span>   <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>  <span class="n">two</span>   <span class="n">NaN</span>   <span class="mf">7.0</span>
</span></span></code></pre></div><p>结果中会出现哪些键组合取决于所选的合并方式，你可以这样来理解：多个键形成一系列元组，并将其当做单个连接键（当然，实际上并不是这么回事）。</p>
<blockquote>
<p>注意：在进行列－列连接时，<code>DataFrame</code>对象中的索引会被丢弃。</p>
</blockquote>
<p>对于合并运算需要考虑的最后一个问题是对重复列名的处理。虽然你可以手工处理列名重叠的问题（查看前面介绍的重命名轴标签），但<code>merge</code>有一个更实用的<code>suffixes</code>选项，用于指定附加到左右两个<code>DataFrame</code>对象的重叠列名上的字符串：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">54</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key1</span> <span class="n">key2_x</span>  <span class="n">lval</span> <span class="n">key2_y</span>  <span class="n">rval</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>    <span class="n">one</span>     <span class="mi">1</span>    <span class="n">one</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">foo</span>    <span class="n">one</span>     <span class="mi">1</span>    <span class="n">one</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">foo</span>    <span class="n">two</span>     <span class="mi">2</span>    <span class="n">one</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">foo</span>    <span class="n">two</span>     <span class="mi">2</span>    <span class="n">one</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>    <span class="n">one</span>     <span class="mi">3</span>    <span class="n">one</span>     <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">bar</span>    <span class="n">one</span>     <span class="mi">3</span>    <span class="n">two</span>     <span class="mi">7</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_left&#39;</span><span class="p">,</span> <span class="s1">&#39;_right&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key1</span> <span class="n">key2_left</span>  <span class="n">lval</span> <span class="n">key2_right</span>  <span class="n">rval</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>       <span class="n">one</span>     <span class="mi">1</span>        <span class="n">one</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">foo</span>       <span class="n">one</span>     <span class="mi">1</span>        <span class="n">one</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">foo</span>       <span class="n">two</span>     <span class="mi">2</span>        <span class="n">one</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">foo</span>       <span class="n">two</span>     <span class="mi">2</span>        <span class="n">one</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>       <span class="n">one</span>     <span class="mi">3</span>        <span class="n">one</span>     <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">bar</span>       <span class="n">one</span>     <span class="mi">3</span>        <span class="n">two</span>     <span class="mi">7</span>
</span></span></code></pre></div><p><code>merge</code>的参数请参见表 8-2。使用<code>DataFrame</code>的行索引合并是下一节的主题。</p>
<p>表 8-2 <code>merge</code>函数的参数</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-35ca716a4f1b8475.png"
        data-srcset="img/7178691-35ca716a4f1b8475.png, img/7178691-35ca716a4f1b8475.png 1.5x, img/7178691-35ca716a4f1b8475.png 2x"
        data-sizes="auto"
        alt="img/7178691-35ca716a4f1b8475.png"
        title="img/7178691-35ca716a4f1b8475.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-c86672e733ceccd9.png"
        data-srcset="img/7178691-c86672e733ceccd9.png, img/7178691-c86672e733ceccd9.png 1.5x, img/7178691-c86672e733ceccd9.png 2x"
        data-sizes="auto"
        alt="img/7178691-c86672e733ceccd9.png"
        title="img/7178691-c86672e733ceccd9.png" /></p>
<p><code>indicator</code>添加特殊的列<code>_merge</code>，它可以指明每个行的来源，它的值有<code>left_only</code>、<code>right_only</code>或<code>both</code>，根据每行的合并数据的来源。</p>
<h2 id="索引上的合并">索引上的合并</h2>
<p>有时候，<code>DataFrame</code>中的连接键位于其索引中。在这种情况下，你可以传入<code>left_index=True</code>或<code>right_index=True</code>（或两个都传）以说明索引应该被用作连接键：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">left1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">right1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;group_val&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">left1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">58</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">key</span>  <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="n">a</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">b</span>      <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>   <span class="n">c</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">right1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">59</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">group_val</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left1</span><span class="p">,</span> <span class="n">right1</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">60</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key</span>  <span class="n">value</span>  <span class="n">group_val</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="n">a</span>      <span class="mi">0</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="n">a</span>      <span class="mi">3</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">b</span>      <span class="mi">4</span>        <span class="mf">7.0</span>
</span></span></code></pre></div><p>由于默认的<code>merge</code>方法是求取连接键的交集，因此你可以通过外连接的方式得到它们的并集：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left1</span><span class="p">,</span> <span class="n">right1</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">61</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key</span>  <span class="n">value</span>  <span class="n">group_val</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="n">a</span>      <span class="mi">0</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="n">a</span>      <span class="mi">3</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">b</span>      <span class="mi">4</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>   <span class="n">c</span>      <span class="mi">5</span>        <span class="n">NaN</span>
</span></span></code></pre></div><p>对于层次化索引的数据，事情就有点复杂了，因为索引的合并默认是多键合并：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="n">lefth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                                <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">5.</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="n">righth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="n">index</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                               <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                              <span class="p">[</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;event1&#39;</span><span class="p">,</span> <span class="s1">&#39;event2&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">lefth</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">64</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data</span>    <span class="n">key1</span>  <span class="n">key2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="mf">1.0</span>    <span class="n">Ohio</span>  <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="mf">2.0</span>    <span class="n">Ohio</span>  <span class="mi">2002</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="mf">3.0</span>  <span class="n">Nevada</span>  <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="mf">4.0</span>  <span class="n">Nevada</span>  <span class="mi">2002</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="n">righth</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">65</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">             <span class="n">event1</span>  <span class="n">event2</span>
</span></span><span class="line"><span class="cl"><span class="n">Nevada</span> <span class="mi">2001</span>       <span class="mi">0</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl">       <span class="mi">2000</span>       <span class="mi">2</span>       <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>   <span class="mi">2000</span>       <span class="mi">4</span>       <span class="mi">5</span>
</span></span><span class="line"><span class="cl">       <span class="mi">2000</span>       <span class="mi">6</span>       <span class="mi">7</span>
</span></span><span class="line"><span class="cl">       <span class="mi">2001</span>       <span class="mi">8</span>       <span class="mi">9</span>
</span></span><span class="line"><span class="cl">       <span class="mi">2002</span>      <span class="mi">10</span>      <span class="mi">11</span>
</span></span></code></pre></div><p>这种情况下，你必须以列表的形式指明用作合并键的多个列（注意用<code>how='outer'</code>对重复索引值的处理）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lefth</span><span class="p">,</span> <span class="n">righth</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">],</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">66</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data</span>    <span class="n">key1</span>  <span class="n">key2</span>  <span class="n">event1</span>  <span class="n">event2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>       <span class="mi">4</span>       <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>       <span class="mi">6</span>       <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="mf">1.0</span>    <span class="n">Ohio</span>  <span class="mi">2001</span>       <span class="mi">8</span>       <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="mf">2.0</span>    <span class="n">Ohio</span>  <span class="mi">2002</span>      <span class="mi">10</span>      <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="mf">3.0</span>  <span class="n">Nevada</span>  <span class="mi">2001</span>       <span class="mi">0</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lefth</span><span class="p">,</span> <span class="n">righth</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>          <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">67</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data</span>    <span class="n">key1</span>  <span class="n">key2</span>  <span class="n">event1</span>  <span class="n">event2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>     <span class="mf">4.0</span>     <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>     <span class="mf">6.0</span>     <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="mf">1.0</span>    <span class="n">Ohio</span>  <span class="mi">2001</span>     <span class="mf">8.0</span>     <span class="mf">9.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="mf">2.0</span>    <span class="n">Ohio</span>  <span class="mi">2002</span>    <span class="mf">10.0</span>    <span class="mf">11.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="mf">3.0</span>  <span class="n">Nevada</span>  <span class="mi">2001</span>     <span class="mf">0.0</span>     <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="mf">4.0</span>  <span class="n">Nevada</span>  <span class="mi">2002</span>     <span class="n">NaN</span>     <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">NaN</span>  <span class="n">Nevada</span>  <span class="mi">2000</span>     <span class="mf">2.0</span>     <span class="mf">3.0</span>
</span></span></code></pre></div><p>同时使用合并双方的索引也没问题：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="n">left2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">right2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">],</span> <span class="p">[</span><span class="mf">11.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">],</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Missouri&#39;</span><span class="p">,</span> <span class="s1">&#39;Alabama&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">left2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">70</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="n">right2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">71</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Missouri</span>  <span class="n">Alabama</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>       <span class="mf">7.0</span>      <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>      <span class="mf">11.0</span>     <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left2</span><span class="p">,</span> <span class="n">right2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">72</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>  <span class="n">Missouri</span>  <span class="n">Alabama</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>       <span class="n">NaN</span>      <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>   <span class="n">NaN</span>     <span class="n">NaN</span>       <span class="mf">7.0</span>      <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>   <span class="n">NaN</span>     <span class="n">NaN</span>      <span class="mf">11.0</span>     <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span>
</span></span></code></pre></div><p><code>DataFrame</code>还有一个便捷的<code>join</code>实例方法，它能更为方便地实现按索引合并。它还可用于合并多个带有相同或相似索引的<code>DataFrame</code>对象，但要求没有重叠的列。在上面那个例子中，我们可以编写：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="n">left2</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">right2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">73</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>  <span class="n">Missouri</span>  <span class="n">Alabama</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>       <span class="n">NaN</span>      <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>   <span class="n">NaN</span>     <span class="n">NaN</span>       <span class="mf">7.0</span>      <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>   <span class="n">NaN</span>     <span class="n">NaN</span>      <span class="mf">11.0</span>     <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span>
</span></span></code></pre></div><p>因为一些历史版本的遗留原因，<code>DataFrame</code>的<code>join</code>方法默认使用的是左连接，保留左边表的行索引。它还支持在调用的<code>DataFrame</code>的列上，连接传递的<code>DataFrame</code>索引：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">]:</span> <span class="n">left1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">right1</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">74</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key</span>  <span class="n">value</span>  <span class="n">group_val</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="n">a</span>      <span class="mi">0</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="n">a</span>      <span class="mi">3</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">b</span>      <span class="mi">4</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>   <span class="n">c</span>      <span class="mi">5</span>        <span class="n">NaN</span>
</span></span></code></pre></div><p>最后，对于简单的索引合并，你还可以向<code>join</code>传入一组<code>DataFrame</code>，下一节会介绍更为通用的<code>concat</code>函数，也能实现此功能：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">75</span><span class="p">]:</span> <span class="n">another</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">],</span> <span class="p">[</span><span class="mf">11.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">],</span> <span class="p">[</span><span class="mf">16.</span><span class="p">,</span> <span class="mf">17.</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;Oregon&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">76</span><span class="p">]:</span> <span class="n">another</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">76</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">New</span> <span class="n">York</span>  <span class="n">Oregon</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>       <span class="mf">7.0</span>     <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>       <span class="mf">9.0</span>    <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>      <span class="mf">11.0</span>    <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>      <span class="mf">16.0</span>    <span class="mf">17.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">77</span><span class="p">]:</span> <span class="n">left2</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">right2</span><span class="p">,</span> <span class="n">another</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">77</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>  <span class="n">Missouri</span>  <span class="n">Alabama</span>  <span class="n">New</span> <span class="n">York</span>  <span class="n">Oregon</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>       <span class="n">NaN</span>      <span class="n">NaN</span>       <span class="mf">7.0</span>     <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>       <span class="mf">9.0</span>    <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span>      <span class="mf">11.0</span>    <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="n">left2</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">right2</span><span class="p">,</span> <span class="n">another</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">78</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>  <span class="n">Missouri</span>  <span class="n">Alabama</span>  <span class="n">New</span> <span class="n">York</span>  <span class="n">Oregon</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>       <span class="n">NaN</span>      <span class="n">NaN</span>       <span class="mf">7.0</span>     <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>   <span class="n">NaN</span>     <span class="n">NaN</span>       <span class="mf">7.0</span>      <span class="mf">8.0</span>       <span class="n">NaN</span>     <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>       <span class="mf">9.0</span>    <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>   <span class="n">NaN</span>     <span class="n">NaN</span>      <span class="mf">11.0</span>     <span class="mf">12.0</span>       <span class="n">NaN</span>     <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span>      <span class="mf">11.0</span>    <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>   <span class="n">NaN</span>     <span class="n">NaN</span>       <span class="n">NaN</span>      <span class="n">NaN</span>      <span class="mf">16.0</span>    <span class="mf">17.0</span>
</span></span></code></pre></div><h2 id="轴向连接">轴向连接</h2>
<p>另一种数据合并运算也被称作连接（concatenation）、绑定（binding）或堆叠（stacking）。NumPy 的<code>concatenation</code>函数可以用 NumPy 数组来做：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="n">arr</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">80</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">81</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]])</span>
</span></span></code></pre></div><p>对于 pandas 对象（如<code>Series</code>和<code>DataFrame</code>），带有标签的轴使你能够进一步推广数组的连接运算。具体点说，你还需要考虑以下这些东西：</p>
<ul>
<li>如果对象在其它轴上的索引不同，我们应该合并这些轴的不同元素还是只使用交集？</li>
<li>连接的数据集是否需要在结果对象中可识别？</li>
<li>连接轴中保存的数据是否需要保留？许多情况下，<code>DataFrame</code>默认的整数标签最好在连接时删掉。</li>
</ul>
<p>pandas 的<code>concat</code>函数提供了一种能够解决这些问题的可靠方式。我将给出一些例子来讲解其使用方式。假设有三个没有重叠索引的<code>Series</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">])</span>
</span></span></code></pre></div><p>对这些对象调用<code>concat</code>可以将值和索引粘合在一起：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">85</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">85</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p>默认情况下，<code>concat</code>是在<code>axis=0</code>上工作的，最终产生一个新的<code>Series</code>。如果传入<code>axis=1</code>，则结果就会变成一个<code>DataFrame</code>（<code>axis=1</code>是列）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">86</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="mi">0</span>    <span class="mi">1</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.0</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="n">NaN</span>  <span class="mf">2.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="n">NaN</span>  <span class="mf">3.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">6.0</span>
</span></span></code></pre></div><p>这种情况下，另外的轴上没有重叠，从索引的有序并集（外连接）上就可以看出来。传入<code>join='inner'</code>即可得到它们的交集：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="n">s4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="n">s4</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">88</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">89</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="mi">0</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.0</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.0</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>  <span class="n">NaN</span>  <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>  <span class="n">NaN</span>  <span class="mi">6</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">90</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="mi">0</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mi">0</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>  <span class="mi">1</span>
</span></span></code></pre></div><p>在这个例子中，<code>f</code>和<code>g</code>标签消失了，是因为使用的是<code>join='inner'</code>选项。</p>
<p>你可以通过<code>join_axes</code>指定要在其它轴上使用的索引：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">91</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join_axes</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">91</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="mi">0</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.0</span>  <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span></code></pre></div><p>不过有个问题，参与连接的片段在结果中区分不开。假设你想要在连接轴上创建一个层次化索引。使用<code>keys</code>参数即可达到这个目的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s3</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">93</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl">       <span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl">       <span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="n">f</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl">       <span class="n">g</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">94</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">         <span class="n">a</span>    <span class="n">b</span>    <span class="n">f</span>    <span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span></code></pre></div><p>如果沿着<code>axis=1</code>对<code>Series</code>进行合并，则<code>keys</code>就会成为<code>DataFrame</code>的列头：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">95</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.0</span>  <span class="n">NaN</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="n">NaN</span>  <span class="mf">2.0</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="n">NaN</span>  <span class="mf">3.0</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>  <span class="n">NaN</span>  <span class="n">NaN</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>  <span class="n">NaN</span>  <span class="n">NaN</span>    <span class="mf">6.0</span>
</span></span></code></pre></div><p>同样的逻辑也适用于<code>DataFrame</code>对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">97</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">98</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">98</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">one</span>  <span class="n">two</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">0</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">4</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">99</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">99</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">three</span>  <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>      <span class="mi">5</span>     <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>      <span class="mi">7</span>     <span class="mi">8</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">100</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;level1&#39;</span><span class="p">,</span> <span class="s1">&#39;level2&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">100</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">level1</span>     <span class="n">level2</span>     
</span></span><span class="line"><span class="cl">     <span class="n">one</span> <span class="n">two</span>  <span class="n">three</span> <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>      <span class="mi">0</span>   <span class="mi">1</span>    <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>      <span class="mi">2</span>   <span class="mi">3</span>    <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>      <span class="mi">4</span>   <span class="mi">5</span>    <span class="mf">7.0</span>  <span class="mf">8.0</span>
</span></span></code></pre></div><p>如果传入的不是列表而是一个字典，则字典的键就会被当做<code>keys</code>选项的值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">101</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">({</span><span class="s1">&#39;level1&#39;</span><span class="p">:</span> <span class="n">df1</span><span class="p">,</span> <span class="s1">&#39;level2&#39;</span><span class="p">:</span> <span class="n">df2</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">101</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">level1</span>     <span class="n">level2</span>     
</span></span><span class="line"><span class="cl">     <span class="n">one</span> <span class="n">two</span>  <span class="n">three</span> <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>      <span class="mi">0</span>   <span class="mi">1</span>    <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>      <span class="mi">2</span>   <span class="mi">3</span>    <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>      <span class="mi">4</span>   <span class="mi">5</span>    <span class="mf">7.0</span>  <span class="mf">8.0</span>
</span></span></code></pre></div><p>此外还有两个用于管理层次化索引创建方式的参数（参见表 8-3）。举个例子，我们可以用<code>names</code>参数命名创建的轴级别：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">102</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;level1&#39;</span><span class="p">,</span> <span class="s1">&#39;level2&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>           <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">102</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">upper</span> <span class="n">level1</span>     <span class="n">level2</span>     
</span></span><span class="line"><span class="cl"><span class="n">lower</span>    <span class="n">one</span> <span class="n">two</span>  <span class="n">three</span> <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>          <span class="mi">0</span>   <span class="mi">1</span>    <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>          <span class="mi">2</span>   <span class="mi">3</span>    <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>          <span class="mi">4</span>   <span class="mi">5</span>    <span class="mf">7.0</span>  <span class="mf">8.0</span>
</span></span></code></pre></div><p>最后一个关于<code>DataFrame</code>的问题是，<code>DataFrame</code>的行索引不包含任何相关数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">103</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">104</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">105</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">105</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">a</span>         <span class="n">b</span>         <span class="n">c</span>         <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.246435</span>  <span class="mf">1.007189</span> <span class="o">-</span><span class="mf">1.296221</span>  <span class="mf">0.274992</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">0.228913</span>  <span class="mf">1.352917</span>  <span class="mf">0.886429</span> <span class="o">-</span><span class="mf">2.001637</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="o">-</span><span class="mf">0.371843</span>  <span class="mf">1.669025</span> <span class="o">-</span><span class="mf">0.438570</span> <span class="o">-</span><span class="mf">0.539741</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">106</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">106</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">b</span>         <span class="n">d</span>         <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">0.476985</span>  <span class="mf">3.248944</span> <span class="o">-</span><span class="mf">1.021228</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="o">-</span><span class="mf">0.577087</span>  <span class="mf">0.124121</span>  <span class="mf">0.302614</span>
</span></span></code></pre></div><p>在这种情况下，传入<code>ignore_index=True</code>即可：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">107</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">a</span>         <span class="n">b</span>         <span class="n">c</span>         <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.246435</span>  <span class="mf">1.007189</span> <span class="o">-</span><span class="mf">1.296221</span>  <span class="mf">0.274992</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">0.228913</span>  <span class="mf">1.352917</span>  <span class="mf">0.886429</span> <span class="o">-</span><span class="mf">2.001637</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="o">-</span><span class="mf">0.371843</span>  <span class="mf">1.669025</span> <span class="o">-</span><span class="mf">0.438570</span> <span class="o">-</span><span class="mf">0.539741</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span> <span class="o">-</span><span class="mf">1.021228</span>  <span class="mf">0.476985</span>       <span class="n">NaN</span>  <span class="mf">3.248944</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">0.302614</span> <span class="o">-</span><span class="mf">0.577087</span>       <span class="n">NaN</span>  <span class="mf">0.124121</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="img/7178691-339436563b519415.png"
        data-srcset="img/7178691-339436563b519415.png, img/7178691-339436563b519415.png 1.5x, img/7178691-339436563b519415.png 2x"
        data-sizes="auto"
        alt="img/7178691-339436563b519415.png"
        title="表 8-3 &lt;code&gt;concat&lt;/code&gt;函数的参数" /></p>
<h2 id="合并重叠数据">合并重叠数据</h2>
<p>还有一种数据组合问题不能用简单的合并（merge）或连接（concatenation）运算来处理。比如说，你可能有索引全部或部分重叠的两个数据集。举个有启发性的例子，我们使用 NumPy 的<code>where</code>函数，它表示一种等价于面向数组的<code>if-else</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">108</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>               <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>               <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">111</span><span class="p">]:</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">111</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">2.5</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">112</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.</span> <span class="p">,</span>  <span class="mf">2.5</span><span class="p">,</span>  <span class="mf">2.</span> <span class="p">,</span>  <span class="mf">3.5</span><span class="p">,</span>  <span class="mf">4.5</span><span class="p">,</span>  <span class="n">nan</span><span class="p">])</span>
</span></span></code></pre></div><p><code>Series</code>有一个<code>combine_first</code>方法，实现的也是一样的功能，还带有 pandas 的数据对齐：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">114</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>对于<code>DataFrame</code>，<code>combine_first</code>自然也会在列上做同样的事情，因此你可以将其看做：用传递对象中的数据为调用对象的缺失数据“打补丁”：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">6.</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">4</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">117</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">a</span>    <span class="n">b</span>   <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>   <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">NaN</span>  <span class="mf">2.0</span>   <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">5.0</span>  <span class="n">NaN</span>  <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">NaN</span>  <span class="mf">6.0</span>  <span class="mi">14</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">118</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">a</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">5.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">4.0</span>  <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">3.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">7.0</span>  <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">119</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">a</span>    <span class="n">b</span>     <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>   <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">4.0</span>  <span class="mf">2.0</span>   <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">5.0</span>  <span class="mf">4.0</span>  <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">3.0</span>  <span class="mf">6.0</span>  <span class="mf">14.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">7.0</span>  <span class="mf">8.0</span>   <span class="n">NaN</span>
</span></span></code></pre></div><h1 id="83-重塑和透视">8.3 重塑和透视</h1>
<p>有许多用于重新排列表格型数据的基础运算。这些函数也称作重塑（reshape）或透视（pivot）运算。</p>
<h2 id="重塑层次化索引">重塑层次化索引</h2>
<p>层次化索引为<code>DataFrame</code>数据的重排任务提供了一种具有良好一致性的方式。主要功能有二：</p>
<ul>
<li><code>stack</code>：将数据的列“旋转”为行。</li>
<li><code>unstack</code>：将数据的行“旋转”为列。</li>
</ul>
<p>我将通过一系列的范例来讲解这些操作。接下来看一个简单的<code>DataFrame</code>，其中的行列索引均为字符串数组：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span><span class="s1">&#39;Colorado&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">name</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">121</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">121</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">number</span>    <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span>                    
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>    <span class="mi">1</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">3</span>    <span class="mi">4</span>      <span class="mi">5</span>
</span></span></code></pre></div><p>对该数据使用<code>stack</code>方法即可将列转换为行，得到一个<code>Series</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">122</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">123</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>     <span class="n">number</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>      <span class="n">one</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="cl">          <span class="n">two</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl">          <span class="n">three</span>     <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>  <span class="n">one</span>       <span class="mi">3</span>
</span></span><span class="line"><span class="cl">          <span class="n">two</span>       <span class="mi">4</span>
</span></span><span class="line"><span class="cl">          <span class="n">three</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></div><p>对于一个层次化索引的<code>Series</code>，你可以用<code>unstack</code>将其重排为一个<code>DataFrame</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">124</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">number</span>    <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span>                    
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>    <span class="mi">1</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">3</span>    <span class="mi">4</span>      <span class="mi">5</span>
</span></span></code></pre></div><p>默认情况下，<code>unstack</code>操作的是最内层（<code>stack</code>也是如此）。传入分层级别的编号或名称即可对其它级别进行<code>unstack</code>操作：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">125</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">125</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>   <span class="n">Ohio</span>  <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">number</span>                
</span></span><span class="line"><span class="cl"><span class="n">one</span>        <span class="mi">0</span>         <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>        <span class="mi">1</span>         <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>      <span class="mi">2</span>         <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">126</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">126</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>   <span class="n">Ohio</span>  <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">number</span>                
</span></span><span class="line"><span class="cl"><span class="n">one</span>        <span class="mi">0</span>         <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>        <span class="mi">1</span>         <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>      <span class="mi">2</span>         <span class="mi">5</span>
</span></span></code></pre></div><p>如果不是所有的级别值都能在各分组中找到的话，则<code>unstack</code>操作可能会引入缺失数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">127</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">128</span><span class="p">]:</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">129</span><span class="p">]:</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">130</span><span class="p">]:</span> <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">130</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl">     <span class="n">c</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">c</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl">     <span class="n">e</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">131</span><span class="p">]:</span> <span class="n">data2</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">131</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">a</span>    <span class="n">b</span>    <span class="n">c</span>    <span class="n">d</span>    <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="mf">2.0</span>  <span class="mf">3.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>  <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span></code></pre></div><p><code>stack</code>默认会滤除缺失数据，因此该运算是可逆的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">132</span><span class="p">]:</span> <span class="n">data2</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">132</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">a</span>    <span class="n">b</span>    <span class="n">c</span>    <span class="n">d</span>    <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="mf">2.0</span>  <span class="mf">3.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>  <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">133</span><span class="p">]:</span> <span class="n">data2</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">133</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">c</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">c</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">e</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">134</span><span class="p">]:</span> <span class="n">data2</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">134</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">c</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">e</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">a</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl">     <span class="n">c</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">e</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></div><p>在对<code>DataFrame</code>进行<code>unstack</code>操作时，作为旋转轴的级别将会成为结果中的最低级别：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">135</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">result</span> <span class="o">+</span> <span class="mi">5</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                   <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;side&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">136</span><span class="p">]:</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">136</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">side</span>             <span class="n">left</span>  <span class="n">right</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span>    <span class="n">number</span>             
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>     <span class="n">one</span>        <span class="mi">0</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl">         <span class="n">two</span>        <span class="mi">1</span>      <span class="mi">6</span>
</span></span><span class="line"><span class="cl">         <span class="n">three</span>      <span class="mi">2</span>      <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span> <span class="n">one</span>        <span class="mi">3</span>      <span class="mi">8</span>
</span></span><span class="line"><span class="cl">         <span class="n">two</span>        <span class="mi">4</span>      <span class="mi">9</span>
</span></span><span class="line"><span class="cl">         <span class="n">three</span>      <span class="mi">5</span>     <span class="mi">10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">137</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">137</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">side</span>   <span class="n">left</span>          <span class="n">right</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span>  <span class="n">Ohio</span> <span class="n">Colorado</span>  <span class="n">Ohio</span> <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">number</span>                             
</span></span><span class="line"><span class="cl"><span class="n">one</span>       <span class="mi">0</span>        <span class="mi">3</span>     <span class="mi">5</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>       <span class="mi">1</span>        <span class="mi">4</span>     <span class="mi">6</span>        <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>     <span class="mi">2</span>        <span class="mi">5</span>     <span class="mi">7</span>       <span class="mi">10</span>
</span></span></code></pre></div><p>当调用<code>stack</code>，我们可以指明轴的名字：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">138</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s1">&#39;side&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">138</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>         <span class="n">Colorado</span>  <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="n">number</span> <span class="n">side</span>                 
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="n">left</span>          <span class="mi">3</span>     <span class="mi">0</span>
</span></span><span class="line"><span class="cl">       <span class="n">right</span>         <span class="mi">8</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="n">left</span>          <span class="mi">4</span>     <span class="mi">1</span>
</span></span><span class="line"><span class="cl">       <span class="n">right</span>         <span class="mi">9</span>     <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="n">left</span>          <span class="mi">5</span>     <span class="mi">2</span>
</span></span><span class="line"><span class="cl">       <span class="n">right</span>        <span class="mi">10</span>     <span class="mi">7</span>
</span></span></code></pre></div><h2 id="将长格式旋转为宽格式">将“长格式”旋转为“宽格式”</h2>
<p>多个时间序列数据通常是以所谓的“长格式”（long）或“堆叠格式”（stacked）存储在数据库和 CSV 中的。我们先加载一些示例数据，做一些时间序列规整和数据清洗：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">139</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/macrodata.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">140</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">140</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">year</span>  <span class="n">quarter</span>   <span class="n">realgdp</span>  <span class="n">realcons</span>  <span class="n">realinv</span>  <span class="n">realgovt</span>  <span class="n">realdpi</span>    <span class="n">cpi</span>  \
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1959.0</span>      <span class="mf">1.0</span>  <span class="mf">2710.349</span>    <span class="mf">1707.4</span>  <span class="mf">286.898</span>   <span class="mf">470.045</span>   <span class="mf">1886.9</span>  <span class="mf">28.98</span>   
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">1959.0</span>      <span class="mf">2.0</span>  <span class="mf">2778.801</span>    <span class="mf">1733.7</span>  <span class="mf">310.859</span>   <span class="mf">481.301</span>   <span class="mf">1919.7</span>  <span class="mf">29.15</span>   
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">1959.0</span>      <span class="mf">3.0</span>  <span class="mf">2775.488</span>    <span class="mf">1751.8</span>  <span class="mf">289.226</span>   <span class="mf">491.260</span>   <span class="mf">1916.4</span>  <span class="mf">29.35</span>   
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">1959.0</span>      <span class="mf">4.0</span>  <span class="mf">2785.204</span>    <span class="mf">1753.7</span>  <span class="mf">299.356</span>   <span class="mf">484.052</span>   <span class="mf">1931.3</span>  <span class="mf">29.37</span>   
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">1960.0</span>      <span class="mf">1.0</span>  <span class="mf">2847.699</span>    <span class="mf">1770.5</span>  <span class="mf">331.722</span>   <span class="mf">462.199</span>   <span class="mf">1955.5</span>  <span class="mf">29.54</span>   
</span></span><span class="line"><span class="cl">      <span class="n">m1</span>  <span class="n">tbilrate</span>  <span class="n">unemp</span>      <span class="n">pop</span>  <span class="n">infl</span>  <span class="n">realint</span>  
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">139.7</span>      <span class="mf">2.82</span>    <span class="mf">5.8</span>  <span class="mf">177.146</span>  <span class="mf">0.00</span>     <span class="mf">0.00</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">141.7</span>      <span class="mf">3.08</span>    <span class="mf">5.1</span>  <span class="mf">177.830</span>  <span class="mf">2.34</span>     <span class="mf">0.74</span>  
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">140.5</span>      <span class="mf">3.82</span>    <span class="mf">5.3</span>  <span class="mf">178.657</span>  <span class="mf">2.74</span>     <span class="mf">1.09</span>  
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">140.0</span>      <span class="mf">4.33</span>    <span class="mf">5.6</span>  <span class="mf">179.386</span>  <span class="mf">0.27</span>     <span class="mf">4.06</span>  
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">139.6</span>      <span class="mf">3.50</span>    <span class="mf">5.2</span>  <span class="mf">180.007</span>  <span class="mf">2.31</span>     <span class="mf">1.19</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">141</span><span class="p">]:</span> <span class="n">periods</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">quarter</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">quarter</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">142</span><span class="p">]:</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;realgdp&#39;</span><span class="p">,</span> <span class="s1">&#39;infl&#39;</span><span class="p">,</span> <span class="s1">&#39;unemp&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;item&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">143</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">144</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">periods</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">145</span><span class="p">]:</span> <span class="n">ldata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span>
</span></span></code></pre></div><p>这就是多个时间序列（或者其它带有两个或多个键的可观察数据，这里，我们的键是<code>date</code>和<code>item</code>）的长格式。表中的每行代表一次观察。</p>
<p>关系型数据库（如 MySQL）中的数据经常都是这样存储的，因为固定架构（即列名和数据类型）有一个好处：随着表中数据的添加，<code>item</code>列中的值的种类能够增加。在前面的例子中，<code>date</code>和<code>item</code>通常就是主键（用关系型数据库的说法），不仅提供了关系完整性，而且提供了更为简单的查询支持。有的情况下，使用这样的数据会很麻烦，你可能会更喜欢<code>DataFrame</code>，不同的<code>item</code>值分别形成一列，<code>date</code>列中的时间戳则用作索引。<code>DataFrame</code>的<code>pivot</code>方法完全可以实现这个转换：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">147</span><span class="p">]:</span> <span class="n">pivoted</span> <span class="o">=</span> <span class="n">ldata</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">148</span><span class="p">]:</span> <span class="n">pivoted</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">148</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">item</span>        <span class="n">infl</span>    <span class="n">realgdp</span>  <span class="n">unemp</span>
</span></span><span class="line"><span class="cl"><span class="n">date</span>                              
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.00</span>   <span class="mf">2710.349</span>    <span class="mf">5.8</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.34</span>   <span class="mf">2778.801</span>    <span class="mf">5.1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.74</span>   <span class="mf">2775.488</span>    <span class="mf">5.3</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.27</span>   <span class="mf">2785.204</span>    <span class="mf">5.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.31</span>   <span class="mf">2847.699</span>    <span class="mf">5.2</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">0.14</span>   <span class="mf">2834.390</span>    <span class="mf">5.2</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.70</span>   <span class="mf">2839.022</span>    <span class="mf">5.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">1.21</span>   <span class="mf">2802.616</span>    <span class="mf">6.3</span>
</span></span><span class="line"><span class="cl"><span class="mi">1961</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span> <span class="o">-</span><span class="mf">0.40</span>   <span class="mf">2819.264</span>    <span class="mf">6.8</span>
</span></span><span class="line"><span class="cl"><span class="mi">1961</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">1.47</span>   <span class="mf">2872.005</span>    <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>          <span class="o">...</span>        <span class="o">...</span>    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="mi">2007</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.75</span>  <span class="mf">13203.977</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2007</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">3.45</span>  <span class="mf">13321.109</span>    <span class="mf">4.7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2007</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">6.38</span>  <span class="mf">13391.249</span>    <span class="mf">4.8</span>
</span></span><span class="line"><span class="cl"><span class="mi">2008</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.82</span>  <span class="mf">13366.865</span>    <span class="mf">4.9</span>
</span></span><span class="line"><span class="cl"><span class="mi">2008</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">8.53</span>  <span class="mf">13415.266</span>    <span class="mf">5.4</span>
</span></span><span class="line"><span class="cl"><span class="mi">2008</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span> <span class="o">-</span><span class="mf">3.16</span>  <span class="mf">13324.600</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2008</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="o">-</span><span class="mf">8.79</span>  <span class="mf">13141.920</span>    <span class="mf">6.9</span>
</span></span><span class="line"><span class="cl"><span class="mi">2009</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.94</span>  <span class="mf">12925.410</span>    <span class="mf">8.1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2009</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">3.37</span>  <span class="mf">12901.504</span>    <span class="mf">9.2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2009</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">3.56</span>  <span class="mf">12990.341</span>    <span class="mf">9.6</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">203</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">columns</span><span class="p">]</span>
</span></span></code></pre></div><p>前两个传递的值分别用作行和列索引，最后一个可选值则是用于填充<code>DataFrame</code>的数据列。假设有两个需要同时重塑的数据列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">149</span><span class="p">]:</span> <span class="n">ldata</span><span class="p">[</span><span class="s1">&#39;value2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ldata</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">150</span><span class="p">]:</span> <span class="n">ldata</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">150</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">        <span class="n">date</span>     <span class="n">item</span>     <span class="n">value</span>    <span class="n">value2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="n">realgdp</span>  <span class="mf">2710.349</span>  <span class="mf">0.523772</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>     <span class="n">infl</span>     <span class="mf">0.000</span>  <span class="mf">0.000940</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>    <span class="n">unemp</span>     <span class="mf">5.800</span>  <span class="mf">1.343810</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="n">realgdp</span>  <span class="mf">2778.801</span> <span class="o">-</span><span class="mf">0.713544</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>     <span class="n">infl</span>     <span class="mf">2.340</span> <span class="o">-</span><span class="mf">0.831154</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>    <span class="n">unemp</span>     <span class="mf">5.100</span> <span class="o">-</span><span class="mf">2.370232</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="n">realgdp</span>  <span class="mf">2775.488</span> <span class="o">-</span><span class="mf">1.860761</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>     <span class="n">infl</span>     <span class="mf">2.740</span> <span class="o">-</span><span class="mf">0.860757</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>    <span class="n">unemp</span>     <span class="mf">5.300</span>  <span class="mf">0.560145</span>
</span></span><span class="line"><span class="cl"><span class="mi">9</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="n">realgdp</span>  <span class="mf">2785.204</span> <span class="o">-</span><span class="mf">1.265934</span>
</span></span></code></pre></div><p>如果忽略最后一个参数，得到的<code>DataFrame</code>就会带有层次化的列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">151</span><span class="p">]:</span> <span class="n">pivoted</span> <span class="o">=</span> <span class="n">ldata</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">152</span><span class="p">]:</span> <span class="n">pivoted</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">152</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">           <span class="n">value</span>                    <span class="n">value2</span>                    
</span></span><span class="line"><span class="cl"><span class="n">item</span>        <span class="n">infl</span>   <span class="n">realgdp</span> <span class="n">unemp</span>      <span class="n">infl</span>   <span class="n">realgdp</span>     <span class="n">unemp</span>
</span></span><span class="line"><span class="cl"><span class="n">date</span>                                                          
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.00</span>  <span class="mf">2710.349</span>   <span class="mf">5.8</span>  <span class="mf">0.000940</span>  <span class="mf">0.523772</span>  <span class="mf">1.343810</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.34</span>  <span class="mf">2778.801</span>   <span class="mf">5.1</span> <span class="o">-</span><span class="mf">0.831154</span> <span class="o">-</span><span class="mf">0.713544</span> <span class="o">-</span><span class="mf">2.370232</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.74</span>  <span class="mf">2775.488</span>   <span class="mf">5.3</span> <span class="o">-</span><span class="mf">0.860757</span> <span class="o">-</span><span class="mf">1.860761</span>  <span class="mf">0.560145</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.27</span>  <span class="mf">2785.204</span>   <span class="mf">5.6</span>  <span class="mf">0.119827</span> <span class="o">-</span><span class="mf">1.265934</span> <span class="o">-</span><span class="mf">1.063512</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.31</span>  <span class="mf">2847.699</span>   <span class="mf">5.2</span> <span class="o">-</span><span class="mf">2.359419</span>  <span class="mf">0.332883</span> <span class="o">-</span><span class="mf">0.199543</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">153</span><span class="p">]:</span> <span class="n">pivoted</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">153</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">item</span>        <span class="n">infl</span>   <span class="n">realgdp</span>  <span class="n">unemp</span>
</span></span><span class="line"><span class="cl"><span class="n">date</span>                             
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.00</span>  <span class="mf">2710.349</span>    <span class="mf">5.8</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.34</span>  <span class="mf">2778.801</span>    <span class="mf">5.1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.74</span>  <span class="mf">2775.488</span>    <span class="mf">5.3</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.27</span>  <span class="mf">2785.204</span>    <span class="mf">5.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.31</span>  <span class="mf">2847.699</span>    <span class="mf">5.2</span>
</span></span></code></pre></div><p>注意，<code>pivot</code>其实就是用<code>set_index</code>创建层次化索引，再用<code>unstack</code>重塑：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">154</span><span class="p">]:</span> <span class="n">unstacked</span> <span class="o">=</span> <span class="n">ldata</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">155</span><span class="p">]:</span> <span class="n">unstacked</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">155</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">           <span class="n">value</span>                    <span class="n">value2</span>                    
</span></span><span class="line"><span class="cl"><span class="n">item</span>        <span class="n">infl</span>   <span class="n">realgdp</span> <span class="n">unemp</span>      <span class="n">infl</span>   <span class="n">realgdp</span>     <span class="n">unemp</span>
</span></span><span class="line"><span class="cl"><span class="n">date</span>                                                          
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.00</span>  <span class="mf">2710.349</span>   <span class="mf">5.8</span>  <span class="mf">0.000940</span>  <span class="mf">0.523772</span>  <span class="mf">1.343810</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.34</span>  <span class="mf">2778.801</span>   <span class="mf">5.1</span> <span class="o">-</span><span class="mf">0.831154</span> <span class="o">-</span><span class="mf">0.713544</span> <span class="o">-</span><span class="mf">2.370232</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.74</span>  <span class="mf">2775.488</span>   <span class="mf">5.3</span> <span class="o">-</span><span class="mf">0.860757</span> <span class="o">-</span><span class="mf">1.860761</span>  <span class="mf">0.560145</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.27</span>  <span class="mf">2785.204</span>   <span class="mf">5.6</span>  <span class="mf">0.119827</span> <span class="o">-</span><span class="mf">1.265934</span> <span class="o">-</span><span class="mf">1.063512</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.31</span>  <span class="mf">2847.699</span>   <span class="mf">5.2</span> <span class="o">-</span><span class="mf">2.359419</span>  <span class="mf">0.332883</span> <span class="o">-</span><span class="mf">0.199543</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">0.14</span>  <span class="mf">2834.390</span>   <span class="mf">5.2</span> <span class="o">-</span><span class="mf">0.970736</span> <span class="o">-</span><span class="mf">1.541996</span> <span class="o">-</span><span class="mf">1.307030</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.70</span>  <span class="mf">2839.022</span>   <span class="mf">5.6</span>  <span class="mf">0.377984</span>  <span class="mf">0.286350</span> <span class="o">-</span><span class="mf">0.753887</span>
</span></span></code></pre></div><h2 id="将宽格式旋转为长格式">将“宽格式”旋转为“长格式”</h2>
<p>旋转<code>DataFrame</code>的逆运算是<code>pandas.melt</code>。它不是将一列转换到多个新的<code>DataFrame</code>，而是合并多个列成为一个，产生一个比输入长的<code>DataFrame</code>。看一个例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">157</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">158</span><span class="p">]:</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">158</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">A</span>  <span class="n">B</span>  <span class="n">C</span>  <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">7</span>  <span class="n">foo</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">8</span>  <span class="n">bar</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">9</span>  <span class="n">baz</span>
</span></span></code></pre></div><p><code>key</code>列可能是分组指标，其它的列是数据值。当使用<code>pandas.melt</code>，我们必须指明哪些列是分组指标。下面使用<code>key</code>作为唯一的分组指标：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">159</span><span class="p">]:</span> <span class="n">melted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">160</span><span class="p">]:</span> <span class="n">melted</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">160</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">key</span> <span class="n">variable</span>  <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>        <span class="n">A</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">bar</span>        <span class="n">A</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">baz</span>        <span class="n">A</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">foo</span>        <span class="n">B</span>      <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>        <span class="n">B</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">baz</span>        <span class="n">B</span>      <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>  <span class="n">foo</span>        <span class="n">C</span>      <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>  <span class="n">bar</span>        <span class="n">C</span>      <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>  <span class="n">baz</span>        <span class="n">C</span>      <span class="mi">9</span>
</span></span></code></pre></div><p>使用<code>pivot</code>，可以重塑回原来的样子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">161</span><span class="p">]:</span> <span class="n">reshaped</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">162</span><span class="p">]:</span> <span class="n">reshaped</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">162</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">variable</span>  <span class="n">A</span>  <span class="n">B</span>  <span class="n">C</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span>              
</span></span><span class="line"><span class="cl"><span class="n">bar</span>       <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">baz</span>       <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">foo</span>       <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">7</span>
</span></span></code></pre></div><p>因为<code>pivot</code>的结果从列创建了一个索引，用作行标签，我们可以使用<code>reset_index</code>将数据移回列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">163</span><span class="p">]:</span> <span class="n">reshaped</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">163</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">variable</span>  <span class="n">key</span>  <span class="n">A</span>  <span class="n">B</span>  <span class="n">C</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>         <span class="n">bar</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>         <span class="n">baz</span>  <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>         <span class="n">foo</span>  <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">7</span>
</span></span></code></pre></div><p>你还可以指定列的子集，作为值的列：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">164</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">164</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">key</span> <span class="n">variable</span>  <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>        <span class="n">A</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">bar</span>        <span class="n">A</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">baz</span>        <span class="n">A</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">foo</span>        <span class="n">B</span>      <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>        <span class="n">B</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">baz</span>        <span class="n">B</span>      <span class="mi">6</span>
</span></span></code></pre></div><p><code>pandas.melt</code>也可以不用分组指标：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">165</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">165</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">variable</span>  <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>        <span class="n">A</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>        <span class="n">A</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>        <span class="n">A</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>        <span class="n">B</span>      <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>        <span class="n">B</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>        <span class="n">B</span>      <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>        <span class="n">C</span>      <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>        <span class="n">C</span>      <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>        <span class="n">C</span>      <span class="mi">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">166</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">166</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">variable</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="n">key</span>   <span class="n">foo</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="n">key</span>   <span class="n">bar</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="n">key</span>   <span class="n">baz</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>        <span class="n">A</span>     <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>        <span class="n">A</span>     <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>        <span class="n">A</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>        <span class="n">B</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>        <span class="n">B</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>        <span class="n">B</span>     <span class="mi">6</span>
</span></span></code></pre></div><h1 id="84-总结">8.4 总结</h1>
<p>现在你已经掌握了 pandas 数据导入、清洗、重塑，我们可以进一步学习 matplotlib 数据可视化。我们在稍后会回到 pandas，学习更高级的分析。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 0001-01-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://localhost:1313/posts/pyda-2e-zh/8/" data-title=""><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/pyda-2e-zh/8/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/posts/pyda-2e-zh/8/" data-title=""><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://localhost:1313/posts/pyda-2e-zh/8/" data-title=""><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://localhost:1313/posts/pyda-2e-zh/8/" data-title=""><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/pyda-2e-zh/9/" class="prev" rel="prev" title=""><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i></a>
            <a href="/posts/pyda-2e-zh/7/" class="next" rel="next" title=""><i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.118.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Aphros</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
